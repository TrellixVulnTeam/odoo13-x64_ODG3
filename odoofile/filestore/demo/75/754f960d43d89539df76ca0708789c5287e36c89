
/* /web_editor/static/lib/cropper/js/cropper.js defined in bundle 'web_editor.assets_wysiwyg' */
(function(global,factory){typeof exports==='object'&&typeof module!=='undefined'?factory(require('jquery')):typeof define==='function'&&define.amd?define(['jquery'],factory):(factory(global.jQuery));}(this,(function($){'use strict';$=$&&$.hasOwnProperty('default')?$['default']:$;var WINDOW=typeof window!=='undefined'?window:{};var NAMESPACE='cropper';var ACTION_ALL='all';var ACTION_CROP='crop';var ACTION_MOVE='move';var ACTION_ZOOM='zoom';var ACTION_EAST='e';var ACTION_WEST='w';var ACTION_SOUTH='s';var ACTION_NORTH='n';var ACTION_NORTH_EAST='ne';var ACTION_NORTH_WEST='nw';var ACTION_SOUTH_EAST='se';var ACTION_SOUTH_WEST='sw';var CLASS_CROP=NAMESPACE+'-crop';var CLASS_DISABLED=NAMESPACE+'-disabled';var CLASS_HIDDEN=NAMESPACE+'-hidden';var CLASS_HIDE=NAMESPACE+'-hide';var CLASS_INVISIBLE=NAMESPACE+'-invisible';var CLASS_MODAL=NAMESPACE+'-modal';var CLASS_MOVE=NAMESPACE+'-move';var DATA_ACTION='action';var DATA_PREVIEW='preview';var DRAG_MODE_CROP='crop';var DRAG_MODE_MOVE='move';var DRAG_MODE_NONE='none';var EVENT_CROP='crop';var EVENT_CROP_END='cropend';var EVENT_CROP_MOVE='cropmove';var EVENT_CROP_START='cropstart';var EVENT_DBLCLICK='dblclick';var EVENT_ERROR='error';var EVENT_LOAD='load';var EVENT_POINTER_DOWN=WINDOW.PointerEvent?'pointerdown':'touchstart mousedown';var EVENT_POINTER_MOVE=WINDOW.PointerEvent?'pointermove':'touchmove mousemove';var EVENT_POINTER_UP=WINDOW.PointerEvent?'pointerup pointercancel':'touchend touchcancel mouseup';var EVENT_READY='ready';var EVENT_RESIZE='resize';var EVENT_WHEEL='wheel mousewheel DOMMouseScroll';var EVENT_ZOOM='zoom';var REGEXP_ACTIONS=/^(e|w|s|n|se|sw|ne|nw|all|crop|move|zoom)$/;var REGEXP_DATA_URL=/^data:/;var REGEXP_DATA_URL_JPEG=/^data:image\/jpeg;base64,/;var REGEXP_TAG_NAME=/^(img|canvas)$/i;var DEFAULTS={viewMode:0,dragMode:DRAG_MODE_CROP,aspectRatio:NaN,data:null,preview:'',responsive:true,restore:true,checkCrossOrigin:true,checkOrientation:true,modal:true,guides:true,center:true,highlight:true,background:true,autoCrop:true,autoCropArea:0.8,movable:true,rotatable:true,scalable:true,zoomable:true,zoomOnTouch:true,zoomOnWheel:true,wheelZoomRatio:0.1,cropBoxMovable:true,cropBoxResizable:true,toggleDragModeOnDblclick:true,minCanvasWidth:0,minCanvasHeight:0,minCropBoxWidth:0,minCropBoxHeight:0,minContainerWidth:200,minContainerHeight:100,ready:null,cropstart:null,cropmove:null,cropend:null,crop:null,zoom:null};var TEMPLATE='<div class="cropper-container">'+'<div class="cropper-wrap-box">'+'<div class="cropper-canvas"></div>'+'</div>'+'<div class="cropper-drag-box"></div>'+'<div class="cropper-crop-box">'+'<span class="cropper-view-box"></span>'+'<span class="cropper-dashed dashed-h"></span>'+'<span class="cropper-dashed dashed-v"></span>'+'<span class="cropper-center"></span>'+'<span class="cropper-face"></span>'+'<span class="cropper-line line-e" data-action="e"></span>'+'<span class="cropper-line line-n" data-action="n"></span>'+'<span class="cropper-line line-w" data-action="w"></span>'+'<span class="cropper-line line-s" data-action="s"></span>'+'<span class="cropper-point point-e" data-action="e"></span>'+'<span class="cropper-point point-n" data-action="n"></span>'+'<span class="cropper-point point-w" data-action="w"></span>'+'<span class="cropper-point point-s" data-action="s"></span>'+'<span class="cropper-point point-ne" data-action="ne"></span>'+'<span class="cropper-point point-nw" data-action="nw"></span>'+'<span class="cropper-point point-sw" data-action="sw"></span>'+'<span class="cropper-point point-se" data-action="se"></span>'+'</div>'+'</div>';var classCallCheck=function(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function");}};var createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor);}}
return function(Constructor,protoProps,staticProps){if(protoProps)defineProperties(Constructor.prototype,protoProps);if(staticProps)defineProperties(Constructor,staticProps);return Constructor;};}();var toConsumableArray=function(arr){if(Array.isArray(arr)){for(var i=0,arr2=Array(arr.length);i<arr.length;i++)arr2[i]=arr[i];return arr2;}else{return Array.from(arr);}};function isString(value){return typeof value==='string';}
var isNaN=Number.isNaN||WINDOW.isNaN;function isNumber(value){return typeof value==='number'&&!isNaN(value);}
function isUndefined(value){return typeof value==='undefined';}
function proxy(fn,context){for(var _len=arguments.length,args=Array(_len>2?_len-2:0),_key=2;_key<_len;_key++){args[_key-2]=arguments[_key];}
return function(){for(var _len2=arguments.length,args2=Array(_len2),_key2=0;_key2<_len2;_key2++){args2[_key2]=arguments[_key2];}
return fn.apply(context,args.concat(args2));};}
var objectKeys=Object.keys||function objectKeys(obj){var keys=[];$.each(obj,function(key){keys.push(key);});return keys;};var REGEXP_DECIMALS=/\.\d*(?:0|9){12}\d*$/i;function normalizeDecimalNumber(value){var times=arguments.length>1&&arguments[1]!==undefined?arguments[1]:100000000000;return REGEXP_DECIMALS.test(value)?Math.round(value*times)/times:value;}
var location=WINDOW.location;var REGEXP_ORIGINS=/^(https?:)\/\/([^:/?#]+):?(\d*)/i;function isCrossOriginURL(url){var parts=url.match(REGEXP_ORIGINS);return parts&&(parts[1]!==location.protocol||parts[2]!==location.hostname||parts[3]!==location.port);}
function addTimestamp(url){var timestamp='timestamp='+new Date().getTime();return url+(url.indexOf('?')===-1?'?':'&')+timestamp;}
function getTransformValues(_ref){var rotate=_ref.rotate,scaleX=_ref.scaleX,scaleY=_ref.scaleY,translateX=_ref.translateX,translateY=_ref.translateY;var values=[];if(isNumber(translateX)&&translateX!==0){values.push('translateX('+translateX+'px)');}
if(isNumber(translateY)&&translateY!==0){values.push('translateY('+translateY+'px)');}
if(isNumber(rotate)&&rotate!==0){values.push('rotate('+rotate+'deg)');}
if(isNumber(scaleX)&&scaleX!==1){values.push('scaleX('+scaleX+')');}
if(isNumber(scaleY)&&scaleY!==1){values.push('scaleY('+scaleY+')');}
return values.length?values.join(' '):'none';}
var navigator=WINDOW.navigator;var IS_SAFARI_OR_UIWEBVIEW=navigator&&/(Macintosh|iPhone|iPod|iPad).*AppleWebKit/i.test(navigator.userAgent);function getImageNaturalSizes(image,callback){if(image.naturalWidth&&!IS_SAFARI_OR_UIWEBVIEW){callback(image.naturalWidth,image.naturalHeight);return;}
var newImage=document.createElement('img');newImage.onload=function(){callback(newImage.width,newImage.height);};newImage.src=image.src;}
function getMaxZoomRatio(pointers){var pointers2=$.extend({},pointers);var ratios=[];$.each(pointers,function(pointerId,pointer){delete pointers2[pointerId];$.each(pointers2,function(pointerId2,pointer2){var x1=Math.abs(pointer.startX-pointer2.startX);var y1=Math.abs(pointer.startY-pointer2.startY);var x2=Math.abs(pointer.endX-pointer2.endX);var y2=Math.abs(pointer.endY-pointer2.endY);var z1=Math.sqrt(x1*x1+y1*y1);var z2=Math.sqrt(x2*x2+y2*y2);var ratio=(z2-z1)/z1;ratios.push(ratio);});});ratios.sort(function(a,b){return Math.abs(a)<Math.abs(b);});return ratios[0];}
function getPointer(_ref2,endOnly){var pageX=_ref2.pageX,pageY=_ref2.pageY;var end={endX:pageX,endY:pageY};if(endOnly){return end;}
return $.extend({startX:pageX,startY:pageY},end);}
function getPointersCenter(pointers){var pageX=0;var pageY=0;var count=0;$.each(pointers,function(pointerId,_ref3){var startX=_ref3.startX,startY=_ref3.startY;pageX+=startX;pageY+=startY;count+=1;});pageX/=count;pageY/=count;return{pageX:pageX,pageY:pageY};}
var isFinite=Number.isFinite||WINDOW.isFinite;function getContainSizes(_ref4){var aspectRatio=_ref4.aspectRatio,height=_ref4.height,width=_ref4.width;var isValidNumber=function isValidNumber(value){return isFinite(value)&&value>0;};if(isValidNumber(width)&&isValidNumber(height)){if(height*aspectRatio>width){height=width/aspectRatio;}else{width=height*aspectRatio;}}else if(isValidNumber(width)){height=width/aspectRatio;}else if(isValidNumber(height)){width=height*aspectRatio;}
return{width:width,height:height};}
function getRotatedSizes(_ref5){var width=_ref5.width,height=_ref5.height,degree=_ref5.degree;degree=Math.abs(degree)%180;if(degree===90){return{width:height,height:width};}
var arc=degree%90*Math.PI/180;var sinArc=Math.sin(arc);var cosArc=Math.cos(arc);var newWidth=width*cosArc+height*sinArc;var newHeight=width*sinArc+height*cosArc;return degree>90?{width:newHeight,height:newWidth}:{width:newWidth,height:newHeight};}
function getSourceCanvas(image,_ref6,_ref7,_ref8){var imageNaturalWidth=_ref6.naturalWidth,imageNaturalHeight=_ref6.naturalHeight,_ref6$rotate=_ref6.rotate,rotate=_ref6$rotate===undefined?0:_ref6$rotate,_ref6$scaleX=_ref6.scaleX,scaleX=_ref6$scaleX===undefined?1:_ref6$scaleX,_ref6$scaleY=_ref6.scaleY,scaleY=_ref6$scaleY===undefined?1:_ref6$scaleY;var aspectRatio=_ref7.aspectRatio,naturalWidth=_ref7.naturalWidth,naturalHeight=_ref7.naturalHeight;var _ref8$fillColor=_ref8.fillColor,fillColor=_ref8$fillColor===undefined?'transparent':_ref8$fillColor,_ref8$imageSmoothingE=_ref8.imageSmoothingEnabled,imageSmoothingEnabled=_ref8$imageSmoothingE===undefined?true:_ref8$imageSmoothingE,_ref8$imageSmoothingQ=_ref8.imageSmoothingQuality,imageSmoothingQuality=_ref8$imageSmoothingQ===undefined?'low':_ref8$imageSmoothingQ,_ref8$maxWidth=_ref8.maxWidth,maxWidth=_ref8$maxWidth===undefined?Infinity:_ref8$maxWidth,_ref8$maxHeight=_ref8.maxHeight,maxHeight=_ref8$maxHeight===undefined?Infinity:_ref8$maxHeight,_ref8$minWidth=_ref8.minWidth,minWidth=_ref8$minWidth===undefined?0:_ref8$minWidth,_ref8$minHeight=_ref8.minHeight,minHeight=_ref8$minHeight===undefined?0:_ref8$minHeight;var maxSizes=getContainSizes({aspectRatio:aspectRatio,width:maxWidth,height:maxHeight});var minSizes=getContainSizes({aspectRatio:aspectRatio,width:minWidth,height:minHeight});var width=Math.min(maxSizes.width,Math.max(minSizes.width,naturalWidth));var height=Math.min(maxSizes.height,Math.max(minSizes.height,naturalHeight));var canvas=document.createElement('canvas');var context=canvas.getContext('2d');var params=[-imageNaturalWidth/2,-imageNaturalHeight/2,imageNaturalWidth,imageNaturalHeight];canvas.width=normalizeDecimalNumber(width);canvas.height=normalizeDecimalNumber(height);context.fillStyle=fillColor;context.fillRect(0,0,width,height);context.save();context.translate(width/2,height/2);context.rotate(rotate*Math.PI/180);context.scale(scaleX,scaleY);context.imageSmoothingEnabled=!!imageSmoothingEnabled;context.imageSmoothingQuality=imageSmoothingQuality;context.drawImage.apply(context,[image].concat(toConsumableArray($.map(params,function(param){return Math.floor(normalizeDecimalNumber(param));}))));context.restore();return canvas;}
var fromCharCode=String.fromCharCode;function getStringFromCharCode(dataView,start,length){var str='';var i=void 0;length+=start;for(i=start;i<length;i+=1){str+=fromCharCode(dataView.getUint8(i));}
return str;}
var REGEXP_DATA_URL_HEAD=/^data:.*,/;function dataURLToArrayBuffer(dataURL){var base64=dataURL.replace(REGEXP_DATA_URL_HEAD,'');var binary=atob(base64);var arrayBuffer=new ArrayBuffer(binary.length);var uint8=new Uint8Array(arrayBuffer);$.each(uint8,function(i){uint8[i]=binary.charCodeAt(i);});return arrayBuffer;}
function arrayBufferToDataURL(arrayBuffer,mimeType){var uint8=new Uint8Array(arrayBuffer);var data='';$.each(uint8,function(i,value){data+=fromCharCode(value);});return'data:'+mimeType+';base64,'+btoa(data);}
function getOrientation(arrayBuffer){var dataView=new DataView(arrayBuffer);var orientation=void 0;var littleEndian=void 0;var app1Start=void 0;var ifdStart=void 0;if(dataView.getUint8(0)===0xFF&&dataView.getUint8(1)===0xD8){var length=dataView.byteLength;var offset=2;while(offset<length){if(dataView.getUint8(offset)===0xFF&&dataView.getUint8(offset+1)===0xE1){app1Start=offset;break;}
offset+=1;}}
if(app1Start){var exifIDCode=app1Start+4;var tiffOffset=app1Start+10;if(getStringFromCharCode(dataView,exifIDCode,4)==='Exif'){var endianness=dataView.getUint16(tiffOffset);littleEndian=endianness===0x4949;if(littleEndian||endianness===0x4D4D){if(dataView.getUint16(tiffOffset+2,littleEndian)===0x002A){var firstIFDOffset=dataView.getUint32(tiffOffset+4,littleEndian);if(firstIFDOffset>=0x00000008){ifdStart=tiffOffset+firstIFDOffset;}}}}}
if(ifdStart){var _length=dataView.getUint16(ifdStart,littleEndian);var _offset=void 0;var i=void 0;for(i=0;i<_length;i+=1){_offset=ifdStart+i*12+2;if(dataView.getUint16(_offset,littleEndian)===0x0112){_offset+=8;orientation=dataView.getUint16(_offset,littleEndian);dataView.setUint16(_offset,1,littleEndian);break;}}}
return orientation;}
function parseOrientation(orientation){var rotate=0;var scaleX=1;var scaleY=1;switch(orientation){case 2:scaleX=-1;break;case 3:rotate=-180;break;case 4:scaleY=-1;break;case 5:rotate=90;scaleY=-1;break;case 6:rotate=90;break;case 7:rotate=90;scaleX=-1;break;case 8:rotate=-90;break;default:}
return{rotate:rotate,scaleX:scaleX,scaleY:scaleY};}
var render={render:function render(){this.initContainer();this.initCanvas();this.initCropBox();this.renderCanvas();if(this.cropped){this.renderCropBox();}},initContainer:function initContainer(){var $element=this.$element,options=this.options,$container=this.$container,$cropper=this.$cropper;$cropper.addClass(CLASS_HIDDEN);$element.removeClass(CLASS_HIDDEN);$cropper.css(this.container={width:Math.max($container.width(),Number(options.minContainerWidth)||200),height:Math.max($container.height(),Number(options.minContainerHeight)||100)});$element.addClass(CLASS_HIDDEN);$cropper.removeClass(CLASS_HIDDEN);},initCanvas:function initCanvas(){var container=this.container,image=this.image;var viewMode=this.options.viewMode;var rotated=Math.abs(image.rotate)%180===90;var naturalWidth=rotated?image.naturalHeight:image.naturalWidth;var naturalHeight=rotated?image.naturalWidth:image.naturalHeight;var aspectRatio=naturalWidth/naturalHeight;var canvasWidth=container.width;var canvasHeight=container.height;if(container.height*aspectRatio>container.width){if(viewMode===3){canvasWidth=container.height*aspectRatio;}else{canvasHeight=container.width/aspectRatio;}}else if(viewMode===3){canvasHeight=container.width/aspectRatio;}else{canvasWidth=container.height*aspectRatio;}
var canvas={aspectRatio:aspectRatio,naturalWidth:naturalWidth,naturalHeight:naturalHeight,width:canvasWidth,height:canvasHeight};canvas.left=(container.width-canvasWidth)/2;canvas.top=(container.height-canvasHeight)/2;canvas.oldLeft=canvas.left;canvas.oldTop=canvas.top;this.canvas=canvas;this.limited=viewMode===1||viewMode===2;this.limitCanvas(true,true);this.initialImage=$.extend({},image);this.initialCanvas=$.extend({},canvas);},limitCanvas:function limitCanvas(isSizeLimited,isPositionLimited){var options=this.options,container=this.container,canvas=this.canvas,cropBox=this.cropBox;var viewMode=options.viewMode;var aspectRatio=canvas.aspectRatio;var cropped=this.cropped&&cropBox;if(isSizeLimited){var minCanvasWidth=Number(options.minCanvasWidth)||0;var minCanvasHeight=Number(options.minCanvasHeight)||0;if(viewMode>0){if(viewMode>1){minCanvasWidth=Math.max(minCanvasWidth,container.width);minCanvasHeight=Math.max(minCanvasHeight,container.height);if(viewMode===3){if(minCanvasHeight*aspectRatio>minCanvasWidth){minCanvasWidth=minCanvasHeight*aspectRatio;}else{minCanvasHeight=minCanvasWidth/aspectRatio;}}}else if(minCanvasWidth){minCanvasWidth=Math.max(minCanvasWidth,cropped?cropBox.width:0);}else if(minCanvasHeight){minCanvasHeight=Math.max(minCanvasHeight,cropped?cropBox.height:0);}else if(cropped){minCanvasWidth=cropBox.width;minCanvasHeight=cropBox.height;if(minCanvasHeight*aspectRatio>minCanvasWidth){minCanvasWidth=minCanvasHeight*aspectRatio;}else{minCanvasHeight=minCanvasWidth/aspectRatio;}}}
var _getContainSizes=getContainSizes({aspectRatio:aspectRatio,width:minCanvasWidth,height:minCanvasHeight});minCanvasWidth=_getContainSizes.width;minCanvasHeight=_getContainSizes.height;canvas.minWidth=minCanvasWidth;canvas.minHeight=minCanvasHeight;canvas.maxWidth=Infinity;canvas.maxHeight=Infinity;}
if(isPositionLimited){if(viewMode>0){var newCanvasLeft=container.width-canvas.width;var newCanvasTop=container.height-canvas.height;canvas.minLeft=Math.min(0,newCanvasLeft);canvas.minTop=Math.min(0,newCanvasTop);canvas.maxLeft=Math.max(0,newCanvasLeft);canvas.maxTop=Math.max(0,newCanvasTop);if(cropped&&this.limited){canvas.minLeft=Math.min(cropBox.left,cropBox.left+cropBox.width-canvas.width);canvas.minTop=Math.min(cropBox.top,cropBox.top+cropBox.height-canvas.height);canvas.maxLeft=cropBox.left;canvas.maxTop=cropBox.top;if(viewMode===2){if(canvas.width>=container.width){canvas.minLeft=Math.min(0,newCanvasLeft);canvas.maxLeft=Math.max(0,newCanvasLeft);}
if(canvas.height>=container.height){canvas.minTop=Math.min(0,newCanvasTop);canvas.maxTop=Math.max(0,newCanvasTop);}}}}else{canvas.minLeft=-canvas.width;canvas.minTop=-canvas.height;canvas.maxLeft=container.width;canvas.maxTop=container.height;}}},renderCanvas:function renderCanvas(changed,transformed){var canvas=this.canvas,image=this.image;if(transformed){var _getRotatedSizes=getRotatedSizes({width:image.naturalWidth*Math.abs(image.scaleX||1),height:image.naturalHeight*Math.abs(image.scaleY||1),degree:image.rotate||0}),naturalWidth=_getRotatedSizes.width,naturalHeight=_getRotatedSizes.height;var width=canvas.width*(naturalWidth/canvas.naturalWidth);var height=canvas.height*(naturalHeight/canvas.naturalHeight);canvas.left-=(width-canvas.width)/2;canvas.top-=(height-canvas.height)/2;canvas.width=width;canvas.height=height;canvas.aspectRatio=naturalWidth/naturalHeight;canvas.naturalWidth=naturalWidth;canvas.naturalHeight=naturalHeight;this.limitCanvas(true,false);}
if(canvas.width>canvas.maxWidth||canvas.width<canvas.minWidth){canvas.left=canvas.oldLeft;}
if(canvas.height>canvas.maxHeight||canvas.height<canvas.minHeight){canvas.top=canvas.oldTop;}
canvas.width=Math.min(Math.max(canvas.width,canvas.minWidth),canvas.maxWidth);canvas.height=Math.min(Math.max(canvas.height,canvas.minHeight),canvas.maxHeight);this.limitCanvas(false,true);canvas.left=Math.min(Math.max(canvas.left,canvas.minLeft),canvas.maxLeft);canvas.top=Math.min(Math.max(canvas.top,canvas.minTop),canvas.maxTop);canvas.oldLeft=canvas.left;canvas.oldTop=canvas.top;this.$canvas.css({width:canvas.width,height:canvas.height,transform:getTransformValues({translateX:canvas.left,translateY:canvas.top})});this.renderImage(changed);if(this.cropped&&this.limited){this.limitCropBox(true,true);}},renderImage:function renderImage(changed){var canvas=this.canvas,image=this.image;var width=image.naturalWidth*(canvas.width/canvas.naturalWidth);var height=image.naturalHeight*(canvas.height/canvas.naturalHeight);$.extend(image,{width:width,height:height,left:(canvas.width-width)/2,top:(canvas.height-height)/2});this.$clone.css({width:image.width,height:image.height,transform:getTransformValues($.extend({translateX:image.left,translateY:image.top},image))});if(changed){this.output();}},initCropBox:function initCropBox(){var options=this.options,canvas=this.canvas;var aspectRatio=options.aspectRatio;var autoCropArea=Number(options.autoCropArea)||0.8;var cropBox={width:canvas.width,height:canvas.height};if(aspectRatio){if(canvas.height*aspectRatio>canvas.width){cropBox.height=cropBox.width/aspectRatio;}else{cropBox.width=cropBox.height*aspectRatio;}}
this.cropBox=cropBox;this.limitCropBox(true,true);cropBox.width=Math.min(Math.max(cropBox.width,cropBox.minWidth),cropBox.maxWidth);cropBox.height=Math.min(Math.max(cropBox.height,cropBox.minHeight),cropBox.maxHeight);cropBox.width=Math.max(cropBox.minWidth,cropBox.width*autoCropArea);cropBox.height=Math.max(cropBox.minHeight,cropBox.height*autoCropArea);cropBox.left=canvas.left+(canvas.width-cropBox.width)/2;cropBox.top=canvas.top+(canvas.height-cropBox.height)/2;cropBox.oldLeft=cropBox.left;cropBox.oldTop=cropBox.top;this.initialCropBox=$.extend({},cropBox);},limitCropBox:function limitCropBox(isSizeLimited,isPositionLimited){var options=this.options,container=this.container,canvas=this.canvas,cropBox=this.cropBox,limited=this.limited;var aspectRatio=options.aspectRatio;if(isSizeLimited){var minCropBoxWidth=Number(options.minCropBoxWidth)||0;var minCropBoxHeight=Number(options.minCropBoxHeight)||0;var maxCropBoxWidth=Math.min(container.width,limited?canvas.width:container.width);var maxCropBoxHeight=Math.min(container.height,limited?canvas.height:container.height);minCropBoxWidth=Math.min(minCropBoxWidth,container.width);minCropBoxHeight=Math.min(minCropBoxHeight,container.height);if(aspectRatio){if(minCropBoxWidth&&minCropBoxHeight){if(minCropBoxHeight*aspectRatio>minCropBoxWidth){minCropBoxHeight=minCropBoxWidth/aspectRatio;}else{minCropBoxWidth=minCropBoxHeight*aspectRatio;}}else if(minCropBoxWidth){minCropBoxHeight=minCropBoxWidth/aspectRatio;}else if(minCropBoxHeight){minCropBoxWidth=minCropBoxHeight*aspectRatio;}
if(maxCropBoxHeight*aspectRatio>maxCropBoxWidth){maxCropBoxHeight=maxCropBoxWidth/aspectRatio;}else{maxCropBoxWidth=maxCropBoxHeight*aspectRatio;}}
cropBox.minWidth=Math.min(minCropBoxWidth,maxCropBoxWidth);cropBox.minHeight=Math.min(minCropBoxHeight,maxCropBoxHeight);cropBox.maxWidth=maxCropBoxWidth;cropBox.maxHeight=maxCropBoxHeight;}
if(isPositionLimited){if(limited){cropBox.minLeft=Math.max(0,canvas.left);cropBox.minTop=Math.max(0,canvas.top);cropBox.maxLeft=Math.min(container.width,canvas.left+canvas.width)-cropBox.width;cropBox.maxTop=Math.min(container.height,canvas.top+canvas.height)-cropBox.height;}else{cropBox.minLeft=0;cropBox.minTop=0;cropBox.maxLeft=container.width-cropBox.width;cropBox.maxTop=container.height-cropBox.height;}}},renderCropBox:function renderCropBox(){var options=this.options,container=this.container,cropBox=this.cropBox;if(cropBox.width>cropBox.maxWidth||cropBox.width<cropBox.minWidth){cropBox.left=cropBox.oldLeft;}
if(cropBox.height>cropBox.maxHeight||cropBox.height<cropBox.minHeight){cropBox.top=cropBox.oldTop;}
cropBox.width=Math.min(Math.max(cropBox.width,cropBox.minWidth),cropBox.maxWidth);cropBox.height=Math.min(Math.max(cropBox.height,cropBox.minHeight),cropBox.maxHeight);this.limitCropBox(false,true);cropBox.left=Math.min(Math.max(cropBox.left,cropBox.minLeft),cropBox.maxLeft);cropBox.top=Math.min(Math.max(cropBox.top,cropBox.minTop),cropBox.maxTop);cropBox.oldLeft=cropBox.left;cropBox.oldTop=cropBox.top;if(options.movable&&options.cropBoxMovable){this.$face.data(DATA_ACTION,cropBox.width>=container.width&&cropBox.height>=container.height?ACTION_MOVE:ACTION_ALL);}
this.$cropBox.css({width:cropBox.width,height:cropBox.height,transform:getTransformValues({translateX:cropBox.left,translateY:cropBox.top})});if(this.cropped&&this.limited){this.limitCanvas(true,true);}
if(!this.disabled){this.output();}},output:function output(){this.preview();if(this.completed){this.trigger(EVENT_CROP,this.getData());}}};var preview={initPreview:function initPreview(){var crossOrigin=this.crossOrigin;var url=crossOrigin?this.crossOriginUrl:this.url;var image=document.createElement('img');if(crossOrigin){image.crossOrigin=crossOrigin;}
image.src=url;var $clone2=$(image);this.$preview=$(this.options.preview);this.$clone2=$clone2;this.$viewBox.html($clone2);this.$preview.each(function(i,element){var $element=$(element);var img=document.createElement('img');$element.data(DATA_PREVIEW,{width:$element.width(),height:$element.height(),html:$element.html()});if(crossOrigin){img.crossOrigin=crossOrigin;}
img.src=url;img.style.cssText='display:block;'+'width:100%;'+'height:auto;'+'min-width:0!important;'+'min-height:0!important;'+'max-width:none!important;'+'max-height:none!important;'+'image-orientation:0deg!important;"';$element.html(img);});},resetPreview:function resetPreview(){this.$preview.each(function(i,element){var $element=$(element);var data=$element.data(DATA_PREVIEW);$element.css({width:data.width,height:data.height}).html(data.html).removeData(DATA_PREVIEW);});},preview:function preview(){var image=this.image,canvas=this.canvas,cropBox=this.cropBox;var cropBoxWidth=cropBox.width,cropBoxHeight=cropBox.height;var width=image.width,height=image.height;var left=cropBox.left-canvas.left-image.left;var top=cropBox.top-canvas.top-image.top;if(!this.cropped||this.disabled){return;}
this.$clone2.css({width:width,height:height,transform:getTransformValues($.extend({translateX:-left,translateY:-top},image))});this.$preview.each(function(i,element){var $element=$(element);var data=$element.data(DATA_PREVIEW);var originalWidth=data.width;var originalHeight=data.height;var newWidth=originalWidth;var newHeight=originalHeight;var ratio=1;if(cropBoxWidth){ratio=originalWidth/cropBoxWidth;newHeight=cropBoxHeight*ratio;}
if(cropBoxHeight&&newHeight>originalHeight){ratio=originalHeight/cropBoxHeight;newWidth=cropBoxWidth*ratio;newHeight=originalHeight;}
$element.css({width:newWidth,height:newHeight}).find('img').css({width:width*ratio,height:height*ratio,transform:getTransformValues($.extend({translateX:-left*ratio,translateY:-top*ratio},image))});});}};var events={bind:function bind(){var $element=this.$element,options=this.options,$cropper=this.$cropper;if($.isFunction(options.cropstart)){$element.on(EVENT_CROP_START,options.cropstart);}
if($.isFunction(options.cropmove)){$element.on(EVENT_CROP_MOVE,options.cropmove);}
if($.isFunction(options.cropend)){$element.on(EVENT_CROP_END,options.cropend);}
if($.isFunction(options.crop)){$element.on(EVENT_CROP,options.crop);}
if($.isFunction(options.zoom)){$element.on(EVENT_ZOOM,options.zoom);}
$cropper.on(EVENT_POINTER_DOWN,proxy(this.cropStart,this));if(options.zoomable&&options.zoomOnWheel){$cropper.on(EVENT_WHEEL,proxy(this.wheel,this));}
if(options.toggleDragModeOnDblclick){$cropper.on(EVENT_DBLCLICK,proxy(this.dblclick,this));}
$(this.element.ownerDocument).on(EVENT_POINTER_MOVE,this.onCropMove=proxy(this.cropMove,this)).on(EVENT_POINTER_UP,this.onCropEnd=proxy(this.cropEnd,this));if(options.responsive){$(window).on(EVENT_RESIZE,this.onResize=proxy(this.resize,this));}},unbind:function unbind(){var $element=this.$element,options=this.options,$cropper=this.$cropper;if($.isFunction(options.cropstart)){$element.off(EVENT_CROP_START,options.cropstart);}
if($.isFunction(options.cropmove)){$element.off(EVENT_CROP_MOVE,options.cropmove);}
if($.isFunction(options.cropend)){$element.off(EVENT_CROP_END,options.cropend);}
if($.isFunction(options.crop)){$element.off(EVENT_CROP,options.crop);}
if($.isFunction(options.zoom)){$element.off(EVENT_ZOOM,options.zoom);}
$cropper.off(EVENT_POINTER_DOWN,this.cropStart);if(options.zoomable&&options.zoomOnWheel){$cropper.off(EVENT_WHEEL,this.wheel);}
if(options.toggleDragModeOnDblclick){$cropper.off(EVENT_DBLCLICK,this.dblclick);}
$(this.element.ownerDocument).off(EVENT_POINTER_MOVE,this.onCropMove).off(EVENT_POINTER_UP,this.onCropEnd);if(options.responsive){$(window).off(EVENT_RESIZE,this.onResize);}}};var handlers={resize:function resize(){var options=this.options,$container=this.$container,container=this.container;var minContainerWidth=Number(options.minContainerWidth)||200;var minContainerHeight=Number(options.minContainerHeight)||100;if(this.disabled||container.width<=minContainerWidth||container.height<=minContainerHeight){return;}
var ratio=$container.width()/container.width;if(ratio!==1||$container.height()!==container.height){var canvasData=void 0;var cropBoxData=void 0;if(options.restore){canvasData=this.getCanvasData();cropBoxData=this.getCropBoxData();}
this.render();if(options.restore){this.setCanvasData($.each(canvasData,function(i,n){canvasData[i]=n*ratio;}));this.setCropBoxData($.each(cropBoxData,function(i,n){cropBoxData[i]=n*ratio;}));}}},dblclick:function dblclick(){if(this.disabled||this.options.dragMode===DRAG_MODE_NONE){return;}
this.setDragMode(this.$dragBox.hasClass(CLASS_CROP)?DRAG_MODE_MOVE:DRAG_MODE_CROP);},wheel:function wheel(event){var _this=this;var e=event.originalEvent||event;var ratio=Number(this.options.wheelZoomRatio)||0.1;if(this.disabled){return;}
event.preventDefault();if(this.wheeling){return;}
this.wheeling=true;setTimeout(function(){_this.wheeling=false;},50);var delta=1;if(e.deltaY){delta=e.deltaY>0?1:-1;}else if(e.wheelDelta){delta=-e.wheelDelta/120;}else if(e.detail){delta=e.detail>0?1:-1;}
this.zoom(-delta*ratio,event);},cropStart:function cropStart(e){if(this.disabled){return;}
var options=this.options,pointers=this.pointers;var originalEvent=e.originalEvent;var action=void 0;if(originalEvent&&originalEvent.changedTouches){$.each(originalEvent.changedTouches,function(i,touch){pointers[touch.identifier]=getPointer(touch);});}else{pointers[originalEvent&&originalEvent.pointerId||0]=getPointer(originalEvent||e);}
if(objectKeys(pointers).length>1&&options.zoomable&&options.zoomOnTouch){action=ACTION_ZOOM;}else{action=$(e.target).data(DATA_ACTION);}
if(!REGEXP_ACTIONS.test(action)){return;}
if(this.trigger(EVENT_CROP_START,{originalEvent:originalEvent,action:action}).isDefaultPrevented()){return;}
e.preventDefault();this.action=action;this.cropping=false;if(action===ACTION_CROP){this.cropping=true;this.$dragBox.addClass(CLASS_MODAL);}},cropMove:function cropMove(e){var action=this.action;if(this.disabled||!action){return;}
var pointers=this.pointers;var originalEvent=e.originalEvent;e.preventDefault();if(this.trigger(EVENT_CROP_MOVE,{originalEvent:originalEvent,action:action}).isDefaultPrevented()){return;}
if(originalEvent&&originalEvent.changedTouches){$.each(originalEvent.changedTouches,function(i,touch){$.extend(pointers[touch.identifier],getPointer(touch,true));});}else{$.extend(pointers[originalEvent&&originalEvent.pointerId||0],getPointer(originalEvent||e,true));}
this.change(e);},cropEnd:function cropEnd(e){if(this.disabled){return;}
var action=this.action;var pointers=this.pointers;var originalEvent=e.originalEvent;if(originalEvent&&originalEvent.changedTouches){$.each(originalEvent.changedTouches,function(i,touch){delete pointers[touch.identifier];});}else{delete pointers[originalEvent&&originalEvent.pointerId||0];}
if(!action){return;}
e.preventDefault();if(!objectKeys(pointers).length){this.action='';}
if(this.cropping){this.cropping=false;this.$dragBox.toggleClass(CLASS_MODAL,this.cropped&&this.options.modal);}
this.trigger(EVENT_CROP_END,{originalEvent:originalEvent,action:action});}};var change={change:function change(e){var options=this.options,pointers=this.pointers,container=this.container,canvas=this.canvas,cropBox=this.cropBox;var action=this.action;var aspectRatio=options.aspectRatio;var left=cropBox.left,top=cropBox.top,width=cropBox.width,height=cropBox.height;var right=left+width;var bottom=top+height;var minLeft=0;var minTop=0;var maxWidth=container.width;var maxHeight=container.height;var renderable=true;var offset=void 0;if(!aspectRatio&&e.shiftKey){aspectRatio=width&&height?width/height:1;}
if(this.limited){minLeft=cropBox.minLeft;minTop=cropBox.minTop;maxWidth=minLeft+Math.min(container.width,canvas.width,canvas.left+canvas.width);maxHeight=minTop+Math.min(container.height,canvas.height,canvas.top+canvas.height);}
var pointer=pointers[objectKeys(pointers)[0]];var range={x:pointer.endX-pointer.startX,y:pointer.endY-pointer.startY};var check=function check(side){switch(side){case ACTION_EAST:if(right+range.x>maxWidth){range.x=maxWidth-right;}
break;case ACTION_WEST:if(left+range.x<minLeft){range.x=minLeft-left;}
break;case ACTION_NORTH:if(top+range.y<minTop){range.y=minTop-top;}
break;case ACTION_SOUTH:if(bottom+range.y>maxHeight){range.y=maxHeight-bottom;}
break;default:}};switch(action){case ACTION_ALL:left+=range.x;top+=range.y;break;case ACTION_EAST:if(range.x>=0&&(right>=maxWidth||aspectRatio&&(top<=minTop||bottom>=maxHeight))){renderable=false;break;}
check(ACTION_EAST);width+=range.x;if(aspectRatio){height=width/aspectRatio;top-=range.x/aspectRatio/2;}
if(width<0){action=ACTION_WEST;width=0;}
break;case ACTION_NORTH:if(range.y<=0&&(top<=minTop||aspectRatio&&(left<=minLeft||right>=maxWidth))){renderable=false;break;}
check(ACTION_NORTH);height-=range.y;top+=range.y;if(aspectRatio){width=height*aspectRatio;left+=range.y*aspectRatio/2;}
if(height<0){action=ACTION_SOUTH;height=0;}
break;case ACTION_WEST:if(range.x<=0&&(left<=minLeft||aspectRatio&&(top<=minTop||bottom>=maxHeight))){renderable=false;break;}
check(ACTION_WEST);width-=range.x;left+=range.x;if(aspectRatio){height=width/aspectRatio;top+=range.x/aspectRatio/2;}
if(width<0){action=ACTION_EAST;width=0;}
break;case ACTION_SOUTH:if(range.y>=0&&(bottom>=maxHeight||aspectRatio&&(left<=minLeft||right>=maxWidth))){renderable=false;break;}
check(ACTION_SOUTH);height+=range.y;if(aspectRatio){width=height*aspectRatio;left-=range.y*aspectRatio/2;}
if(height<0){action=ACTION_NORTH;height=0;}
break;case ACTION_NORTH_EAST:if(aspectRatio){if(range.y<=0&&(top<=minTop||right>=maxWidth)){renderable=false;break;}
check(ACTION_NORTH);height-=range.y;top+=range.y;width=height*aspectRatio;}else{check(ACTION_NORTH);check(ACTION_EAST);if(range.x>=0){if(right<maxWidth){width+=range.x;}else if(range.y<=0&&top<=minTop){renderable=false;}}else{width+=range.x;}
if(range.y<=0){if(top>minTop){height-=range.y;top+=range.y;}}else{height-=range.y;top+=range.y;}}
if(width<0&&height<0){action=ACTION_SOUTH_WEST;height=0;width=0;}else if(width<0){action=ACTION_NORTH_WEST;width=0;}else if(height<0){action=ACTION_SOUTH_EAST;height=0;}
break;case ACTION_NORTH_WEST:if(aspectRatio){if(range.y<=0&&(top<=minTop||left<=minLeft)){renderable=false;break;}
check(ACTION_NORTH);height-=range.y;top+=range.y;width=height*aspectRatio;left+=range.y*aspectRatio;}else{check(ACTION_NORTH);check(ACTION_WEST);if(range.x<=0){if(left>minLeft){width-=range.x;left+=range.x;}else if(range.y<=0&&top<=minTop){renderable=false;}}else{width-=range.x;left+=range.x;}
if(range.y<=0){if(top>minTop){height-=range.y;top+=range.y;}}else{height-=range.y;top+=range.y;}}
if(width<0&&height<0){action=ACTION_SOUTH_EAST;height=0;width=0;}else if(width<0){action=ACTION_NORTH_EAST;width=0;}else if(height<0){action=ACTION_SOUTH_WEST;height=0;}
break;case ACTION_SOUTH_WEST:if(aspectRatio){if(range.x<=0&&(left<=minLeft||bottom>=maxHeight)){renderable=false;break;}
check(ACTION_WEST);width-=range.x;left+=range.x;height=width/aspectRatio;}else{check(ACTION_SOUTH);check(ACTION_WEST);if(range.x<=0){if(left>minLeft){width-=range.x;left+=range.x;}else if(range.y>=0&&bottom>=maxHeight){renderable=false;}}else{width-=range.x;left+=range.x;}
if(range.y>=0){if(bottom<maxHeight){height+=range.y;}}else{height+=range.y;}}
if(width<0&&height<0){action=ACTION_NORTH_EAST;height=0;width=0;}else if(width<0){action=ACTION_SOUTH_EAST;width=0;}else if(height<0){action=ACTION_NORTH_WEST;height=0;}
break;case ACTION_SOUTH_EAST:if(aspectRatio){if(range.x>=0&&(right>=maxWidth||bottom>=maxHeight)){renderable=false;break;}
check(ACTION_EAST);width+=range.x;height=width/aspectRatio;}else{check(ACTION_SOUTH);check(ACTION_EAST);if(range.x>=0){if(right<maxWidth){width+=range.x;}else if(range.y>=0&&bottom>=maxHeight){renderable=false;}}else{width+=range.x;}
if(range.y>=0){if(bottom<maxHeight){height+=range.y;}}else{height+=range.y;}}
if(width<0&&height<0){action=ACTION_NORTH_WEST;height=0;width=0;}else if(width<0){action=ACTION_SOUTH_WEST;width=0;}else if(height<0){action=ACTION_NORTH_EAST;height=0;}
break;case ACTION_MOVE:this.move(range.x,range.y);renderable=false;break;case ACTION_ZOOM:this.zoom(getMaxZoomRatio(pointers),e.originalEvent);renderable=false;break;case ACTION_CROP:if(!range.x||!range.y){renderable=false;break;}
offset=this.$cropper.offset();left=pointer.startX-offset.left;top=pointer.startY-offset.top;width=cropBox.minWidth;height=cropBox.minHeight;if(range.x>0){action=range.y>0?ACTION_SOUTH_EAST:ACTION_NORTH_EAST;}else if(range.x<0){left-=width;action=range.y>0?ACTION_SOUTH_WEST:ACTION_NORTH_WEST;}
if(range.y<0){top-=height;}
if(!this.cropped){this.$cropBox.removeClass(CLASS_HIDDEN);this.cropped=true;if(this.limited){this.limitCropBox(true,true);}}
break;default:}
if(renderable){cropBox.width=width;cropBox.height=height;cropBox.left=left;cropBox.top=top;this.action=action;this.renderCropBox();}
$.each(pointers,function(i,p){p.startX=p.endX;p.startY=p.endY;});}};var methods={crop:function crop(){if(!this.ready||this.disabled){return;}
if(!this.cropped){this.cropped=true;this.limitCropBox(true,true);if(this.options.modal){this.$dragBox.addClass(CLASS_MODAL);}
this.$cropBox.removeClass(CLASS_HIDDEN);}
this.setCropBoxData(this.initialCropBox);},reset:function reset(){if(!this.ready||this.disabled){return;}
this.image=$.extend({},this.initialImage);this.canvas=$.extend({},this.initialCanvas);this.cropBox=$.extend({},this.initialCropBox);this.renderCanvas();if(this.cropped){this.renderCropBox();}},clear:function clear(){if(!this.cropped||this.disabled){return;}
$.extend(this.cropBox,{left:0,top:0,width:0,height:0});this.cropped=false;this.renderCropBox();this.limitCanvas(true,true);this.renderCanvas();this.$dragBox.removeClass(CLASS_MODAL);this.$cropBox.addClass(CLASS_HIDDEN);},replace:function replace(url,onlyColorChanged){if(!this.disabled&&url){if(this.isImg){this.$element.attr('src',url);}
if(onlyColorChanged){this.url=url;this.$clone.attr('src',url);if(this.ready){this.$preview.find('img').add(this.$clone2).attr('src',url);}}else{if(this.isImg){this.replaced=true;}
this.options.data=null;this.load(url);}}},enable:function enable(){if(this.ready){this.disabled=false;this.$cropper.removeClass(CLASS_DISABLED);}},disable:function disable(){if(this.ready){this.disabled=true;this.$cropper.addClass(CLASS_DISABLED);}},destroy:function destroy(){var $element=this.$element;if(this.loaded){if(this.isImg&&this.replaced){$element.attr('src',this.originalUrl);}
this.unbuild();$element.removeClass(CLASS_HIDDEN);}else if(this.isImg){$element.off(EVENT_LOAD,this.start);}else if(this.$clone){this.$clone.remove();}
$element.removeData(NAMESPACE);},move:function move(offsetX,offsetY){var _canvas=this.canvas,left=_canvas.left,top=_canvas.top;this.moveTo(isUndefined(offsetX)?offsetX:left+Number(offsetX),isUndefined(offsetY)?offsetY:top+Number(offsetY));},moveTo:function moveTo(x,y){var canvas=this.canvas;var changed=false;if(isUndefined(y)){y=x;}
x=Number(x);y=Number(y);if(this.ready&&!this.disabled&&this.options.movable){if(isNumber(x)){canvas.left=x;changed=true;}
if(isNumber(y)){canvas.top=y;changed=true;}
if(changed){this.renderCanvas(true);}}},zoom:function zoom(ratio,_event){var canvas=this.canvas;ratio=Number(ratio);if(ratio<0){ratio=1/(1-ratio);}else{ratio=1+ratio;}
this.zoomTo(canvas.width*ratio/canvas.naturalWidth,_event);},zoomTo:function zoomTo(ratio,_event){var options=this.options,pointers=this.pointers,canvas=this.canvas;var width=canvas.width,height=canvas.height,naturalWidth=canvas.naturalWidth,naturalHeight=canvas.naturalHeight;ratio=Number(ratio);if(ratio>=0&&this.ready&&!this.disabled&&options.zoomable){var newWidth=naturalWidth*ratio;var newHeight=naturalHeight*ratio;var originalEvent=void 0;if(_event){originalEvent=_event.originalEvent;}
if(this.trigger(EVENT_ZOOM,{originalEvent:originalEvent,oldRatio:width/naturalWidth,ratio:newWidth/naturalWidth}).isDefaultPrevented()){return;}
if(originalEvent){var offset=this.$cropper.offset();var center=pointers&&objectKeys(pointers).length?getPointersCenter(pointers):{pageX:_event.pageX||originalEvent.pageX||0,pageY:_event.pageY||originalEvent.pageY||0};canvas.left-=(newWidth-width)*((center.pageX-offset.left-canvas.left)/width);canvas.top-=(newHeight-height)*((center.pageY-offset.top-canvas.top)/height);}else{canvas.left-=(newWidth-width)/2;canvas.top-=(newHeight-height)/2;}
canvas.width=newWidth;canvas.height=newHeight;this.renderCanvas(true);}},rotate:function rotate(degree){this.rotateTo((this.image.rotate||0)+Number(degree));},rotateTo:function rotateTo(degree){degree=Number(degree);if(isNumber(degree)&&this.ready&&!this.disabled&&this.options.rotatable){this.image.rotate=degree%360;this.renderCanvas(true,true);}},scaleX:function scaleX(_scaleX){var scaleY=this.image.scaleY;this.scale(_scaleX,isNumber(scaleY)?scaleY:1);},scaleY:function scaleY(_scaleY){var scaleX=this.image.scaleX;this.scale(isNumber(scaleX)?scaleX:1,_scaleY);},scale:function scale(scaleX){var scaleY=arguments.length>1&&arguments[1]!==undefined?arguments[1]:scaleX;var image=this.image;var transformed=false;scaleX=Number(scaleX);scaleY=Number(scaleY);if(this.ready&&!this.disabled&&this.options.scalable){if(isNumber(scaleX)){image.scaleX=scaleX;transformed=true;}
if(isNumber(scaleY)){image.scaleY=scaleY;transformed=true;}
if(transformed){this.renderCanvas(true,true);}}},getData:function getData(){var rounded=arguments.length>0&&arguments[0]!==undefined?arguments[0]:false;var options=this.options,image=this.image,canvas=this.canvas,cropBox=this.cropBox;var data=void 0;if(this.ready&&this.cropped){data={x:cropBox.left-canvas.left,y:cropBox.top-canvas.top,width:cropBox.width,height:cropBox.height};var ratio=image.width/image.naturalWidth;$.each(data,function(i,n){n/=ratio;data[i]=rounded?Math.round(n):n;});}else{data={x:0,y:0,width:0,height:0};}
if(options.rotatable){data.rotate=image.rotate||0;}
if(options.scalable){data.scaleX=image.scaleX||1;data.scaleY=image.scaleY||1;}
return data;},setData:function setData(data){var options=this.options,image=this.image,canvas=this.canvas;var cropBoxData={};if($.isFunction(data)){data=data.call(this.element);}
if(this.ready&&!this.disabled&&$.isPlainObject(data)){var transformed=false;if(options.rotatable){if(isNumber(data.rotate)&&data.rotate!==image.rotate){image.rotate=data.rotate;transformed=true;}}
if(options.scalable){if(isNumber(data.scaleX)&&data.scaleX!==image.scaleX){image.scaleX=data.scaleX;transformed=true;}
if(isNumber(data.scaleY)&&data.scaleY!==image.scaleY){image.scaleY=data.scaleY;transformed=true;}}
if(transformed){this.renderCanvas(true,true);}
var ratio=image.width/image.naturalWidth;if(isNumber(data.x)){cropBoxData.left=data.x*ratio+canvas.left;}
if(isNumber(data.y)){cropBoxData.top=data.y*ratio+canvas.top;}
if(isNumber(data.width)){cropBoxData.width=data.width*ratio;}
if(isNumber(data.height)){cropBoxData.height=data.height*ratio;}
this.setCropBoxData(cropBoxData);}},getContainerData:function getContainerData(){return this.ready?$.extend({},this.container):{};},getImageData:function getImageData(){return this.loaded?$.extend({},this.image):{};},getCanvasData:function getCanvasData(){var canvas=this.canvas;var data={};if(this.ready){$.each(['left','top','width','height','naturalWidth','naturalHeight'],function(i,n){data[n]=canvas[n];});}
return data;},setCanvasData:function setCanvasData(data){var canvas=this.canvas;var aspectRatio=canvas.aspectRatio;if($.isFunction(data)){data=data.call(this.$element);}
if(this.ready&&!this.disabled&&$.isPlainObject(data)){if(isNumber(data.left)){canvas.left=data.left;}
if(isNumber(data.top)){canvas.top=data.top;}
if(isNumber(data.width)){canvas.width=data.width;canvas.height=data.width/aspectRatio;}else if(isNumber(data.height)){canvas.height=data.height;canvas.width=data.height*aspectRatio;}
this.renderCanvas(true);}},getCropBoxData:function getCropBoxData(){var cropBox=this.cropBox;return this.ready&&this.cropped?{left:cropBox.left,top:cropBox.top,width:cropBox.width,height:cropBox.height}:{};},setCropBoxData:function setCropBoxData(data){var cropBox=this.cropBox;var aspectRatio=this.options.aspectRatio;var widthChanged=void 0;var heightChanged=void 0;if($.isFunction(data)){data=data.call(this.$element);}
if(this.ready&&this.cropped&&!this.disabled&&$.isPlainObject(data)){if(isNumber(data.left)){cropBox.left=data.left;}
if(isNumber(data.top)){cropBox.top=data.top;}
if(isNumber(data.width)&&data.width!==cropBox.width){widthChanged=true;cropBox.width=data.width;}
if(isNumber(data.height)&&data.height!==cropBox.height){heightChanged=true;cropBox.height=data.height;}
if(aspectRatio){if(widthChanged){cropBox.height=cropBox.width/aspectRatio;}else if(heightChanged){cropBox.width=cropBox.height*aspectRatio;}}
this.renderCropBox();}},getCroppedCanvas:function getCroppedCanvas(){var options=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{};if(!this.ready||!window.HTMLCanvasElement){return null;}
var canvasData=this.canvas;var source=getSourceCanvas(this.$clone[0],this.image,canvasData,options);if(!this.cropped){return source;}
var _getData=this.getData(),x=_getData.x,y=_getData.y,initialWidth=_getData.width,initialHeight=_getData.height;var aspectRatio=initialWidth/initialHeight;var maxSizes=getContainSizes({aspectRatio:aspectRatio,width:options.maxWidth||Infinity,height:options.maxHeight||Infinity});var minSizes=getContainSizes({aspectRatio:aspectRatio,width:options.minWidth||0,height:options.minHeight||0});var _getContainSizes=getContainSizes({aspectRatio:aspectRatio,width:options.width||initialWidth,height:options.height||initialHeight}),width=_getContainSizes.width,height=_getContainSizes.height;width=Math.min(maxSizes.width,Math.max(minSizes.width,width));height=Math.min(maxSizes.height,Math.max(minSizes.height,height));var canvas=document.createElement('canvas');var context=canvas.getContext('2d');canvas.width=normalizeDecimalNumber(width);canvas.height=normalizeDecimalNumber(height);context.fillStyle=options.fillColor||'transparent';context.fillRect(0,0,width,height);var _options$imageSmoothi=options.imageSmoothingEnabled,imageSmoothingEnabled=_options$imageSmoothi===undefined?true:_options$imageSmoothi,imageSmoothingQuality=options.imageSmoothingQuality;context.imageSmoothingEnabled=imageSmoothingEnabled;if(imageSmoothingQuality){context.imageSmoothingQuality=imageSmoothingQuality;}
var sourceWidth=source.width;var sourceHeight=source.height;var srcX=x;var srcY=y;var srcWidth=void 0;var srcHeight=void 0;var dstX=void 0;var dstY=void 0;var dstWidth=void 0;var dstHeight=void 0;if(srcX<=-initialWidth||srcX>sourceWidth){srcX=0;srcWidth=0;dstX=0;dstWidth=0;}else if(srcX<=0){dstX=-srcX;srcX=0;srcWidth=Math.min(sourceWidth,initialWidth+srcX);dstWidth=srcWidth;}else if(srcX<=sourceWidth){dstX=0;srcWidth=Math.min(initialWidth,sourceWidth-srcX);dstWidth=srcWidth;}
if(srcWidth<=0||srcY<=-initialHeight||srcY>sourceHeight){srcY=0;srcHeight=0;dstY=0;dstHeight=0;}else if(srcY<=0){dstY=-srcY;srcY=0;srcHeight=Math.min(sourceHeight,initialHeight+srcY);dstHeight=srcHeight;}else if(srcY<=sourceHeight){dstY=0;srcHeight=Math.min(initialHeight,sourceHeight-srcY);dstHeight=srcHeight;}
var params=[srcX,srcY,srcWidth,srcHeight];if(dstWidth>0&&dstHeight>0){var scale=width/initialWidth;params.push(dstX*scale,dstY*scale,dstWidth*scale,dstHeight*scale);}
context.drawImage.apply(context,[source].concat(toConsumableArray($.map(params,function(param){return Math.floor(normalizeDecimalNumber(param));}))));return canvas;},setAspectRatio:function setAspectRatio(aspectRatio){var options=this.options;if(!this.disabled&&!isUndefined(aspectRatio)){options.aspectRatio=Math.max(0,aspectRatio)||NaN;if(this.ready){this.initCropBox();if(this.cropped){this.renderCropBox();}}}},setDragMode:function setDragMode(mode){var options=this.options;var croppable=void 0;var movable=void 0;if(this.loaded&&!this.disabled){croppable=mode===DRAG_MODE_CROP;movable=options.movable&&mode===DRAG_MODE_MOVE;mode=croppable||movable?mode:DRAG_MODE_NONE;this.$dragBox.data(DATA_ACTION,mode).toggleClass(CLASS_CROP,croppable).toggleClass(CLASS_MOVE,movable);if(!options.cropBoxMovable){this.$face.data(DATA_ACTION,mode).toggleClass(CLASS_CROP,croppable).toggleClass(CLASS_MOVE,movable);}}}};var Cropper=function(){function Cropper(element){var options=arguments.length>1&&arguments[1]!==undefined?arguments[1]:{};classCallCheck(this,Cropper);if(!element||!REGEXP_TAG_NAME.test(element.tagName)){throw new Error('The first argument is required and must be an <img> or <canvas> element.');}
this.element=element;this.$element=$(element);this.options=$.extend({},DEFAULTS,$.isPlainObject(options)&&options);this.completed=false;this.cropped=false;this.disabled=false;this.isImg=false;this.limited=false;this.loaded=false;this.ready=false;this.replaced=false;this.wheeling=false;this.originalUrl='';this.canvas=null;this.cropBox=null;this.pointers={};this.init();}
createClass(Cropper,[{key:'init',value:function init(){var $element=this.$element;var url=void 0;if($element.is('img')){this.isImg=true;url=$element.attr('src')||'';this.originalUrl=url;if(!url){return;}
url=$element.prop('src');}else if($element.is('canvas')&&window.HTMLCanvasElement){url=$element[0].toDataURL();}
this.load(url);}},{key:'trigger',value:function trigger(type,data){var e=$.Event(type,data);this.$element.trigger(e);return e;}},{key:'load',value:function load(url){var _this=this;if(!url){return;}
this.url=url;this.image={};var $element=this.$element,options=this.options;if(!options.checkOrientation||!window.ArrayBuffer){this.clone();return;}
if(REGEXP_DATA_URL.test(url)){if(REGEXP_DATA_URL_JPEG.test(url)){this.read(dataURLToArrayBuffer(url));}else{this.clone();}
return;}
var xhr=new XMLHttpRequest();xhr.onerror=function(){_this.clone();};xhr.onload=function(){_this.read(xhr.response);};if(options.checkCrossOrigin&&isCrossOriginURL(url)&&!$element.prop('crossOrigin')){url=addTimestamp(url);}
xhr.open('get',url);xhr.responseType='arraybuffer';xhr.withCredentials=$element.prop('crossOrigin')==='use-credentials';xhr.send();}},{key:'read',value:function read(arrayBuffer){var options=this.options,image=this.image;var orientation=getOrientation(arrayBuffer);var rotate=0;var scaleX=1;var scaleY=1;if(orientation>1){this.url=arrayBufferToDataURL(arrayBuffer,'image/jpeg');var _parseOrientation=parseOrientation(orientation);rotate=_parseOrientation.rotate;scaleX=_parseOrientation.scaleX;scaleY=_parseOrientation.scaleY;}
if(options.rotatable){image.rotate=rotate;}
if(options.scalable){image.scaleX=scaleX;image.scaleY=scaleY;}
this.clone();}},{key:'clone',value:function clone(){var $element=this.$element,options=this.options,url=this.url;var crossOrigin='';var crossOriginUrl=void 0;if(options.checkCrossOrigin&&isCrossOriginURL(url)){crossOrigin=$element.prop('crossOrigin');if(crossOrigin){crossOriginUrl=url;}else{crossOrigin='anonymous';crossOriginUrl=addTimestamp(url);}}
this.crossOrigin=crossOrigin;this.crossOriginUrl=crossOriginUrl;var image=document.createElement('img');if(crossOrigin){image.crossOrigin=crossOrigin;}
image.src=crossOriginUrl||url;var $clone=$(image);this.$clone=$clone;if(this.isImg){if(this.element.complete){this.start();}else{$element.one(EVENT_LOAD,$.proxy(this.start,this));}}else{$clone.one(EVENT_LOAD,$.proxy(this.start,this)).one(EVENT_ERROR,$.proxy(this.stop,this)).addClass(CLASS_HIDE).insertAfter($element);}}},{key:'start',value:function start(){var _this2=this;var $clone=this.$clone;var $image=this.$element;if(!this.isImg){$clone.off(EVENT_ERROR,this.stop);$image=$clone;}
getImageNaturalSizes($image[0],function(naturalWidth,naturalHeight){$.extend(_this2.image,{naturalWidth:naturalWidth,naturalHeight:naturalHeight,aspectRatio:naturalWidth/naturalHeight});_this2.loaded=true;_this2.build();});}},{key:'stop',value:function stop(){this.$clone.remove();this.$clone=null;}},{key:'build',value:function build(){var _this3=this;if(!this.loaded){return;}
if(this.ready){this.unbuild();}
var $element=this.$element,options=this.options,$clone=this.$clone;var $cropper=$(TEMPLATE);var $cropBox=$cropper.find('.'+NAMESPACE+'-crop-box');var $face=$cropBox.find('.'+NAMESPACE+'-face');this.$container=$element.parent();this.$cropper=$cropper;this.$canvas=$cropper.find('.'+NAMESPACE+'-canvas').append($clone);this.$dragBox=$cropper.find('.'+NAMESPACE+'-drag-box');this.$cropBox=$cropBox;this.$viewBox=$cropper.find('.'+NAMESPACE+'-view-box');this.$face=$face;$element.addClass(CLASS_HIDDEN).after($cropper);if(!this.isImg){$clone.removeClass(CLASS_HIDE);}
this.initPreview();this.bind();options.aspectRatio=Math.max(0,options.aspectRatio)||NaN;options.viewMode=Math.max(0,Math.min(3,Math.round(options.viewMode)))||0;this.cropped=options.autoCrop;if(options.autoCrop){if(options.modal){this.$dragBox.addClass(CLASS_MODAL);}}else{$cropBox.addClass(CLASS_HIDDEN);}
if(!options.guides){$cropBox.find('.'+NAMESPACE+'-dashed').addClass(CLASS_HIDDEN);}
if(!options.center){$cropBox.find('.'+NAMESPACE+'-center').addClass(CLASS_HIDDEN);}
if(options.cropBoxMovable){$face.addClass(CLASS_MOVE).data(DATA_ACTION,ACTION_ALL);}
if(!options.highlight){$face.addClass(CLASS_INVISIBLE);}
if(options.background){$cropper.addClass(NAMESPACE+'-bg');}
if(!options.cropBoxResizable){$cropBox.find('.'+NAMESPACE+'-line,.'+NAMESPACE+'-point').addClass(CLASS_HIDDEN);}
this.setDragMode(options.dragMode);this.render();this.ready=true;this.setData(options.data);this.completing=setTimeout(function(){if($.isFunction(options.ready)){$element.one(EVENT_READY,options.ready);}
_this3.trigger(EVENT_READY);_this3.trigger(EVENT_CROP,_this3.getData());_this3.completed=true;},0);}},{key:'unbuild',value:function unbuild(){if(!this.ready){return;}
if(!this.completed){clearTimeout(this.completing);}
this.ready=false;this.completed=false;this.initialImage=null;this.initialCanvas=null;this.initialCropBox=null;this.container=null;this.canvas=null;this.cropBox=null;this.unbind();this.resetPreview();this.$preview=null;this.$viewBox=null;this.$cropBox=null;this.$dragBox=null;this.$canvas=null;this.$container=null;this.$cropper.remove();this.$cropper=null;}}],[{key:'setDefaults',value:function setDefaults(options){$.extend(DEFAULTS,$.isPlainObject(options)&&options);}}]);return Cropper;}();if($.extend){$.extend(Cropper.prototype,render,preview,events,handlers,change,methods);}
if($.fn){var AnotherCropper=$.fn.cropper;$.fn.cropper=function jQueryCropper(option){for(var _len=arguments.length,args=Array(_len>1?_len-1:0),_key=1;_key<_len;_key++){args[_key-1]=arguments[_key];}
var result=void 0;this.each(function(i,element){var $element=$(element);var data=$element.data(NAMESPACE);if(!data){if(/destroy/.test(option)){return;}
var options=$.extend({},$element.data(),$.isPlainObject(option)&&option);data=new Cropper(element,options);$element.data(NAMESPACE,data);}
if(isString(option)){var fn=data[option];if($.isFunction(fn)){result=fn.apply(data,args);}}});return isUndefined(result)?this:result;};$.fn.cropper.Constructor=Cropper;$.fn.cropper.setDefaults=Cropper.setDefaults;$.fn.cropper.noConflict=function noConflict(){$.fn.cropper=AnotherCropper;return this;};}})));;

/* /web_editor/static/lib/jQuery.transfo.js defined in bundle 'web_editor.assets_wysiwyg' */
(function($){'use strict';var rad=Math.PI/180;var methods={init:function(settings){return this.each(function(){var $this=$(this),transfo=$this.data('transfo');if(!transfo){_init($this,settings);}else{_overwriteOptions($this,transfo,settings);_targetCss($this,transfo);}});},destroy:function(){return this.each(function(){var $this=$(this);if($this.data('transfo')){_destroy($this);}});},reset:function(){return this.each(function(){var $this=$(this);if($this.data('transfo')){_reset($this);}});},toggle:function(){return this.each(function(){var $this=$(this);var transfo=$this.data('transfo');if(transfo){transfo.settings.hide=!transfo.settings.hide;_showHide($this,transfo);}});},hide:function(){return this.each(function(){var $this=$(this);var transfo=$this.data('transfo');if(transfo){transfo.settings.hide=true;_showHide($this,transfo);}});},show:function(){return this.each(function(){var $this=$(this);var transfo=$this.data('transfo');if(transfo){transfo.settings.hide=false;_showHide($this,transfo);}});},settings:function(){if(this.length>1){this.map(function(){var $this=$(this);return $this.data('transfo')&&$this.data('transfo').settings;});}
return this.data('transfo')&&$this.data('transfo').settings;},center:function(){if(this.length>1){this.map(function(){var $this=$(this);return $this.data('transfo')&&$this.data('transfo').$center.offset();});}
return this.data('transfo')&&this.data('transfo').$center.offset();}};$.fn.transfo=function(method){if(methods[method]){return methods[method].apply(this,Array.prototype.slice.call(arguments,1));}else if(typeof method==='object'||!method){return methods.init.apply(this,arguments);}else{$.error('Method '+method+' does not exist on jQuery.transfo');}
return false;};function _init($this,settings){var transfo={};$this.data('transfo',transfo);transfo.settings=settings;var css="box-sizing: border-box; position: absolute; background-color: #fff; border: 1px solid #ccc; width: 8px; height: 8px; margin-left: -4px; margin-top: -4px;";transfo.$markup=$(''
+'<div class="transfo-container">'
+'<div class="transfo-controls">'
+'<div style="cursor: crosshair; position: absolute; margin: -30px; top: 0; right: 0; padding: 1px 0 0 1px;" class="transfo-rotator">'
+'<span class="fa-stack fa-lg">'
+'<i class="fa fa-circle fa-stack-2x"></i>'
+'<i class="fa fa-repeat fa-stack-1x fa-inverse"></i>'
+'</span>'
+'</div>'
+'<div style="'+css+'top: 0%; left: 0%; cursor: nw-resize;" class="transfo-scaler-tl"></div>'
+'<div style="'+css+'top: 0%; left: 100%; cursor: ne-resize;" class="transfo-scaler-tr"></div>'
+'<div style="'+css+'top: 100%; left: 100%; cursor: se-resize;" class="transfo-scaler-br"></div>'
+'<div style="'+css+'top: 100%; left: 0%; cursor: sw-resize;" class="transfo-scaler-bl"></div>'
+'<div style="'+css+'top: 0%; left: 50%; cursor: n-resize;" class="transfo-scaler-tc"></div>'
+'<div style="'+css+'top: 100%; left: 50%; cursor: s-resize;" class="transfo-scaler-bc"></div>'
+'<div style="'+css+'top: 50%; left: 0%; cursor: w-resize;" class="transfo-scaler-ml"></div>'
+'<div style="'+css+'top: 50%; left: 100%; cursor: e-resize;" class="transfo-scaler-mr"></div>'
+'<div style="'+css+'border: 0; width: 0px; height: 0px; top: 50%; left: 50%;" class="transfo-scaler-mc"></div>'
+'</div>'
+'</div>');transfo.$center=transfo.$markup.find(".transfo-scaler-mc");_setOptions($this,transfo);_overwriteOptions($this,transfo,settings);$("body").append(transfo.$markup);setTimeout(function(){_targetCss($this,transfo);},0);_bind($this,transfo);_targetCss($this,transfo);_stop_animation($this[0]);}
function _overwriteOptions($this,transfo,settings){transfo.settings=$.extend(transfo.settings,settings||{});}
function _stop_animation(target){target.style.webkitAnimationPlayState="paused";target.style.animationPlayState="paused";target.style.webkitTransition="none";target.style.transition="none";}
function _setOptions($this,transfo){var style=$this.attr("style")||"";var transform=style.match(/transform\s*:([^;]+)/)?style.match(/transform\s*:([^;]+)/)[1]:"";transfo.settings={};transfo.settings.angle=transform.indexOf('rotate')!=-1?parseFloat(transform.match(/rotate\(([^)]+)deg\)/)[1]):0;transfo.settings.scalex=transform.indexOf('scaleX')!=-1?parseFloat(transform.match(/scaleX\(([^)]+)\)/)[1]):1;transfo.settings.scaley=transform.indexOf('scaleY')!=-1?parseFloat(transform.match(/scaleY\(([^)]+)\)/)[1]):1;transfo.settings.style=style.replace(/[^;]*transform[^;]+/g,'').replace(/;+/g,';');$this.attr("style",transfo.settings.style);_stop_animation($this[0]);transfo.settings.pos=$this.offset();transfo.settings.height=$this.innerHeight();transfo.settings.width=$this.innerWidth();var translatex=transform.match(/translateX\(([0-9.-]+)(%|px)\)/);var translatey=transform.match(/translateY\(([0-9.-]+)(%|px)\)/);transfo.settings.translate="%";if(translatex&&translatex[2]==="%"){transfo.settings.translatexp=parseFloat(translatex[1]);transfo.settings.translatex=transfo.settings.translatexp/100*transfo.settings.width;}else{transfo.settings.translatex=translatex?parseFloat(translatex[1]):0;}
if(translatey&&translatey[2]==="%"){transfo.settings.translateyp=parseFloat(translatey[1]);transfo.settings.translatey=transfo.settings.translateyp/100*transfo.settings.height;}else{transfo.settings.translatey=translatey?parseFloat(translatey[1]):0;}
transfo.settings.css=window.getComputedStyle($this[0],null);transfo.settings.rotationStep=5;transfo.settings.hide=false;transfo.settings.callback=function(){};}
function _bind($this,transfo){function mousedown(event){_mouseDown($this,this,transfo,event);$(document).on("mousemove",mousemove).on("mouseup",mouseup);}
function mousemove(event){_mouseMove($this,this,transfo,event);}
function mouseup(event){_mouseUp($this,this,transfo,event);$(document).off("mousemove",mousemove).off("mouseup",mouseup);}
transfo.$markup.off().on("mousedown",mousedown);transfo.$markup.find(".transfo-controls >:not(.transfo-scaler-mc)").off().on("mousedown",mousedown);}
function _mouseDown($this,div,transfo,event){event.preventDefault();if(transfo.active||event.which!==1)return;var type="position",$e=$(div);if($e.hasClass("transfo-rotator"))type="rotator";else if($e.hasClass("transfo-scaler-tl"))type="tl";else if($e.hasClass("transfo-scaler-tr"))type="tr";else if($e.hasClass("transfo-scaler-br"))type="br";else if($e.hasClass("transfo-scaler-bl"))type="bl";else if($e.hasClass("transfo-scaler-tc"))type="tc";else if($e.hasClass("transfo-scaler-bc"))type="bc";else if($e.hasClass("transfo-scaler-ml"))type="ml";else if($e.hasClass("transfo-scaler-mr"))type="mr";transfo.active={"type":type,"scalex":transfo.settings.scalex,"scaley":transfo.settings.scaley,"pageX":event.pageX,"pageY":event.pageY,"center":transfo.$center.offset(),};}
function _mouseUp($this,div,transfo,event){transfo.active=null;}
function _mouseMove($this,div,transfo,event){event.preventDefault();if(!transfo.active)return;var settings=transfo.settings;var center=transfo.active.center;var cdx=center.left-event.pageX;var cdy=center.top-event.pageY;if(transfo.active.type=="rotator"){var ang,dang=Math.atan((settings.width*settings.scalex)/(settings.height*settings.scaley))/rad;if(cdy)ang=Math.atan(-cdx/cdy)/rad;else ang=0;if(event.pageY>=center.top&&event.pageX>=center.left)ang+=180;else if(event.pageY>=center.top&&event.pageX<center.left)ang+=180;else if(event.pageY<center.top&&event.pageX<center.left)ang+=360;ang-=dang;if(settings.scaley<0&&settings.scalex<0)ang+=180;if(!event.ctrlKey){settings.angle=Math.round(ang/transfo.settings.rotationStep)*transfo.settings.rotationStep;}else{settings.angle=ang;}
_targetCss($this,transfo);var new_center=transfo.$center.offset();var x=center.left-new_center.left;var y=center.top-new_center.top;var angle=ang*rad;settings.translatex+=x*Math.cos(angle)-y*Math.sin(-angle);settings.translatey+=-x*Math.sin(angle)+y*Math.cos(-angle);}
else if(transfo.active.type=="position"){var angle=settings.angle*rad;var x=event.pageX-transfo.active.pageX;var y=event.pageY-transfo.active.pageY;transfo.active.pageX=event.pageX;transfo.active.pageY=event.pageY;var dx=x*Math.cos(angle)-y*Math.sin(-angle);var dy=-x*Math.sin(angle)+y*Math.cos(-angle);settings.translatex+=dx;settings.translatey+=dy;}
else if(transfo.active.type.length===2){var angle=settings.angle*rad;var dx=cdx*Math.cos(angle)-cdy*Math.sin(-angle);var dy=-cdx*Math.sin(angle)+cdy*Math.cos(-angle);if(transfo.active.type.indexOf("t")!=-1){settings.scaley=dy/(settings.height/2);}
if(transfo.active.type.indexOf("b")!=-1){settings.scaley=-dy/(settings.height/2);}
if(transfo.active.type.indexOf("l")!=-1){settings.scalex=dx/(settings.width/2);}
if(transfo.active.type.indexOf("r")!=-1){settings.scalex=-dx/(settings.width/2);}
if(settings.scaley>0&&settings.scaley<0.05)settings.scaley=0.05;if(settings.scalex>0&&settings.scalex<0.05)settings.scalex=0.05;if(settings.scaley<0&&settings.scaley>-0.05)settings.scaley=-0.05;if(settings.scalex<0&&settings.scalex>-0.05)settings.scalex=-0.05;if(event.shiftKey&&(transfo.active.type==="tl"||transfo.active.type==="bl"||transfo.active.type==="tr"||transfo.active.type==="br")){settings.scaley=settings.scalex;}}
settings.angle=Math.round(settings.angle);settings.translatex=Math.round(settings.translatex);settings.translatey=Math.round(settings.translatey);settings.scalex=Math.round(settings.scalex*100)/100;settings.scaley=Math.round(settings.scaley*100)/100;_targetCss($this,transfo);_stop_animation($this[0]);return false;}
function _setCss($this,css,settings){var transform="";var trans=false;if(settings.angle!==0){trans=true;transform+=" rotate("+settings.angle+"deg) ";}
if(settings.translatex){trans=true;transform+=" translateX("+(settings.translate==="%"?settings.translatexp+"%":settings.translatex+"px")+") ";}
if(settings.translatey){trans=true;transform+=" translateY("+(settings.translate==="%"?settings.translateyp+"%":settings.translatey+"px")+") ";}
if(settings.scalex!=1){trans=true;transform+=" scaleX("+settings.scalex+") ";}
if(settings.scaley!=1){trans=true;transform+=" scaleY("+settings.scaley+") ";}
if(trans){css+=";"
css+="-webkit-transform:"+transform+";"
+"-moz-transform:"+transform+";"
+"-ms-transform:"+transform+";"
+"-o-transform:"+transform+";"
+"transform:"+transform+";";}
css=css.replace(/(\s*;)+/g,';').replace(/^\s*;|;\s*$/g,'');$this.attr("style",css);}
function _targetCss($this,transfo){var settings=transfo.settings;var width=parseFloat(settings.css.width);var height=parseFloat(settings.css.height);settings.translatexp=Math.round(settings.translatex/width*1000)/10;settings.translateyp=Math.round(settings.translatey/height*1000)/10;_setCss($this,settings.style,settings);transfo.$markup.css({"position":"absolute","width":width+"px","height":height+"px","top":settings.pos.top+"px","left":settings.pos.left+"px"});var $controls=transfo.$markup.find('.transfo-controls');_setCss($controls,"width:"+width+"px;"+"height:"+height+"px;"+"cursor: move;",settings);$controls.children().css("transform","scaleX("+(1/settings.scalex)+") scaleY("+(1/settings.scaley)+")");_showHide($this,transfo);transfo.settings.callback.call($this[0],$this);}
function _showHide($this,transfo){transfo.$markup.css("z-index",transfo.settings.hide?-1:1000);if(transfo.settings.hide){transfo.$markup.find(".transfo-controls > *").hide();transfo.$markup.find(".transfo-scaler-mc").show();}else{transfo.$markup.find(".transfo-controls > *").show();}}
function _destroy($this){$this.data('transfo').$markup.remove();$this.removeData('transfo');}
function _reset($this){var transfo=$this.data('transfo');_destroy($this);$this.transfo(transfo.settings);}})(jQuery);;

/* /web_editor/static/src/js/wysiwyg/fonts.js defined in bundle 'web_editor.assets_wysiwyg' */
odoo.define('wysiwyg.fonts',function(require){'use strict';return{cacheCssSelectors:{},getCssSelectors:function(filter){if(this.cacheCssSelectors[filter]){return this.cacheCssSelectors[filter];}
this.cacheCssSelectors[filter]=[];var sheets=document.styleSheets;for(var i=0;i<sheets.length;i++){var rules;try{rules=sheets[i].rules||sheets[i].cssRules;}catch(e){console.warn("Can't read the css rules of: "+sheets[i].href,e);continue;}
if(!rules){continue;}
for(var r=0;r<rules.length;r++){var selectorText=rules[r].selectorText;if(!selectorText){continue;}
var selectors=selectorText.split(/\s*,\s*/);var data=null;for(var s=0;s<selectors.length;s++){var match=selectors[s].trim().match(filter);if(!match){continue;}
if(!data){data={selector:match[0],css:rules[r].cssText.replace(/(^.*\{\s*)|(\s*\}\s*$)/g,''),names:[match[1]]};}else{data.selector+=(', '+match[0]);data.names.push(match[1]);}}
if(data){this.cacheCssSelectors[filter].push(data);}}}
return this.cacheCssSelectors[filter];},fontIcons:[{base:'fa',parser:/\.(fa-(?:\w|-)+)::?before/i}],computeFonts:_.once(function(){var self=this;_.each(this.fontIcons,function(data){data.cssData=self.getCssSelectors(data.parser);data.alias=_.flatten(_.map(data.cssData,_.property('names')));});}),};});;

/* /web_editor/static/lib/nearest/jquery.nearest.js defined in bundle 'web_editor.assets_wysiwyg' */
;(function($,undefined){var rPerc=/^([\d.]+)%$/;function nearest(selector,options,thisObj){selector||(selector='div');var $container=$(options.container),containerOffset=$container.offset()||{left:0,top:0},containerDims=[containerOffset.left+$container.width(),containerOffset.top+$container.height()],percProps={x:0,y:1,w:0,h:1},prop,match;for(prop in percProps)if(percProps.hasOwnProperty(prop)){match=rPerc.exec(options[prop]);if(match){options[prop]=containerDims[percProps[prop]]*match[1]/100;}}
var $all=$(selector),cache=[],furthest=!!options.furthest,checkX=!!options.checkHoriz,checkY=!!options.checkVert,compDist=furthest?0:Infinity,point1x=parseFloat(options.x)||0,point1y=parseFloat(options.y)||0,point2x=parseFloat(point1x+options.w)||point1x,point2y=parseFloat(point1y+options.h)||point1y,tolerance=options.tolerance||0,hasEach2=!!$.fn.each2,min=Math.min,max=Math.max;if(!options.includeSelf&&thisObj){$all=$all.not(thisObj);}
if(tolerance<0){tolerance=0;}
$all[hasEach2?'each2':'each'](function(i,elem){var $this=hasEach2?elem:$(this),off=$this.offset(),x=off.left,y=off.top,w=$this.outerWidth(),h=$this.outerHeight(),x2=x+w,y2=y+h,maxX1=max(x,point1x),minX2=min(x2,point2x),maxY1=max(y,point1y),minY2=min(y2,point2y),intersectX=minX2>=maxX1,intersectY=minY2>=maxY1,distX,distY,distT,isValid;if((checkX&&checkY)||(!checkX&&!checkY&&intersectX&&intersectY)||(checkX&&intersectY)||(checkY&&intersectX)){distX=intersectX?0:maxX1-minX2;distY=intersectY?0:maxY1-minY2;distT=intersectX||intersectY?max(distX,distY):Math.sqrt(distX*distX+distY*distY);isValid=furthest?distT>=compDist-tolerance:distT<=compDist+tolerance;if(isValid){compDist=furthest?max(compDist,distT):min(compDist,distT);cache.push({node:this,dist:distT});}}});var len=cache.length,filtered=[],compMin,compMax,i,item;if(len){if(furthest){compMin=compDist-tolerance;compMax=compDist;}else{compMin=compDist;compMax=compDist+tolerance;}
for(i=0;i<len;i++){item=cache[i];if(item.dist>=compMin&&item.dist<=compMax){filtered.push(item.node);}}}
return filtered;}
$.each(['nearest','furthest','touching'],function(i,name){var defaults={x:0,y:0,w:0,h:0,tolerance:1,container:document,furthest:name=='furthest',includeSelf:false,checkHoriz:name!='touching',checkVert:name!='touching'};$[name]=function(point,selector,options){if(!point||point.x===undefined||point.y===undefined){return $([]);}
var opts=$.extend({},defaults,point,options||{});return $(nearest(selector,opts));};$.fn[name]=function(selector,options){var opts;if(selector&&$.isPlainObject(selector)){opts=$.extend({},defaults,selector,options||{});return this.pushStack(nearest(this,opts));}
var offset=this.offset(),dimensions={x:offset.left,y:offset.top,w:this.outerWidth(),h:this.outerHeight()};opts=$.extend({},defaults,dimensions,options||{});return this.pushStack(nearest(selector,opts,this));};});})(jQuery);;

/* /web_editor/static/src/js/base.js defined in bundle 'web_editor.assets_wysiwyg' */
odoo.define('web_editor.base',function(require){'use strict';var ajax=require('web.ajax');var session=require('web.session');var domReady=new Promise(function(resolve){$(resolve);});return{cacheCssSelectors:{},getCssSelectors:function(filter){if(this.cacheCssSelectors[filter]){return this.cacheCssSelectors[filter];}
this.cacheCssSelectors[filter]=[];var sheets=document.styleSheets;for(var i=0;i<sheets.length;i++){var rules;try{rules=sheets[i].rules||sheets[i].cssRules;}catch(e){console.warn("Can't read the css rules of: "+sheets[i].href,e);continue;}
if(!rules){continue;}
for(var r=0;r<rules.length;r++){var selectorText=rules[r].selectorText;if(!selectorText){continue;}
var selectors=selectorText.split(/\s*,\s*/);var data=null;for(var s=0;s<selectors.length;s++){var match=selectors[s].trim().match(filter);if(!match){continue;}
if(!data){data={selector:match[0],css:rules[r].cssText.replace(/(^.*\{\s*)|(\s*\}\s*$)/g,''),names:[match[1]]};}else{data.selector+=(', '+match[0]);data.names.push(match[1]);}}
if(data){this.cacheCssSelectors[filter].push(data);}}}
return this.cacheCssSelectors[filter];},fontIcons:[{base:'fa',parser:/\.(fa-(?:\w|-)+)::?before/i}],computeFonts:_.once(function(){var self=this;_.each(this.fontIcons,function(data){data.cssData=self.getCssSelectors(data.parser);data.alias=_.flatten(_.map(data.cssData,_.property('names')));});}),ready:function(){return Promise.all([domReady,session.is_bound,ajax.loadXML()]);},};});odoo.define('web_editor.context',function(require){'use strict';function getContext(context){var html=document.documentElement;return _.extend({lang:(html.getAttribute('lang')||'en_US').replace('-','_'),},context||{});}
function getExtraContext(context){var html=document.documentElement;return _.extend(getContext(),{editable:!!(html.dataset.editable||$('[data-oe-model]').length),translatable:!!html.dataset.translatable,edit_translations:!!html.dataset.edit_translations,},context||{});}
return{get:getContext,getExtra:getExtraContext,};});odoo.define('web_editor.ready',function(require){'use strict';var base=require('web_editor.base');return base.ready();});;

/* /web_editor/static/src/js/editor/editor.js defined in bundle 'web_editor.assets_wysiwyg' */
odoo.define('web_editor.editor',function(require){'use strict';var Dialog=require('web.Dialog');var Widget=require('web.Widget');var core=require('web.core');var rte=require('web_editor.rte');var snippetsEditor=require('web_editor.snippet.editor');var summernoteCustomColors=require('web_editor.rte.summernote_custom_colors');var _t=core._t;var EditorMenuBar=Widget.extend({template:'web_editor.editorbar',xmlDependencies:['/web_editor/static/src/xml/editor.xml'],events:{'click button[data-action=save]':'_onSaveClick','click button[data-action=cancel]':'_onCancelClick',},custom_events:{request_history_undo_record:'_onHistoryUndoRecordRequest',request_save:'_onSaveRequest',},init:function(parent,options){var self=this;var res=this._super.apply(this,arguments);var Editor=options.Editor||rte.Class;this.rte=new Editor(this,{getConfig:function($editable){var param=self._getDefaultConfig($editable);if(options.generateOptions){param=options.generateOptions(param);}
return param;},saveElement:options.saveElement,});this.rte.on('rte:start',this,function(){self.trigger('rte:start');});var $editable=this.rte.editable();window.__EditorMenuBar_$editable=$editable;if(options.snippets){this.snippetsMenu=new snippetsEditor.Class(this,Object.assign({$el:$editable,selectorEditableArea:'.o_editable',},options));}
return res;},start:function(){var self=this;var defs=[this._super.apply(this,arguments)];core.bus.on('editor_save_request',this,this.save);core.bus.on('editor_discard_request',this,this.cancel);$('.dropdown-toggle').dropdown();$(document).on('keyup',function(event){if((event.keyCode===8||event.keyCode===46)){var $target=$(event.target).closest('.o_editable');if(!$target.is(':has(*:not(p):not(br))')&&!$target.text().match(/\S/)){$target.empty();}}});$(document).on('click','.note-editable',function(ev){ev.preventDefault();});$(document).on('submit','.note-editable form .btn',function(ev){ev.preventDefault();});$(document).on('hide.bs.dropdown','.dropdown',function(ev){if(ev.originalEvent&&$(ev.target).has(ev.originalEvent.target).length&&$(ev.originalEvent.target).is('[contenteditable]')){ev.preventDefault();}});this.rte.start();var flag=false;window.onbeforeunload=function(event){if(rte.history.getEditableHasUndo().length&&!flag){flag=true;_.defer(function(){flag=false;});return _t('This document is not saved!');}};if(self.snippetsMenu){defs.push(this.snippetsMenu.insertAfter(this.$el));}
this.rte.editable().find('*').off('mousedown mouseup click');return Promise.all(defs).then(function(){self.trigger_up('edit_mode');});},destroy:function(){this._super.apply(this,arguments);core.bus.off('editor_save_request',this,this._onSaveRequest);core.bus.off('editor_discard_request',this,this._onDiscardRequest);},cancel:function(reload){var self=this;return new Promise(function(resolve,reject){if(!rte.history.getEditableHasUndo().length){resolve();}else{var confirm=Dialog.confirm(this,_t("If you discard the current edition, all unsaved changes will be lost. You can cancel to return to the edition mode."),{confirm_callback:resolve,});confirm.on('closed',self,reject);}}).then(function(){if(reload!==false){window.onbeforeunload=null;return self._reload();}});},save:function(reload){var self=this;var defs=[];this.trigger_up('ready_to_save',{defs:defs});return Promise.all(defs).then(function(){if(self.snippetsMenu){self.snippetsMenu.cleanForSave();}
return self._saveCroppedImages();}).then(function(){return self.rte.save();}).then(function(){if(reload!==false){return self._reload();}});},_getDefaultConfig:function($editable){return{'airMode':true,'focus':false,'airPopover':[['style',['style']],['font',['bold','italic','underline','clear']],['fontsize',['fontsize']],['color',['color']],['para',['ul','ol','paragraph']],['table',['table']],['insert',['link','picture']],['history',['undo','redo']],],'styleWithSpan':false,'inlinemedia':['p'],'lang':'odoo','onChange':function(html,$editable){$editable.trigger('content_changed');},'colors':summernoteCustomColors,};},_reload:function(){window.location.hash='scrollTop='+window.document.body.scrollTop;if(window.location.search.indexOf('enable_editor')>=0){window.location.href=window.location.href.replace(/&?enable_editor(=[^&]*)?/g,'');}else{window.location.reload(true);}
return new Promise(function(){});},_saveCroppedImages:function(){var self=this;var defs=_.map(this.rte.editable().find('.o_cropped_img_to_save'),function(croppedImg){var $croppedImg=$(croppedImg);$croppedImg.removeClass('o_cropped_img_to_save');var resModel=$croppedImg.data('crop:resModel');var resID=$croppedImg.data('crop:resID');var cropID=$croppedImg.data('crop:id');var mimetype=$croppedImg.data('crop:mimetype');var originalSrc=$croppedImg.data('crop:originalSrc');var datas=$croppedImg.attr('src').split(',')[1];if(!cropID){var name=originalSrc+'.crop';return self._rpc({model:'ir.attachment',method:'create',args:[{res_model:resModel,res_id:resID,name:name,datas_fname:name,datas:datas,mimetype:mimetype,url:originalSrc,}],}).then(function(attachmentID){return self._rpc({model:'ir.attachment',method:'generate_access_token',args:[[attachmentID]],}).then(function(access_token){$croppedImg.attr('src','/web/image/'+attachmentID+'?access_token='+access_token[0]);});});}else{return self._rpc({model:'ir.attachment',method:'write',args:[[cropID],{datas:datas}],});}});return Promise.all(defs);},_onCancelClick:function(){this.cancel();},_onHistoryUndoRecordRequest:function(ev){this.rte.historyRecordUndo(ev.data.$target,ev.data.event);},_onSaveClick:function(){this.save();},_onDiscardRequest:function(ev){this.cancel(ev.data.reload).then(ev.data.onSuccess,ev.data.onFailure);},_onSaveRequest:function(ev){ev.stopPropagation();this.save(ev.data.reload).then(ev.data.onSuccess,ev.data.onFailure);},});return{Class:EditorMenuBar,};});;

/* /web_editor/static/src/js/editor/rte.js defined in bundle 'web_editor.assets_wysiwyg' */
odoo.define('web_editor.rte',function(require){'use strict';var base=require('web_editor.base');var concurrency=require('web.concurrency');var core=require('web.core');var Widget=require('web.Widget');var weContext=require('web_editor.context');var summernote=require('web_editor.summernote');var summernoteCustomColors=require('web_editor.rte.summernote_custom_colors');var _t=core._t;var dom=summernote.core.dom;var range=summernote.core.range;var History=function History($editable){var aUndo=[];var pos=0;var toSnap;this.makeSnap=function(event,rng){rng=rng||range.create();var elEditable=$(rng&&rng.sc).closest('.o_editable')[0];if(!elEditable){return false;}
return{event:event,editable:elEditable,contents:elEditable.innerHTML,bookmark:rng&&rng.bookmark(elEditable),scrollTop:$(elEditable).scrollTop()};};this.applySnap=function(oSnap){var $editable=$(oSnap.editable);if(document.documentMode){$editable.removeAttr('contentEditable').removeProp('contentEditable');}
$editable.trigger('content_will_be_destroyed');$editable.html(oSnap.contents).scrollTop(oSnap.scrollTop);$editable.trigger('content_was_recreated');$('.oe_overlay').remove();$('.note-control-selection').hide();$editable.trigger('content_changed');try{var r=oSnap.editable.innerHTML===''?range.create(oSnap.editable,0):range.createFromBookmark(oSnap.editable,oSnap.bookmark);r.select();}catch(e){console.error(e);return;}
$(document).trigger('click');$('.o_editable *').filter(function(){var $el=$(this);if($el.data('snippet-editor')){$el.removeData();}});_.defer(function(){var target=dom.isBR(r.sc)?r.sc.parentNode:dom.node(r.sc);if(!target){return;}
$editable.trigger('applySnap');var evt=document.createEvent('MouseEvents');evt.initMouseEvent('click',true,true,window,0,0,0,0,0,false,false,false,false,0,target);target.dispatchEvent(evt);$editable.trigger('keyup');});};this.undo=function(){if(!pos){return;}
var _toSnap=toSnap;if(_toSnap){this.saveSnap();}
if(!aUndo[pos]&&(!aUndo[pos]||aUndo[pos].event!=='undo')){var temp=this.makeSnap('undo');if(temp&&(!pos||temp.contents!==aUndo[pos-1].contents)){aUndo[pos]=temp;}else{pos--;}}else if(_toSnap){pos--;}
this.applySnap(aUndo[Math.max(--pos,0)]);while(pos&&(aUndo[pos].event==='blur'||(aUndo[pos+1].editable===aUndo[pos].editable&&aUndo[pos+1].contents===aUndo[pos].contents))){this.applySnap(aUndo[--pos]);}};this.hasUndo=function(){return(toSnap&&(toSnap.event!=='blur'&&toSnap.event!=='activate'&&toSnap.event!=='undo'))||!!_.find(aUndo.slice(0,pos+1),function(undo){return undo.event!=='blur'&&undo.event!=='activate'&&undo.event!=='undo';});};this.getEditableHasUndo=function(){var editable=[];if((toSnap&&(toSnap.event!=='blur'&&toSnap.event!=='activate'&&toSnap.event!=='undo'))){editable.push(toSnap.editable);}
_.each(aUndo.slice(0,pos+1),function(undo){if(undo.event!=='blur'&&undo.event!=='activate'&&undo.event!=='undo'){editable.push(undo.editable);}});return _.uniq(editable);};this.redo=function(){if(!aUndo[pos+1]){return;}
this.applySnap(aUndo[++pos]);while(aUndo[pos+1]&&aUndo[pos].event==='active'){this.applySnap(aUndo[pos++]);}};this.hasRedo=function(){return aUndo.length>pos+1;};this.recordUndo=function($editable,event,internal_history){var self=this;if(!$editable){var rng=range.create();if(!rng)return;$editable=$(rng.sc).closest('.o_editable');}
if(aUndo[pos]&&(event==='applySnap'||event==='activate')){return;}
if(!internal_history){if(!event||!toSnap||!aUndo[pos-1]||toSnap.event==='activate'){setTimeout(function(){$editable.trigger('content_changed');},0);}}
if(aUndo[pos]){pos=Math.min(pos,aUndo.length);aUndo.splice(pos,aUndo.length);}
if(toSnap&&(toSnap.split||!event||toSnap.event!==event||toSnap.editable!==$editable[0])){this.saveSnap();}
if(pos&&aUndo[pos-1].editable!==$editable[0]){var snap=this.makeSnap('blur',range.create(aUndo[pos-1].editable,0));pos++;aUndo.push(snap);}
if(range.create()){toSnap=self.makeSnap(event);}else{toSnap=false;}};this.splitNext=function(){if(toSnap){toSnap.split=true;}};this.saveSnap=function(){if(toSnap){if(!aUndo[pos]){pos++;}
aUndo.push(toSnap);delete toSnap.split;toSnap=null;}};};var history=new History();$.extend($.expr[':'],{o_editable:function(node,i,m){while(node){if(node.className&&_.isString(node.className)){if(node.className.indexOf('o_not_editable')!==-1){return false;}
if(node.className.indexOf('o_editable')!==-1){return true;}}
node=node.parentNode;}
return false;},});$.fn.extend({focusIn:function(){if(this.length){range.create(dom.firstChild(this[0]),0).select();}
return this;},focusInEnd:function(){if(this.length){var last=dom.lastChild(this[0]);range.create(last,dom.nodeLength(last)).select();}
return this;},selectContent:function(){if(this.length){var next=dom.lastChild(this[0]);range.create(dom.firstChild(this[0]),0,next,next.textContent.length).select();}
return this;},});var RTEWidget=Widget.extend({init:function(parent,params){var self=this;this._super.apply(this,arguments);this.init_bootstrap_carousel=$.fn.carousel;this.edit_bootstrap_carousel=function(){var res=self.init_bootstrap_carousel.apply(this,arguments);$(this).off('keydown.bs.carousel');return res;};this._getConfig=params&&params.getConfig||this._getDefaultConfig;this._saveElement=params&&params.saveElement||this._saveElement;base.computeFonts();},start:function(){var self=this;this.saving_mutex=new concurrency.Mutex();$.fn.carousel=this.edit_bootstrap_carousel;$(document).on('click.rte keyup.rte',function(){var current_range={};try{current_range=range.create()||{};}catch(e){}
var $popover=$(current_range.sc).closest('[contenteditable]');var popover_history=($popover.data()||{}).NoteHistory;if(!popover_history||popover_history===history)return;var editor=$popover.parent('.note-editor');$('button[data-event="undo"]',editor).attr('disabled',!popover_history.hasUndo());$('button[data-event="redo"]',editor).attr('disabled',!popover_history.hasRedo());});$(document).on('mousedown.rte activate.rte',this,this._onMousedown.bind(this));$(document).on('mouseup.rte',this,this._onMouseup.bind(this));$('.o_not_editable').attr('contentEditable',false);var $editable=this.editable();$editable.on('content_will_be_destroyed',function(ev){self.trigger_up('content_will_be_destroyed',{$target:$(ev.currentTarget),});});$editable.on('content_was_recreated',function(ev){self.trigger_up('content_was_recreated',{$target:$(ev.currentTarget),});});$editable.addClass('o_editable').data('rte',this).each(function(){var $node=$(this);var computedStyles=window.getComputedStyle(this)||window.parent.getComputedStyle(this);if(computedStyles.display==='inline'&&$node.data('oe-type')!=='image'){$node.addClass('o_is_inline_editable');}});$(document).on('content_changed','.o_editable',function(ev){self.trigger_up('rte_change',{target:ev.target});if(!ev.__isDirtyHandled){$(this).addClass('o_dirty');ev.__isDirtyHandled=true;}});$('#wrapwrap, .o_editable').on('click.rte','*',this,this._onClick.bind(this));$('body').addClass('editor_enable');$(document.body).tooltip({selector:'[data-oe-readonly]',container:'body',trigger:'hover',delay:{'show':1000,'hide':100},placement:'bottom',title:_t("Readonly field")}).on('click',function(){$(this).tooltip('hide');});$(document).trigger('mousedown');this.trigger('rte:start');return this._super.apply(this,arguments);},destroy:function(){this.cancel();this._super.apply(this,arguments);},cancel:function(){if(this.$last){this.$last.destroy();this.$last=null;}
$.fn.carousel=this.init_bootstrap_carousel;$(document).off('.rte');$('#wrapwrap, .o_editable').off('.rte');$('.o_not_editable').removeAttr('contentEditable');$(document).off('click.rte keyup.rte mousedown.rte activate.rte mouseup.rte');$(document).off('content_changed').removeClass('o_is_inline_editable').removeData('rte');$(document).tooltip('dispose');$('body').removeClass('editor_enable');this.trigger('rte:stop');},editable:function(){return $('#wrapwrap [data-oe-model]').not('.o_not_editable').filter(function(){return!$(this).closest('.o_not_editable').length;}).not('link, script').not('[data-oe-readonly]').not('img[data-oe-field="arch"], br[data-oe-field="arch"], input[data-oe-field="arch"]').not('.oe_snippet_editor').add('.o_editable');},historyRecordUndo:function($target,event,internal_history){$target=$($target);var rng=range.create();var $editable=$(rng&&rng.sc).closest('.o_editable');if(!rng||!$editable.length){$editable=$target.closest('.o_editable');rng=range.create($target.closest('*')[0],0);}else{rng=$editable.data('range')||rng;}
try{rng.select();}catch(e){console.log('error',e);}
history.recordUndo($editable,event,internal_history);},save:function(context){var self=this;$('.o_editable').destroy().removeClass('o_editable o_is_inline_editable');var $dirty=$('.o_dirty');$dirty.removeAttr('contentEditable').removeClass('o_dirty oe_carlos_danger o_is_inline_editable');var defs=_.map($dirty,function(el){var $el=$(el);$el.find('[class]').filter(function(){if(!this.getAttribute('class').match(/\S/)){this.removeAttribute('class');}});return self.saving_mutex.exec(function(){return self._saveElement($el,context||weContext.get()).then(function(){$el.removeClass('o_dirty');},function(response){var id=_.uniqueId('carlos_danger_');$el.addClass('o_dirty oe_carlos_danger '+id);var html=(response.data.exception_type==='except_osv');if(html){var msg=$('<div/>',{text:response.data.message}).html();var data=msg.substring(3,msg.length-2).split(/', u'/);response.data.message='<b>'+data[0]+'</b>'+data[1];}
$('.o_editable.'+id).removeClass(id).popover({html:html,trigger:'hover',content:response.data.message,placement:'auto top',}).popover('show');});});});return Promise.all(defs).then(function(){window.onbeforeunload=null;},function(failed){self.cancel();self.start();});},_enableEditableArea:function($editable){if($editable.data('oe-type')==="monetary"){$editable.attr('contenteditable',false);$editable.find('.oe_currency_value').attr('contenteditable',true);}
if($editable.is('[data-oe-model]')&&!$editable.is('[data-oe-model="ir.ui.view"]')&&!$editable.is('[data-oe-type="html"]')){$editable.data('layoutInfo').popover().find('.btn-group:not(.note-history)').remove();}},_getDefaultConfig:function($editable){return{'airMode':true,'focus':false,'airPopover':[['style',['style']],['font',['bold','italic','underline','clear']],['fontsize',['fontsize']],['color',['color']],['para',['ul','ol','paragraph']],['table',['table']],['insert',['link','picture']],['history',['undo','redo']],],'styleWithSpan':false,'inlinemedia':['p'],'lang':'odoo','onChange':function(html,$editable){$editable.trigger('content_changed');},'colors':summernoteCustomColors,};},_getEscapedElement:function($el){var escaped_el=$el.clone();var to_escape=escaped_el.find('*').addBack();to_escape=to_escape.not(to_escape.filter('object,iframe,script,style,[data-oe-model][data-oe-model!="ir.ui.view"]').find('*').addBack());to_escape.contents().each(function(){if(this.nodeType===3){this.nodeValue=$('<div />').text(this.nodeValue).html();}});return escaped_el;},_saveElement:function($el,context,withLang){return this._rpc({model:'ir.ui.view',method:'save',args:[$el.data('oe-id'),this._getEscapedElement($el).prop('outerHTML'),$el.data('oe-xpath')||null,],context:context,},withLang?undefined:{noContextKeys:'lang',});},_onClick:function(e){e.preventDefault();},_onMousedown:function(ev){var $target=$(ev.target);var $editable=$target.closest('.o_editable');if(!$editable.length||$.summernote.core.dom.isContentEditableFalse($target)){return;}
_.defer(function(){$editable.find('[_moz_abspos]').removeAttr('_moz_abspos');});if($target.is('a')){$target.attr('contenteditable',true);_.defer(function(){$editable.not($target).attr('contenteditable',false);$target.focus();});$(document).on('mousedown.reactivate_contenteditable',function(e){if($target.is(e.target))return;$target.removeAttr('contenteditable');$editable.attr('contenteditable',true);$(document).off('mousedown.reactivate_contenteditable');});}
if(this&&this.$last&&(!$editable.length||this.$last[0]!==$editable[0])){var $destroy=this.$last;history.splitNext();_.delay(function(){var id=$destroy.data('note-id');$destroy.destroy().removeData('note-id').removeAttr('data-note-id');$('#note-popover-'+id+', #note-handle-'+id+', #note-dialog-'+id+'').remove();},150);this.$last=null;}
if($editable.length&&(!this.$last||this.$last[0]!==$editable[0])){$editable.summernote(this._getConfig($editable));$editable.data('NoteHistory',history);this.$last=$editable;try{document.execCommand('enableObjectResizing',false,false);document.execCommand('enableInlineTableEditing',false,false);document.execCommand('2D-position',false,false);}catch(e){}
document.body.addEventListener('resizestart',function(evt){evt.preventDefault();return false;});document.body.addEventListener('movestart',function(evt){evt.preventDefault();return false;});document.body.addEventListener('dragstart',function(evt){evt.preventDefault();return false;});if(!range.create()){$editable.focusIn();}
if(dom.isImg($target[0])){$target.trigger('mousedown');}
this._enableEditableArea($editable);}},_onMouseup:function(ev){var $target=$(ev.target);var $editable=$target.closest('.o_editable');if(!$editable.length){return;}
var self=this;_.defer(function(){self.historyRecordUndo($target,'activate',true);});if(ev.originalEvent.detail===3){range.create(ev.target,0,ev.target,ev.target.childNodes.length).select();}},});return{Class:RTEWidget,history:history,};});odoo.define('web_editor.rte.summernote_custom_colors',function(require){'use strict';return[['#000000','#424242','#636363','#9C9C94','#CEC6CE','#EFEFEF','#F7F7F7','#FFFFFF'],['#FF0000','#FF9C00','#FFFF00','#00FF00','#00FFFF','#0000FF','#9C00FF','#FF00FF'],['#F7C6CE','#FFE7CE','#FFEFC6','#D6EFD6','#CEDEE7','#CEE7F7','#D6D6E7','#E7D6DE'],['#E79C9C','#FFC69C','#FFE79C','#B5D6A5','#A5C6CE','#9CC6EF','#B5A5D6','#D6A5BD'],['#E76363','#F7AD6B','#FFD663','#94BD7B','#73A5AD','#6BADDE','#8C7BC6','#C67BA5'],['#CE0000','#E79439','#EFC631','#6BA54A','#4A7B8C','#3984C6','#634AA5','#A54A7B'],['#9C0000','#B56308','#BD9400','#397B21','#104A5A','#085294','#311873','#731842'],['#630000','#7B3900','#846300','#295218','#083139','#003163','#21104A','#4A1031']];});;

/* /web_editor/static/src/js/editor/rte.summernote.js defined in bundle 'web_editor.assets_wysiwyg' */
odoo.define('web_editor.rte.summernote',function(require){'use strict';var ajax=require('web.ajax');var Class=require('web.Class');var core=require('web.core');var ColorpickerDialog=require('web.ColorpickerDialog');var mixins=require('web.mixins');var fonts=require('wysiwyg.fonts');var weContext=require('web_editor.context');var rte=require('web_editor.rte');var weWidgets=require('wysiwyg.widgets');var QWeb=core.qweb;var _t=core._t;ajax.jsonRpc('/web/dataset/call','call',{'model':'ir.ui.view','method':'read_template','args':['web_editor.colorpicker'],'kwargs':{'context':weContext.get(),}}).then(function(data){QWeb.add_template('<templates>'+data+'</templates>');});var dom=$.summernote.core.dom;var range=$.summernote.core.range;var eventHandler=$.summernote.eventHandler;var renderer=$.summernote.renderer;var tplButton=renderer.getTemplate().button;var tplIconButton=renderer.getTemplate().iconButton;var tplDropdown=renderer.getTemplate().dropdown;function _rgbToHex(cssColor){var rgba=cssColor.match(/^rgba?\((\d+),\s*(\d+),\s*(\d+)(?:,\s*(\d+(?:\.\d+)?))?\)$/);if(!rgba){return cssColor;}
if(rgba[4]){return cssColor;}
var hex=ColorpickerDialog.convertRgbToHex(parseInt(rgba[1]),parseInt(rgba[2]),parseInt(rgba[3]));if(!hex){return cssColor;}
return hex.hex.toUpperCase();}
var fn_createPalette=renderer.createPalette;renderer.createPalette=function($container,options){fn_createPalette.call(this,$container,options);if(!QWeb.has_template('web_editor.colorpicker')){return;}
var $clpicker=$(QWeb.render('web_editor.colorpicker'));var groups;if($clpicker.is("colorpicker")){groups=_.map($clpicker.find('[data-name="theme"]'),function(el){return $(el).find("button").empty();});}else{groups=[$clpicker.find("button").empty()];}
var html="<h6 class='mt-2'>"+_t("Theme colors")+"</h6>"+_.map(groups,function($group){var $row=$("<div/>",{"class":"note-color-row mb8"}).append($group);var $after_breaks=$row.find(".o_small + :not(.o_small)");if($after_breaks.length===0){$after_breaks=$row.find(":nth-child(8n+9)");}
$after_breaks.addClass("o_clear");return $row[0].outerHTML;}).join("")+"<h6 class='mt-2'>"+_t("Common colors")+"</h6>";var $palettes=$container.find(".note-color .note-color-palette");$palettes.prepend(html);var colors=[];var $editable=window.__EditorMenuBar_$editable||$();_.each($editable.find('[style*="color"]'),function(element){if(element.style.color){colors.push(element.style.color);}
if(element.style.backgroundColor){colors.push(element.style.backgroundColor);}});var $customColorPalettes=$container.find('.note-color .note-custom-color-palette').append($('<div/>',{class:"note-color-row"}));var $customColorRows=$customColorPalettes.find('.note-color-row');_.each(_.uniq(colors),function(color){var hexColor=_rgbToHex(color);if(_.indexOf(_.flatten(options.colors),hexColor)<0){$customColorRows.append('<button type="button" class="o_custom_color" data-color="'+color+'" style="background-color:'+color+';" />');}});$palettes.push.apply($palettes,$customColorPalettes);var $forePalette=$palettes.filter(":even").closest('li').addClass('note-palette');var $bgPalette=$palettes.filter(":odd").closest('li').addClass('note-palette');$forePalette.add($bgPalette).find('.note-color-reset').remove();$forePalette.children().each(function(){var $reset=$('<div class="note-color-reset" data-event="foreColor" data-value="inherit"></div>').text(_t('Reset to default'));$(this).prepend($reset);})
$bgPalette.children().each(function(){var $reset=$('<div class="note-color-reset" data-event="backColor" data-value="inherit"></div>').text(_t('Reset to default'));$(this).prepend($reset);})
var $fore=$forePalette.find("button:not(.note-color-btn)").addClass("note-color-btn");$fore.each(function(){var $el=$(this);var className=$el.hasClass('o_custom_color')?$el.data('color'):'text-'+$el.data('color');$el.attr('data-event','foreColor').attr('data-value',className).addClass($el.hasClass('o_custom_color')?'':'bg-'+$el.data('color'));});var $bg=$bgPalette.find("button:not(.note-color-btn)").addClass("note-color-btn");$bg.each(function(){var $el=$(this);var className=$el.hasClass('o_custom_color')?$el.data('color'):'bg-'+$el.data('color');$el.attr('data-event','backColor').attr('data-value',className).addClass($el.hasClass('o_custom_color')?'':className);});};var fn_tplPopovers=renderer.tplPopovers;renderer.tplPopovers=function(lang,options){var $popover=$(fn_tplPopovers.call(this,lang,options));var $imagePopover=$popover.find('.note-image-popover');var $linkPopover=$popover.find('.note-link-popover');var $airPopover=$popover.find('.note-air-popover');$(tplIconButton('fa fa-align-center',{title:_t('Center'),event:'floatMe',value:'center'})).insertAfter($imagePopover.find('[data-event="floatMe"][data-value="left"]'));$imagePopover.find('button[data-event="removeMedia"]').parent().remove();$imagePopover.find('button[data-event="floatMe"][data-value="none"]').remove();var $padding=$('<div class="btn-group"/>');$padding.insertBefore($imagePopover.find('.btn-group:first'));var dropdown_content=['<li><a class="dropdown-item" data-event="padding" href="#" data-value="">'+_t('None')+'</a></li>','<li><a class="dropdown-item" data-event="padding" href="#" data-value="small">'+_t('Small')+'</a></li>','<li><a class="dropdown-item" data-event="padding" href="#" data-value="medium">'+_t('Medium')+'</a></li>','<li><a class="dropdown-item" data-event="padding" href="#" data-value="large">'+_t('Large')+'</a></li>','<li><a class="dropdown-item" data-event="padding" href="#" data-value="xl">'+_t('Xl')+'</a></li>',];$(tplIconButton('fa fa-plus-square-o',{title:_t('Padding'),dropdown:tplDropdown(dropdown_content)})).appendTo($padding);$imagePopover.find('[data-event="imageShape"]:not([data-value])').remove();var $button=$(tplIconButton('fa fa-sun-o',{title:_t('Shadow'),event:'imageShape',value:'shadow'})).insertAfter($imagePopover.find('[data-event="imageShape"][data-value="rounded-circle"]'));var $spin=$('<div class="btn-group d-none only_fa"/>').insertAfter($button.parent());$(tplIconButton('fa fa-refresh',{title:_t('Spin'),event:'imageShape',value:'fa-spin'})).appendTo($spin);var $resizefa=$('<div class="btn-group d-none only_fa"/>').insertAfter($imagePopover.find('.btn-group:has([data-event="resize"])'));for(var size=1;size<=5;size++){$(tplButton('<span class="note-fontsize-10">'+size+'x</span>',{title:size+"x",event:'resizefa',value:size+''})).appendTo($resizefa);}
var $colorfa=$airPopover.find('.note-color').clone();$colorfa.find(".dropdown-menu").css('min-width','172px');$resizefa.after($colorfa);var $imageprop=$('<div class="btn-group"/>');$imageprop.appendTo($imagePopover.find('.popover-body'));$(tplIconButton('fa fa-file-image-o',{title:_t('Edit'),event:'showImageDialog'})).appendTo($imageprop);$(tplIconButton('fa fa-trash-o',{title:_t('Remove'),event:'delete'})).appendTo($imageprop);$(tplIconButton('fa fa-crop',{title:_t('Crop Image'),event:'cropImage',})).insertAfter($imagePopover.find('[data-event="imageShape"][data-value="img-thumbnail"]'));$imagePopover.find('.popover-body').append($airPopover.find(".note-history").clone());$imagePopover.find('[data-event="showImageDialog"]').before($airPopover.find('[data-event="showLinkDialog"]').clone());var $alt=$('<div class="btn-group"/>');$alt.appendTo($imagePopover.find('.popover-body'));$alt.append('<button class="btn btn-secondary" data-event="alt"><strong>'+_t('Description')+': </strong><span class="o_image_alt"/></button>');$linkPopover.find('.popover-body').append($airPopover.find(".note-history").clone());$linkPopover.find('button[data-event="showLinkDialog"] i').attr("class","fa fa-link");$linkPopover.find('button[data-event="unlink"]').before($airPopover.find('button[data-event="showImageDialog"]').clone());$airPopover.find('.note-style .dropdown-toggle').on('mousedown',function(){var $format=$airPopover.find('[data-event="formatBlock"]');var node=range.create().sc;var formats=$format.map(function(){return $(this).data("value");}).get();while(node&&(!node.tagName||(!node.tagName||formats.indexOf(node.tagName.toLowerCase())===-1))){node=node.parentNode;}
$format.removeClass('active');$format.filter('[data-value="'+(node?node.tagName.toLowerCase():"p")+'"]').addClass("active");});setTimeout(function(){$airPopover.add($linkPopover).add($imagePopover).find("button").tooltip('dispose').tooltip({container:'body',trigger:'hover',placement:'bottom'}).on('click',function(){$(this).tooltip('hide');});});return $popover;};var fn_boutton_update=eventHandler.modules.popover.button.update;eventHandler.modules.popover.button.update=function($container,oStyle){var previous=$(".note-control-selection").data('target');if(previous){var $previous=$(previous);$previous.css({"-webkit-animation-play-state":"","animation-play-state":"","-webkit-transition":"","transition":"","-webkit-animation":"","animation":""});$previous.find('.o_we_selected_image').addBack('.o_we_selected_image').removeClass('o_we_selected_image');}
fn_boutton_update.call(this,$container,oStyle);$container.find('.note-color').removeClass('d-none');if(oStyle.image){$container.find('[data-event]').removeClass("active");$container.find('a[data-event="padding"][data-value="small"]').toggleClass("active",$(oStyle.image).hasClass("padding-small"));$container.find('a[data-event="padding"][data-value="medium"]').toggleClass("active",$(oStyle.image).hasClass("padding-medium"));$container.find('a[data-event="padding"][data-value="large"]').toggleClass("active",$(oStyle.image).hasClass("padding-large"));$container.find('a[data-event="padding"][data-value="xl"]').toggleClass("active",$(oStyle.image).hasClass("padding-xl"));$container.find('a[data-event="padding"][data-value=""]').toggleClass("active",!$container.find('li a.active[data-event="padding"]').length);$(oStyle.image).addClass('o_we_selected_image');if(dom.isImgFont(oStyle.image)){$container.find('[data-event="customColor"][data-value="foreColor"]').attr('data-color',$(oStyle.image).css('color'));$container.find('[data-event="customColor"][data-value="backColor"]').attr('data-color',$(oStyle.image).css('background-color'));$container.find('.note-fore-color-preview > button').css('border-bottom-color',$(oStyle.image).css('color'));$container.find('.note-back-color-preview > button').css('border-bottom-color',$(oStyle.image).css('background-color'));$container.find('.btn-group:not(.only_fa):has(button[data-event="resize"],button[data-value="img-thumbnail"])').addClass('d-none');$container.find('.only_fa').removeClass('d-none');$container.find('button[data-event="resizefa"][data-value="2"]').toggleClass("active",$(oStyle.image).hasClass("fa-2x"));$container.find('button[data-event="resizefa"][data-value="3"]').toggleClass("active",$(oStyle.image).hasClass("fa-3x"));$container.find('button[data-event="resizefa"][data-value="4"]').toggleClass("active",$(oStyle.image).hasClass("fa-4x"));$container.find('button[data-event="resizefa"][data-value="5"]').toggleClass("active",$(oStyle.image).hasClass("fa-5x"));$container.find('button[data-event="resizefa"][data-value="1"]').toggleClass("active",!$container.find('.active[data-event="resizefa"]').length);$container.find('button[data-event="imageShape"][data-value="fa-spin"]').toggleClass("active",$(oStyle.image).hasClass("fa-spin"));$container.find('button[data-event="imageShape"][data-value="shadow"]').toggleClass("active",$(oStyle.image).hasClass("shadow"));$container.find('.btn-group:has(button[data-event="imageShape"])').removeClass("d-none");}else{$container.find('.d-none:not(.only_fa, .note-recent-color)').removeClass('d-none');$container.find('.only_fa').addClass('d-none');var width=($(oStyle.image).attr('style')||'').match(/(^|;|\s)width:\s*([0-9]+%)/);if(width){width=width[2];}
$container.find('button[data-event="resize"][data-value="auto"]').toggleClass("active",width!=="100%"&&width!=="50%"&&width!=="25%");$container.find('button[data-event="resize"][data-value="1"]').toggleClass("active",width==="100%");$container.find('button[data-event="resize"][data-value="0.5"]').toggleClass("active",width==="50%");$container.find('button[data-event="resize"][data-value="0.25"]').toggleClass("active",width==="25%");$container.find('button[data-event="imageShape"][data-value="shadow"]').toggleClass("active",$(oStyle.image).hasClass("shadow"));if(!$(oStyle.image).is("img")){$container.find('.btn-group:has(button[data-event="imageShape"])').addClass('d-none');}
$container.find('.note-color').addClass('d-none');}
$container.find('button[data-event="floatMe"][data-value="left"]').toggleClass("active",$(oStyle.image).hasClass("float-left"));$container.find('button[data-event="floatMe"][data-value="center"]').toggleClass("active",$(oStyle.image).hasClass("d-block mx-auto"));$container.find('button[data-event="floatMe"][data-value="right"]').toggleClass("active",$(oStyle.image).hasClass("float-right"));$(oStyle.image).trigger('attributes_change');}else{$container.find('[data-event="customColor"][data-value="foreColor"]').attr('data-color',oStyle.color);$container.find('[data-event="customColor"][data-value="backColor"]').attr('data-color',oStyle['background-color']);$container.find('.note-fore-color-preview > button').css('border-bottom-color',oStyle.color);$container.find('.note-back-color-preview > button').css('border-bottom-color',oStyle['background-color']);}};var fn_toolbar_boutton_update=eventHandler.modules.toolbar.button.update;eventHandler.modules.toolbar.button.update=function($container,oStyle){fn_toolbar_boutton_update.call(this,$container,oStyle);$container.find('button[data-event="insertUnorderedList"]').toggleClass("active",$(oStyle.ancestors).is('ul:not(.o_checklist)'));$container.find('button[data-event="insertOrderedList"]').toggleClass("active",$(oStyle.ancestors).is('ol'));$container.find('button[data-event="insertCheckList"]').toggleClass("active",$(oStyle.ancestors).is('ul.o_checklist'));};var fn_popover_update=eventHandler.modules.popover.update;eventHandler.modules.popover.update=function($popover,oStyle,isAirMode){var $imagePopover=$popover.find('.note-image-popover');var $linkPopover=$popover.find('.note-link-popover');var $airPopover=$popover.find('.note-air-popover');fn_popover_update.call(this,$popover,oStyle,isAirMode);if(oStyle.image){if(oStyle.image.parentNode.className.match(/(^|\s)media_iframe_video(\s|$)/i)){oStyle.image=oStyle.image.parentNode;}
var alt=$(oStyle.image).attr("alt");$imagePopover.find('.o_image_alt').text((alt||"").replace(/&quot;/g,'"')).parent().toggle(oStyle.image.tagName==="IMG");$imagePopover.show();var target_node=oStyle.image;if(!oStyle.image.className.match(/(^|\s)media_iframe_video(\s|$)/i)){target_node=dom.firstChild(target_node);}
range.createFromNode(target_node).select();eventHandler.modules.editor.saveRange(dom.makeLayoutInfo(target_node).editable());}else{$(".note-control-selection").hide();}
if(oStyle.image||(oStyle.range&&(!oStyle.range.isCollapsed()||(oStyle.range.sc.tagName&&!dom.isAnchor(oStyle.range.sc))))||(oStyle.image&&!$(oStyle.image).closest('a').length)){$linkPopover.hide();oStyle.anchor=false;}
if(oStyle.image||oStyle.anchor||(oStyle.range&&!$(oStyle.range.sc).closest('.note-editable').length)){$airPopover.hide();}else{$airPopover.show();}};var fn_handle_update=eventHandler.modules.handle.update;eventHandler.modules.handle.update=function($handle,oStyle,isAirMode){fn_handle_update.call(this,$handle,oStyle,isAirMode);if(oStyle.image){$handle.find('.note-control-selection').hide();}};function getImgTarget($editable){var $handle=$editable?dom.makeLayoutInfo($editable).handle():undefined;return $(".note-control-selection",$handle).data('target');}
eventHandler.modules.editor.padding=function($editable,sValue){var $target=$(getImgTarget($editable));var paddings="small medium large xl".split(/\s+/);$editable.data('NoteHistory').recordUndo();if(sValue.length){paddings.splice(paddings.indexOf(sValue),1);$target.toggleClass('padding-'+sValue);}
$target.removeClass("padding-"+paddings.join(" padding-"));};eventHandler.modules.editor.resize=function($editable,sValue){var $target=$(getImgTarget($editable));$editable.data('NoteHistory').recordUndo();var width=($target.attr('style')||'').match(/(^|;|\s)width:\s*([0-9]+)%/);if(width){width=width[2]/100;}
$target.css('width',(width!==sValue&&sValue!=="auto")?(sValue*100)+'%':'');};eventHandler.modules.editor.resizefa=function($editable,sValue){var $target=$(getImgTarget($editable));$editable.data('NoteHistory').recordUndo();$target.attr('class',$target.attr('class').replace(/\s*fa-[0-9]+x/g,''));if(+sValue>1){$target.addClass('fa-'+sValue+'x');}};eventHandler.modules.editor.floatMe=function($editable,sValue){var $target=$(getImgTarget($editable));$editable.data('NoteHistory').recordUndo();switch(sValue){case'center':$target.toggleClass('d-block mx-auto').removeClass('float-right float-left');break;case'left':$target.toggleClass('float-left').removeClass('float-right d-block mx-auto');break;case'right':$target.toggleClass('float-right').removeClass('float-left d-block mx-auto');break;}};eventHandler.modules.editor.imageShape=function($editable,sValue){var $target=$(getImgTarget($editable));$editable.data('NoteHistory').recordUndo();$target.toggleClass(sValue);};eventHandler.modules.linkDialog.showLinkDialog=function($editable,$dialog,linkInfo){$editable.data('range').select();$editable.data('NoteHistory').recordUndo();var def=new $.Deferred();core.bus.trigger('link_dialog_demand',{$editable:$editable,linkInfo:linkInfo,onSave:function(linkInfo){linkInfo.range.select();$editable.data('range',linkInfo.range);def.resolve(linkInfo);$editable.trigger('keyup');$('.note-popover .note-link-popover').show();},onCancel:def.reject.bind(def),});return def;};eventHandler.modules.imageDialog.showImageDialog=function($editable){var r=$editable.data('range');if(r.sc.tagName&&r.sc.childNodes.length){r.sc=r.sc.childNodes[r.so];}
var media=$(r.sc).parents().addBack().filter(function(i,el){return dom.isImg(el);})[0];core.bus.trigger('media_dialog_demand',{$editable:$editable,media:media,options:{lastFilters:['background'],onUpload:$editable.data('callbacks').onUpload,noVideos:$editable.data('oe-model')==="mail.compose.message",},onSave:function(media){if(!document.body.contains(media)){r.insertNode(media);};},});return new $.Deferred().reject();};$.summernote.pluginEvents.alt=function(event,editor,layoutInfo,sorted){var $editable=layoutInfo.editable();var $selection=layoutInfo.handle().find('.note-control-selection');core.bus.trigger('alt_dialog_demand',{$editable:$editable,media:$selection.data('target'),});};$.summernote.pluginEvents.customColor=function(event,editor,layoutInfo,customColor){var defaultColor=event.target.dataset.color;core.bus.trigger('color_picker_dialog_demand',{color:defaultColor==='rgba(0, 0, 0, 0)'?'rgb(255, 0, 0)':defaultColor,onSave:function(color){var $palettes=$(event.currentTarget).find('.note-custom-color-palette > .note-color-row').append(('<button type="button" class="note-color-btn" data-value="'+color+'" style="background-color:'+color+';" />'));$palettes.filter(':odd').find('button:not([data-event])').attr('data-event','backColor');$palettes.filter(':even').find('button:not([data-event])').attr('data-event','foreColor');if(customColor==='foreColor'){$(event.currentTarget).find('.note-fore-color-preview > button').css('border-bottom-color',color);$.summernote.pluginEvents.foreColor(event,editor,layoutInfo,color);}else{$(event.currentTarget).find('.note-back-color-preview > button').css('border-bottom-color',color);$.summernote.pluginEvents.backColor(event,editor,layoutInfo,color);}}});};$.summernote.pluginEvents.cropImage=function(event,editor,layoutInfo,sorted){var $editable=layoutInfo.editable();var $selection=layoutInfo.handle().find('.note-control-selection');core.bus.trigger('crop_image_dialog_demand',{$editable:$editable,media:$selection.data('target'),});};var fn_is_void=dom.isVoid||function(){};dom.isVoid=function(node){return fn_is_void(node)||dom.isImgFont(node)||(node&&node.className&&node.className.match(/(^|\s)media_iframe_video(\s|$)/i));};var fn_is_img=dom.isImg||function(){};dom.isImg=function(node){return fn_is_img(node)||dom.isImgFont(node)||(node&&(node.nodeName==="IMG"||(node.className&&node.className.match(/(^|\s)(media_iframe_video|o_image)(\s|$)/i))));};var fn_is_forbidden_node=dom.isForbiddenNode||function(){};dom.isForbiddenNode=function(node){if(node.tagName==="BR"){return false;}
return fn_is_forbidden_node(node)||$(node).is(".media_iframe_video");};var fn_is_img_font=dom.isImgFont||function(){};dom.isImgFont=function(node){if(fn_is_img_font(node))return true;var nodeName=node&&node.nodeName.toUpperCase();var className=(node&&node.className||"");if(node&&(nodeName==="SPAN"||nodeName==="I")&&className.length){var classNames=className.split(/\s+/);for(var k=0;k<fonts.fontIcons.length;k++){if(_.intersection(fonts.fontIcons[k].alias,classNames).length){return true;}}}
return false;};var fn_is_font=dom.isFont;dom.isFont=function(node){return fn_is_font(node)||dom.isImgFont(node);};var fn_visible=$.summernote.pluginEvents.visible;$.summernote.pluginEvents.visible=function(event,editor,layoutInfo){var res=fn_visible.apply(this,arguments);var rng=range.create();if(!rng)return res;var $node=$(dom.node(rng.sc));if(($node.is('[data-oe-type="html"]')||$node.is('[data-oe-field="arch"]'))&&$node.hasClass("o_editable")&&!$node[0].children.length&&"h1 h2 h3 h4 h5 h6 p b bold i u code sup strong small pre th td span label".toUpperCase().indexOf($node[0].nodeName)===-1){var p=$('<p><br/></p>')[0];$node.append(p);range.createFromNode(p.firstChild).select();}
return res;};function prettify_html(html){html=html.trim();var result='',level=0,get_space=function(level){var i=level,space='';while(i--)space+='  ';return space;},reg=/^<\/?(a|span|font|u|em|i|strong|b)(\s|>)/i,inline_level=Infinity,tokens=_.compact(_.flatten(_.map(html.split(/</),function(value){value=value.replace(/\s+/g,' ').split(/>/);value[0]=/\S/.test(value[0])?'<'+value[0]+'>':'';return value;})));for(var i=0,l=tokens.length;i<l;i++){var token=tokens[i];var inline_tag=reg.test(token);var inline=inline_tag||inline_level<=level;if(token[0]==='<'&&token[1]==='/'){if(inline_tag&&inline_level===level){inline_level=Infinity;}
level--;}
if(!inline&&!/\S/.test(token)){continue;}
if(!inline||(token[1]!=='/'&&inline_level>level)){result+=get_space(level);}
if(token[0]==='<'&&token[1]!=='/'){level++;if(inline_tag&&inline_level>level){inline_level=level;}}
if(token.match(/^<(img|hr|br)/)){level--;}
if(!inline){token=token.trim();}
result+=token.replace(/\s+/,' ');if(inline_level>level){result+='\n';}}
return result;}
$.summernote.pluginEvents.codeview=function(event,editor,layoutInfo,enable){if(layoutInfo===undefined){return;}
if(layoutInfo.toolbar){var is_activated=$.summernote.eventHandler.modules.codeview.isActivated(layoutInfo);if(is_activated===enable){return;}
return eventHandler.modules.codeview.toggle(layoutInfo);}else{var $editor=layoutInfo.editor();var $textarea=$editor.prev('textarea');if($textarea.is('textarea')===enable){return;}
if(!$textarea.length){var html=prettify_html($editor.prop("innerHTML"));$editor.parent().css({'position':'absolute','top':0,'bottom':0,'left':0,'right':0});$textarea=$('<textarea/>').css({'margin':'0 -4px','padding':'0 4px','border':0,'top':'51px','left':'620px','width':'100%','font-family':'sans-serif','font-size':'13px','height':'98%','white-space':'pre','word-wrap':'normal'}).val(html).data('init',html);$editor.before($textarea);$editor.hide();}else{$editor.prop('innerHTML',$textarea.val().replace(/\s*\n\s*/g,'')).trigger('content_changed');$textarea.remove();$editor.show();}}};var last_div;var last_div_change;var last_editable;var initial_data={};function reRangeSelectKey(event){initial_data.range=null;if(event.shiftKey&&event.keyCode>=37&&event.keyCode<=40&&!$(event.target).is("input, textarea, select")){var r=range.create();if(r){var rng=r.reRange(event.keyCode<=38);if(r!==rng){rng.select();}}}}
function reRangeSelect(event,dx,dy){var r=range.create();if(!r||r.isCollapsed())return;var data=r.reRange(dy<0||(dy===0&&dx<0));if(data.sc!==r.sc||data.so!==r.so||data.ec!==r.ec||data.eo!==r.eo){setTimeout(function(){data.select();$(data.sc.parentNode).closest('.note-popover');},0);}
$(data.sc).closest('.o_editable').data('range',r);return r;}
function summernote_mouseup(event){if($(event.target).closest("#web_editor-top-navbar, .note-popover").length){return;}
if(initial_data.event){var dx=event.clientX-(event.shiftKey&&initial_data.rect?initial_data.rect.left:initial_data.event.clientX);var dy=event.clientY-(event.shiftKey&&initial_data.rect?initial_data.rect.top:initial_data.event.clientY);if(10<Math.pow(dx,2)+Math.pow(dy,2)){reRangeSelect(event,dx,dy);}}
if(!$(event.target).closest(".o_editable").length){return;}
if(!initial_data.range||!event.shiftKey){setTimeout(function(){initial_data.range=range.create();},0);}}
var remember_selection;function summernote_mousedown(event){rte.history.splitNext();var $editable=$(event.target).closest(".o_editable, .note-editor");var r;if(document.documentMode){summernote_ie_fix(event,function(node){return node.tagName==="DIV"||node.tagName==="IMG"||(node.dataset&&node.dataset.oeModel);});}else if(last_div&&event.target!==last_div){if(last_div.tagName==="A"){summernote_ie_fix(event,function(node){return node.dataset&&node.dataset.oeModel;});}else if($editable.length){if(summernote_ie_fix(event,function(node){return node.tagName==="A";})){r=range.create();r.select();}}}
try{r=range.create();}catch(e){return;}
var editables=$(".o_editable[contenteditable], .note-editable[contenteditable]");var r_editable=editables.has((r||{}).sc).addBack(editables.filter((r||{}).sc));if(!r_editable.closest('.note-editor').is($editable)&&!r_editable.filter('.o_editable').is(editables)){var saved_editable=editables.has((remember_selection||{}).sc);if($editable.length&&!saved_editable.closest('.o_editable, .note-editor').is($editable)){remember_selection=range.create(dom.firstChild($editable[0]),0);}else if(!saved_editable.length){remember_selection=undefined;}
if(remember_selection){try{remember_selection.select();}catch(e){console.warn(e);}}}else if(r_editable.length){remember_selection=r;}
initial_data.event=event;if(event.shiftKey&&$editable.length){if(initial_data.range){initial_data.range.select();}
var rect=r&&r.getClientRects();initial_data.rect=rect&&rect.length?rect[0]:{top:0,left:0};}}
function summernote_ie_fix(event,pred){var editable;var div;var node=event.target;while(node.parentNode){if(!div&&pred(node)){div=node;}
if(last_div!==node&&(node.getAttribute('contentEditable')==='false'||node.className&&(node.className.indexOf('o_not_editable')!==-1))){break;}
if(node.className&&node.className.indexOf('o_editable')!==-1){if(!div){div=node;}
editable=node;break;}
node=node.parentNode;}
if(!editable){$(last_div_change).removeAttr("contentEditable").removeProp("contentEditable");$(last_editable).attr("contentEditable","true").prop("contentEditable","true");last_div_change=null;last_editable=null;return;}
if(div===last_div){return;}
last_div=div;$(last_div_change).removeAttr("contentEditable").removeProp("contentEditable");if(last_editable!==editable){if($(editable).is("[contentEditable='true']")){$(editable).removeAttr("contentEditable").removeProp("contentEditable");last_editable=editable;}else{last_editable=null;}}
if(!$(div).attr("contentEditable")&&!$(div).is("[data-oe-type='many2one'], [data-oe-type='contact']")){$(div).attr("contentEditable","true").prop("contentEditable","true");last_div_change=div;}else{last_div_change=null;}
return editable!==div?div:null;}
var fn_attach=eventHandler.attach;eventHandler.attach=function(oLayoutInfo,options){fn_attach.call(this,oLayoutInfo,options);oLayoutInfo.editor().on('dragstart','img',function(e){e.preventDefault();});$(document).on('mousedown',summernote_mousedown).on('mouseup',summernote_mouseup);oLayoutInfo.editor().off('click').on('click',function(e){e.preventDefault();});create_dblclick_feature("img, .media_iframe_video, i.fa, span.fa, a.o_image",function(){eventHandler.modules.imageDialog.show(oLayoutInfo);});create_dblclick_feature("a[href], a.btn, button.btn",function(){eventHandler.modules.linkDialog.show(oLayoutInfo);});oLayoutInfo.editable().on('mousedown',function(e){if(dom.isImg(e.target)&&dom.isContentEditable(e.target)){range.createFromNode(e.target).select();}});$(document).on("keyup",reRangeSelectKey);var clone_data=false;if(options.model){oLayoutInfo.editable().data({'oe-model':options.model,'oe-id':options.id});}
if(options.getMediaDomain){oLayoutInfo.editable().data('oe-media-domain',options.getMediaDomain);}
var $node=oLayoutInfo.editor();if($node.data('oe-model')||$node.data('oe-translation-id')){$node.on('content_changed',function(){var $nodes=$('[data-oe-model], [data-oe-translation-id]').filter(function(){return this!==$node[0];});if($node.data('oe-model')){$nodes=$nodes.filter('[data-oe-model="'+$node.data('oe-model')+'"]').filter('[data-oe-id="'+$node.data('oe-id')+'"]').filter('[data-oe-field="'+$node.data('oe-field')+'"]');}
if($node.data('oe-translation-id'))$nodes=$nodes.filter('[data-oe-translation-id="'+$node.data('oe-translation-id')+'"]');if($node.data('oe-type'))$nodes=$nodes.filter('[data-oe-type="'+$node.data('oe-type')+'"]');if($node.data('oe-expression'))$nodes=$nodes.filter('[data-oe-expression="'+$node.data('oe-expression')+'"]');if($node.data('oe-xpath'))$nodes=$nodes.filter('[data-oe-xpath="'+$node.data('oe-xpath')+'"]');if($node.data('oe-contact-options'))$nodes=$nodes.filter('[data-oe-contact-options="'+$node.data('oe-contact-options')+'"]');var nodes=$node.get();if($node.data('oe-type')==="many2one"){$nodes=$nodes.add($('[data-oe-model]').filter(function(){return this!==$node[0]&&nodes.indexOf(this)===-1;}).filter('[data-oe-many2one-model="'+$node.data('oe-many2one-model')+'"]').filter('[data-oe-many2one-id="'+$node.data('oe-many2one-id')+'"]').filter('[data-oe-type="many2one"]'));$nodes=$nodes.add($('[data-oe-model]').filter(function(){return this!==$node[0]&&nodes.indexOf(this)===-1;}).filter('[data-oe-model="'+$node.data('oe-many2one-model')+'"]').filter('[data-oe-id="'+$node.data('oe-many2one-id')+'"]').filter('[data-oe-field="name"]'));}
if(!clone_data){clone_data=true;$nodes.html(this.innerHTML);clone_data=false;}});}
var custom_toolbar=oLayoutInfo.toolbar?oLayoutInfo.toolbar():undefined;var $toolbar=$(oLayoutInfo.popover()).add(custom_toolbar);$('button[data-event="undo"], button[data-event="redo"]',$toolbar).attr('disabled',true);$(oLayoutInfo.editor()).add(oLayoutInfo.handle()).add(oLayoutInfo.popover()).add(custom_toolbar).on('click content_changed',function(){$('button[data-event="undo"]',$toolbar).attr('disabled',!oLayoutInfo.editable().data('NoteHistory').hasUndo());$('button[data-event="redo"]',$toolbar).attr('disabled',!oLayoutInfo.editable().data('NoteHistory').hasRedo());});function create_dblclick_feature(selector,callback){var show_tooltip=true;oLayoutInfo.editor().on("dblclick",selector,function(e){var $target=$(e.target);if(!dom.isContentEditable($target)){return;}
show_tooltip=false;callback();e.stopImmediatePropagation();});oLayoutInfo.editor().on("click",selector,function(e){var $target=$(e.target);if(!dom.isContentEditable($target)){return;}
show_tooltip=true;setTimeout(function(){if(!show_tooltip||$target.attr('title')!==undefined){return;}
$target.tooltip({title:_t('Double-click to edit'),trigger:'manuel',container:'body'}).tooltip('show');setTimeout(function(){$target.tooltip('dispose');},800);},400);});}};var fn_detach=eventHandler.detach;eventHandler.detach=function(oLayoutInfo,options){fn_detach.call(this,oLayoutInfo,options);oLayoutInfo.editable().off('mousedown');oLayoutInfo.editor().off("dragstart");oLayoutInfo.editor().off('click');$(document).off('mousedown',summernote_mousedown);$(document).off('mouseup',summernote_mouseup);oLayoutInfo.editor().off("dblclick");$(document).off("keyup",reRangeSelectKey);};$.summernote.lang.odoo={font:{bold:_t('Bold'),italic:_t('Italic'),underline:_t('Underline'),strikethrough:_t('Strikethrough'),subscript:_t('Subscript'),superscript:_t('Superscript'),clear:_t('Remove Font Style'),height:_t('Line Height'),name:_t('Font Family'),size:_t('Font Size')},image:{image:_t('File / Image'),insert:_t('Insert Image'),resizeFull:_t('Resize Full'),resizeHalf:_t('Resize Half'),resizeQuarter:_t('Resize Quarter'),floatLeft:_t('Float Left'),floatRight:_t('Float Right'),floatNone:_t('Float None'),dragImageHere:_t('Drag an image here'),selectFromFiles:_t('Select from files'),url:_t('Image URL'),remove:_t('Remove Image')},link:{link:_t('Link'),insert:_t('Insert Link'),unlink:_t('Unlink'),edit:_t('Edit'),textToDisplay:_t('Text to display'),url:_t('To what URL should this link go?'),openInNewWindow:_t('Open in new window')},video:{video:_t('Video'),videoLink:_t('Video Link'),insert:_t('Insert Video'),url:_t('Video URL?'),providers:_t('(YouTube, Vimeo, Vine, Instagram, DailyMotion or Youku)')},table:{table:_t('Table')},hr:{insert:_t('Insert Horizontal Rule')},style:{style:_t('Style'),normal:_t('Normal'),blockquote:_t('Quote'),pre:_t('Code'),small:_t('Small'),h1:_t('Header 1'),h2:_t('Header 2'),h3:_t('Header 3'),h4:_t('Header 4'),h5:_t('Header 5'),h6:_t('Header 6')},lists:{unordered:_t('Unordered list'),ordered:_t('Ordered list')},options:{help:_t('Help'),fullscreen:_t('Full Screen'),codeview:_t('Code View')},paragraph:{paragraph:_t('Paragraph'),outdent:_t('Outdent'),indent:_t('Indent'),left:_t('Align left'),center:_t('Align center'),right:_t('Align right'),justify:_t('Justify full')},color:{custom:_t('Custom Color'),background:_t('Background Color'),foreground:_t('Font Color'),transparent:_t('Transparent'),setTransparent:_t('None'),},shortcut:{shortcuts:_t('Keyboard shortcuts'),close:_t('Close'),textFormatting:_t('Text formatting'),action:_t('Action'),paragraphFormatting:_t('Paragraph formatting'),documentStyle:_t('Document Style')},history:{undo:_t('Undo'),redo:_t('Redo')}};var SummernoteManager=Class.extend(mixins.EventDispatcherMixin,{init:function(parent){mixins.EventDispatcherMixin.init.call(this);this.setParent(parent);core.bus.on('alt_dialog_demand',this,this._onAltDialogDemand);core.bus.on('color_picker_dialog_demand',this,this._onColorPickerDialogDemand);core.bus.on('crop_image_dialog_demand',this,this._onCropImageDialogDemand);core.bus.on('link_dialog_demand',this,this._onLinkDialogDemand);core.bus.on('media_dialog_demand',this,this._onMediaDialogDemand);},destroy:function(){mixins.EventDispatcherMixin.destroy.call(this);core.bus.off('alt_dialog_demand',this,this._onAltDialogDemand);core.bus.off('color_picker_dialog_demand',this,this._onColorPickerDialogDemand);core.bus.off('crop_image_dialog_demand',this,this._onCropImageDialogDemand);core.bus.off('link_dialog_demand',this,this._onLinkDialogDemand);core.bus.off('media_dialog_demand',this,this._onMediaDialogDemand);},_onAltDialogDemand:function(data){if(data.__alreadyDone){return;}
data.__alreadyDone=true;var altDialog=new weWidgets.AltDialog(this,data.options||{},data.media);if(data.onSave){altDialog.on('save',this,data.onSave);}
if(data.onCancel){altDialog.on('cancel',this,data.onCancel);}
altDialog.open();},_onColorPickerDialogDemand:function(data){if(data.__alreadyDone){return;}
data.__alreadyDone=true;var colorpicker=new ColorpickerDialog(this,{defaultColor:data.color,});if(data.onSave){colorpicker.on('colorpicker:saved',this,function(ev){data.onSave(ev.data.cssColor);});}
colorpicker.open();},_onCropImageDialogDemand:function(data){if(data.__alreadyDone){return;}
data.__alreadyDone=true;var cropImageDialog=new weWidgets.CropImageDialog(this,_.extend({res_model:data.$editable.data('oe-model'),res_id:data.$editable.data('oe-id'),},data.options||{}),data.media);if(data.onSave){cropImageDialog.on('save',this,data.onSave);}
if(data.onCancel){cropImageDialog.on('cancel',this,data.onCancel);}
cropImageDialog.open();},_onLinkDialogDemand:function(data){if(data.__alreadyDone){return;}
data.__alreadyDone=true;var linkDialog=new weWidgets.LinkDialog(this,data.options||{},data.linkInfo);if(data.onSave){linkDialog.on('save',this,data.onSave);}
if(data.onCancel){linkDialog.on('cancel',this,data.onCancel);}
linkDialog.open();},_onMediaDialogDemand:function(data){if(data.__alreadyDone){return;}
data.__alreadyDone=true;var mediaDialog=new weWidgets.MediaDialog(this,_.extend({res_model:data.$editable.data('oe-model'),res_id:data.$editable.data('oe-id'),domain:data.$editable.data('oe-media-domain'),},data.options),data.media);if(data.onSave){mediaDialog.on('save',this,data.onSave);}
if(data.onCancel){mediaDialog.on('cancel',this,data.onCancel);}
mediaDialog.open();},});rte.Class.include({start:function(){this._summernoteManager=new SummernoteManager(this);return this._super.apply(this,arguments);},cancel:function(){this._super.apply(this,arguments);this._summernoteManager.destroy();},});return SummernoteManager;});;

/* /web_editor/static/lib/nearest/jquery.nearest.js defined in bundle 'web_editor.assets_wysiwyg' */
;(function($,undefined){var rPerc=/^([\d.]+)%$/;function nearest(selector,options,thisObj){selector||(selector='div');var $container=$(options.container),containerOffset=$container.offset()||{left:0,top:0},containerDims=[containerOffset.left+$container.width(),containerOffset.top+$container.height()],percProps={x:0,y:1,w:0,h:1},prop,match;for(prop in percProps)if(percProps.hasOwnProperty(prop)){match=rPerc.exec(options[prop]);if(match){options[prop]=containerDims[percProps[prop]]*match[1]/100;}}
var $all=$(selector),cache=[],furthest=!!options.furthest,checkX=!!options.checkHoriz,checkY=!!options.checkVert,compDist=furthest?0:Infinity,point1x=parseFloat(options.x)||0,point1y=parseFloat(options.y)||0,point2x=parseFloat(point1x+options.w)||point1x,point2y=parseFloat(point1y+options.h)||point1y,tolerance=options.tolerance||0,hasEach2=!!$.fn.each2,min=Math.min,max=Math.max;if(!options.includeSelf&&thisObj){$all=$all.not(thisObj);}
if(tolerance<0){tolerance=0;}
$all[hasEach2?'each2':'each'](function(i,elem){var $this=hasEach2?elem:$(this),off=$this.offset(),x=off.left,y=off.top,w=$this.outerWidth(),h=$this.outerHeight(),x2=x+w,y2=y+h,maxX1=max(x,point1x),minX2=min(x2,point2x),maxY1=max(y,point1y),minY2=min(y2,point2y),intersectX=minX2>=maxX1,intersectY=minY2>=maxY1,distX,distY,distT,isValid;if((checkX&&checkY)||(!checkX&&!checkY&&intersectX&&intersectY)||(checkX&&intersectY)||(checkY&&intersectX)){distX=intersectX?0:maxX1-minX2;distY=intersectY?0:maxY1-minY2;distT=intersectX||intersectY?max(distX,distY):Math.sqrt(distX*distX+distY*distY);isValid=furthest?distT>=compDist-tolerance:distT<=compDist+tolerance;if(isValid){compDist=furthest?max(compDist,distT):min(compDist,distT);cache.push({node:this,dist:distT});}}});var len=cache.length,filtered=[],compMin,compMax,i,item;if(len){if(furthest){compMin=compDist-tolerance;compMax=compDist;}else{compMin=compDist;compMax=compDist+tolerance;}
for(i=0;i<len;i++){item=cache[i];if(item.dist>=compMin&&item.dist<=compMax){filtered.push(item.node);}}}
return filtered;}
$.each(['nearest','furthest','touching'],function(i,name){var defaults={x:0,y:0,w:0,h:0,tolerance:1,container:document,furthest:name=='furthest',includeSelf:false,checkHoriz:name!='touching',checkVert:name!='touching'};$[name]=function(point,selector,options){if(!point||point.x===undefined||point.y===undefined){return $([]);}
var opts=$.extend({},defaults,point,options||{});return $(nearest(selector,opts));};$.fn[name]=function(selector,options){var opts;if(selector&&$.isPlainObject(selector)){opts=$.extend({},defaults,selector,options||{});return this.pushStack(nearest(this,opts));}
var offset=this.offset(),dimensions={x:offset.left,y:offset.top,w:this.outerWidth(),h:this.outerHeight()};opts=$.extend({},defaults,dimensions,options||{});return this.pushStack(nearest(selector,opts,this));};});})(jQuery);;

/* /web_editor/static/src/js/editor/snippets.editor.js defined in bundle 'web_editor.assets_wysiwyg' */
odoo.define('web_editor.snippet.editor',function(require){'use strict';var core=require('web.core');var dom=require('web.dom');var Widget=require('web.Widget');var options=require('web_editor.snippets.options');var Wysiwyg=require('web_editor.wysiwyg');var _t=core._t;var globalSelector={closest:function(){return $();},all:function(){return $();},is:function(){return false;},};var SnippetEditor=Widget.extend({template:'web_editor.snippet_overlay',xmlDependencies:['/web_editor/static/src/xml/snippets.xml'],events:{'click .oe_snippet_parent':'_onParentButtonClick','click .oe_snippet_clone':'_onCloneClick','click .oe_snippet_remove':'_onRemoveClick','mousedown .oe_options [data-toggle="dropdown"]:first':'_onOpenCusomize',},custom_events:{cover_update:'_onCoverUpdate',option_update:'_onOptionUpdate',},init:function(parent,target,templateOptions,$editable,options){this._super.apply(this,arguments);this.options=options;this.$editable=$editable;this.ownerDocument=this.$editable[0].ownerDocument;this.$body=$(this.ownerDocument.body);this.$target=$(target);this.$target.data('snippet-editor',this);this.templateOptions=templateOptions;},start:function(){var self=this;var defs=[this._super.apply(this,arguments)];var $parent=globalSelector.closest(this.$target.parent());if(!$parent.length){this.$('.oe_snippet_parent').remove();}
defs.push(this._initializeOptions());if(!this.$target.is(':o_editable')){this.$el.find('.oe_snippet_move, .oe_snippet_clone, .oe_snippet_remove').remove();}else{this.dropped=false;this.$el.draggable({greedy:true,appendTo:this.$body,cursor:'move',handle:'.oe_snippet_move',cursorAt:{left:18,top:14},helper:function(){var $clone=$(this).clone().css({width:'24px',height:'24px',border:0});$clone.find('.oe_overlay_options >:not(:contains(.oe_snippet_move)), .o_handle').remove();$clone.find(':not(.glyphicon)').css({position:'absolute',top:0,left:0});$clone.appendTo(self.$body).removeClass('d-none');return $clone;},start:_.bind(self._onDragAndDropStart,self),stop:_.bind(self._onDragAndDropStop,self)});}
this.$target.on('transitionstart.snippet_editor, animationstart.snippet_editor',function(){self._targetIsAnimated=true;});this.$target.on('transitionend.snippet_editor, animationend.snippet_editor',function(){self._targetIsAnimated=false;if(self.$el.is('.oe_active')){self.cover();}});return Promise.all(defs);},destroy:function(){this.cleanForSave();this._super.apply(this,arguments);this.$target.removeData('snippet-editor');this.$target.off('.snippet_editor');},buildSnippet:function(){for(var i in this.styles){this.styles[i].onBuilt();}},cleanForSave:function(){if(this.isDestroyed()){return;}
_.each(this.styles,function(option){option.cleanForSave();});},cover:function(){if(this._targetIsAnimated){return;}
var offset=this.$target.offset();var manipulatorOffset=this.$el.parent().offset();offset.top-=manipulatorOffset.top;offset.left-=manipulatorOffset.left;this.$el.css({width:this.$target.outerWidth(),left:offset.left,top:offset.top,});this.$('.o_handles').css('height',this.$target.outerHeight());this.$el.toggleClass('o_top_cover',offset.top<this.$editable.offset().top);},removeSnippet:function(){this.toggleFocus(false);this.trigger_up('call_for_each_child_snippet',{$snippet:this.$target,callback:function(editor,$snippet){for(var i in editor.styles){editor.styles[i].onRemove();}},});var $parent=this.$target.parent();this.$target.find('*').addBack().tooltip('dispose');this.$target.remove();this.$el.remove();var node=$parent[0];if(node&&node.firstChild){if(!node.firstChild.tagName&&node.firstChild.textContent===' '){node.removeChild(node.firstChild);}}
if($parent.closest(':data("snippet-editor")').length){while(!$parent.data('snippet-editor')){var $nextParent=$parent.parent();if($parent.children().length===0&&$parent.text().trim()===''&&!$parent.hasClass('oe_structure')){$parent.remove();}
$parent=$nextParent;}
if($parent.children().length===0&&$parent.text().trim()===''&&!$parent.hasClass('oe_structure')){_.defer(function(){$parent.data('snippet-editor').removeSnippet();});}}
this.$body.find('.note-control-selection').hide();this.$body.find('.o_table_handler').remove();this.trigger_up('snippet_removed');this.destroy();$parent.trigger('content_changed');},toggleFocus:function(focus){if(!this.$el){return;}
var do_action=(focus?_do_action_focus:_do_action_blur);var $style_button=this.$el.find('.oe_options');var $ul=$style_button.find('.dropdown-menu:first');var $headers=$ul.find('.dropdown-header:data(editor)');_.each($headers,(function(el){var $el=$(el);var styles=_.values($el.data('editor').styles);if($el.data('editor')!==this){styles=_.filter(styles,function(option){return!option.preventChildPropagation;});}
var count=0;_.each(_.sortBy(styles,'__order').reverse(),function(style){if(do_action(style,$el)){count++;}});$el.toggleClass('d-none',count===0);}).bind(this));$style_button.toggleClass('d-none',$ul.children(':not(.o_main_header):not(.dropdown-divider):not(.d-none)').length===0);this.cover();this.$el.toggleClass('oe_active',!!focus);if(focus){this.trigger_up('snippet_focused');}
function _do_action_focus(style,$dest){style.$el.insertAfter($dest);style.onFocus();return(style.$el.length>0);}
function _do_action_blur(style,$dest){style.$el.detach();style.onBlur();return false;}},_getName:function(){if(this.$target.data('name')!==undefined){return this.$target.data('name');}
if(this.$target.parent('.row').length){return _t("Column");}
return _t("Block");},_initializeOptions:function(){var self=this;var $styles=this.$el.find('.oe_options');var $ul=$styles.find('.dropdown-menu:first');this.styles={};this.selectorSiblings=[];this.selectorChildren=[];var i=0;$ul.append($('<div/>',{class:'dropdown-header o_main_header',text:this._getName()}).data('editor',this));var defs=_.map(this.templateOptions,function(val,option_id){if(!val.selector.is(self.$target)){return;}
if(val['drop-near'])self.selectorSiblings.push(val['drop-near']);if(val['drop-in'])self.selectorChildren.push(val['drop-in']);var optionName=val.option;var $el=val.$el.children().clone(true).addClass('snippet-option-'+optionName);var option=new(options.registry[optionName]||options.Class)(self,val.base_target?self.$target.find(val.base_target).eq(0):self.$target,self.$el,val.data,self.options);self.styles[optionName||_.uniqueId('option')]=option;option.__order=i++;return option.attachTo($el);});$ul.append($('<div/>',{class:'dropdown-divider mt-2'}));var $parents=this.$target.parents();_.each($parents,function(parent){var parentEditor=$(parent).data('snippet-editor');if(parentEditor){for(var styleName in parentEditor.styles){if(!parentEditor.styles[styleName].preventChildPropagation){$ul.append($('<div/>',{class:'dropdown-header o_parent_editor_header',text:parentEditor._getName()}).data('editor',parentEditor));break;}}}});if(!this.selectorSiblings.length&&!this.selectorChildren.length){this.$el.find('.oe_snippet_move, .oe_snippet_clone').addClass('d-none');}
this.$el.find('[data-toggle="dropdown"]').dropdown();return Promise.all(defs);},_onCloneClick:function(ev){ev.preventDefault();this.trigger_up('cover_will_change');this.trigger_up('snippet_will_be_cloned',{$target:this.$target});var $clone=this.$target.clone(false);this.trigger_up('request_history_undo_record',{$target:this.$target});this.$target.after($clone);this.trigger_up('call_for_each_child_snippet',{$snippet:$clone,callback:function(editor,$snippet){for(var i in editor.styles){editor.styles[i].onClone({isCurrent:($snippet.is($clone)),});}},});this.trigger_up('snippet_cloned',{$target:$clone,$origin:this.$target});$clone.trigger('content_changed');},_onCoverUpdate:function(){this.trigger_up('cover_will_change');this.cover();},_onDragAndDropStart:function(){var self=this;this.dropped=false;self.size={width:self.$target.width(),height:self.$target.height()};self.$target.after('<div class="oe_drop_clone" style="display: none;"/>');self.$target.detach();self.$el.addClass('d-none');var $selectorSiblings;for(var i=0;i<self.selectorSiblings.length;i++){if(!$selectorSiblings)$selectorSiblings=self.selectorSiblings[i].all();else $selectorSiblings=$selectorSiblings.add(self.selectorSiblings[i].all());}
var $selectorChildren;for(i=0;i<self.selectorChildren.length;i++){if(!$selectorChildren)$selectorChildren=self.selectorChildren[i].all();else $selectorChildren=$selectorChildren.add(self.selectorChildren[i].all());}
this.trigger_up('go_to_parent',{$snippet:this.$target});this.trigger_up('activate_insertion_zones',{$selectorSiblings:$selectorSiblings,$selectorChildren:$selectorChildren,});this.$body.addClass('move-important');this.$editable.find('.oe_drop_zone').droppable({over:function(){self.$editable.find('.oe_drop_zone.hide').removeClass('hide');$(this).addClass('hide').first().after(self.$target);self.dropped=true;},out:function(){$(this).removeClass('hide');self.$target.detach();self.dropped=false;},});this.trigger_up('cover_will_change');},_onDragAndDropStop:function(ev,ui){this.$editable.find('.oe_drop_zone').droppable('destroy').remove();if(!this.dropped){var $el=$.nearest({x:ui.position.left,y:ui.position.top},'.oe_drop_zone',{container:document.body}).first();if($el.length){$el.after(this.$target);this.dropped=true;}}
var prev=this.$target.first()[0].previousSibling;var next=this.$target.last()[0].nextSibling;var $parent=this.$target.parent();var $clone=this.$editable.find('.oe_drop_clone');if(prev===$clone[0]){prev=$clone[0].previousSibling;}else if(next===$clone[0]){next=$clone[0].nextSibling;}
$clone.after(this.$target);var $from=$clone.parent();this.$el.removeClass('d-none');this.$body.removeClass('move-important');$clone.remove();if(this.dropped){this.trigger_up('request_history_undo_record',{$target:this.$target});if(prev){this.$target.insertAfter(prev);}else if(next){this.$target.insertBefore(next);}else{$parent.prepend(this.$target);}
for(var i in this.styles){this.styles[i].onMove();}
this.$target.trigger('content_changed');$from.trigger('content_changed');}
this.trigger_up('drag_and_drop_stop',{$snippet:this.$target,});},_onOptionUpdate:function(ev){this.trigger_up('cover_will_change');if(ev.data.optionNames){ev.stopPropagation();var self=this;_.each(ev.data.optionNames,function(name){var option=self.styles[name];if(option){option.notify(ev.data.name,ev.data.data);}});}
if(ev.data.optionName){var option=this.styles[ev.data.optionName];if(option){ev.stopPropagation();option.notify(ev.data.name,ev.data.data);}}},_onOpenCusomize:function(ev){this.trigger_up('request_history_undo_record',{$target:this.$target});},_onParentButtonClick:function(ev){ev.preventDefault();this.trigger_up('go_to_parent',{$snippet:this.$target,});},_onRemoveClick:function(ev){ev.preventDefault();this.trigger_up('cover_will_change');this.trigger_up('request_history_undo_record',{$target:this.$target});this.removeSnippet();},});var SnippetsMenu=Widget.extend({id:'oe_snippets',cacheSnippetTemplate:{},activeSnippets:[],custom_events:{activate_insertion_zones:'_onActivateInsertionZones',call_for_each_child_snippet:'_onCallForEachChildSnippet',deactivate_snippet:'_onDeactivateSnippet',drag_and_drop_stop:'_onDragAndDropStop',go_to_parent:'_onGoToParent',remove_snippet:'_onRemoveSnippet',snippet_removed:'_onSnippetRemoved',reload_snippet_dropzones:'_disableUndroppableSnippets',},init:function(parent,options){this._super.apply(this,arguments);options=options||{};this.trigger_up('getRecordInfo',{recordInfo:options,callback:function(recordInfo){_.defaults(options,recordInfo);},});this.options=options;if(!this.options.snippets){this.options.snippets='web_editor.snippets';}
this.$activeSnippet=false;this.snippetEditors=[];this.setSelectorEditableArea(options.$el,options.selectorEditableArea);},start:function(){var self=this;var defs=[this._super.apply(this,arguments)];this.ownerDocument=this.$el[0].ownerDocument;this.$document=$(this.ownerDocument);this.window=this.ownerDocument.defaultView;this.$window=$(this.window);defs.push(this.loadSnippets().then(function(html){return self._computeSnippetTemplates(html);}));this.$snippetEditorArea=$('<div/>',{id:'oe_manipulators',}).insertAfter(this.$el);var lastClickedElement;this.$document.on('click.snippets_menu','*',function(ev){var srcElement=ev.target||(ev.originalEvent&&(ev.originalEvent.target||ev.originalEvent.originalTarget))||ev.srcElement;if(lastClickedElement===srcElement||!srcElement){return;}
lastClickedElement=srcElement;_.defer(function(){lastClickedElement=false;});var $target=$(srcElement);if($target.closest('.oe_overlay, .note-popover').length){return;}
self._activateSnippet($target);});core.bus.on('deactivate_snippet',this,this._onDeactivateSnippet);core.bus.on('snippet_editor_clean_for_save',this,this._onCleanForSaveDemand);var debouncedCoverUpdate=_.debounce(function(){self.updateCurrentSnippetEditorOverlay();},200);this.$window.on('resize.snippets_menu',debouncedCoverUpdate);this.$window.on('content_changed.snippets_menu',debouncedCoverUpdate);this.$document.on('keydown.snippets_menu',function(){if(self.$activeSnippet&&self.$activeSnippet.data('snippet-editor')){self.$activeSnippet.data('snippet-editor').$el.addClass('o_keypress');}});this.$document.on('mousemove.snippets_menu, mousedown.snippets_menu',function(){if(self.$activeSnippet&&self.$activeSnippet.data('snippet-editor')){self.$activeSnippet.data('snippet-editor').$el.removeClass('o_keypress');}});this.$document.on('click.snippets_menu','.o_default_snippet_text',function(ev){$(ev.target).closest('.o_default_snippet_text').removeClass('o_default_snippet_text');$(ev.target).selectContent();$(ev.target).removeClass('o_default_snippet_text');});this.$document.on('keyup.snippets_menu',function(){var range=Wysiwyg.getRange(this);$(range&&range.sc).closest('.o_default_snippet_text').removeClass('o_default_snippet_text');});return Promise.all(defs).then(function(){setTimeout(function(){self.$window.trigger('resize');},1000);});},destroy:function(){this._super.apply(this,arguments);if(this.$window){this.$snippetEditorArea.remove();this.$window.off('.snippets_menu');this.$document.off('.snippets_menu');}
core.bus.off('deactivate_snippet',this,this._onDeactivateSnippet);core.bus.off('snippet_editor_clean_for_save',this,this._onCleanForSaveDemand);delete this.cacheSnippetTemplate[this.options.snippets];},cleanForSave:function(){this._activateSnippet(false);this.trigger_up('ready_to_clean_for_save');this._destroyEditors();this.getEditableArea().find('[contentEditable]').removeAttr('contentEditable').removeProp('contentEditable');this.getEditableArea().find('.o_we_selected_image').removeClass('o_we_selected_image');},loadSnippets:function(){if(this.cacheSnippetTemplate[this.options.snippets]){this._defLoadSnippets=this.cacheSnippetTemplate[this.options.snippets];return this._defLoadSnippets;}
this._defLoadSnippets=this._rpc({model:'ir.ui.view',method:'render_template',args:[this.options.snippets,{}],kwargs:{context:this.options.context,},});this.cacheSnippetTemplate[this.options.snippets]=this._defLoadSnippets;return this._defLoadSnippets;},setSelectorEditableArea:function($editor,selectorEditableArea){this.selectorEditableArea=selectorEditableArea;this.$editor=$editor;this.$body=$editor.closest('body');},getEditableArea:function(){return this.$editor.find(this.selectorEditableArea).add(this.$editor.filter(this.selectorEditableArea));},updateCurrentSnippetEditorOverlay:function(){if(this.$activeSnippet&&this.$activeSnippet.data('snippet-editor')){this.$activeSnippet.data('snippet-editor').cover();}
this.snippetEditors=_.filter(this.snippetEditors,function(snippetEditor){if(snippetEditor.$target.closest('body').length){return true;}
snippetEditor.destroy();});},_activateInsertionZones:function($selectorSiblings,$selectorChildren){var self=this;var zone_template=$('<div/>',{class:'oe_drop_zone oe_insert',});function isFullWidth($elem){return $elem.parent().width()===$elem.outerWidth(true);}
if($selectorChildren){$selectorChildren.each(function(){var $zone=$(this);var css=self.window.getComputedStyle(this);var parentCss=self.window.getComputedStyle($zone.parent()[0]);var float=css.float||css.cssFloat;var parentDisplay=parentCss.display;var parentFlex=parentCss.flexDirection;var $drop=zone_template.clone();$zone.append($drop);var node=$drop[0].previousSibling;var test=!!(node&&((!node.tagName&&node.textContent.match(/\S/))||node.tagName==='BR'));if(test){$drop.addClass('oe_vertical').css({height:parseInt(self.window.getComputedStyle($zone[0]).lineHeight),float:'none',display:'inline-block',});}else if(float==='left'||float==='right'||(parentDisplay==='flex'&&parentFlex==='row')){$drop.css('float',float);if(!isFullWidth($zone)){$drop.addClass('oe_vertical').css('height',Math.max(Math.min($zone.outerHeight(),$zone.children().last().outerHeight()),30));}}
$drop=$drop.clone();$zone.prepend($drop);node=$drop[0].nextSibling;test=!!(node&&((!node.tagName&&node.textContent.match(/\S/))||node.tagName==='BR'));if(test){$drop.addClass('oe_vertical').css({height:parseInt(self.window.getComputedStyle($zone[0]).lineHeight),float:'none',display:'inline-block'});}else if(float==='left'||float==='right'||(parentDisplay==='flex'&&parentFlex==='row')){$drop.css('float',float);if(!isFullWidth($zone)){$drop.addClass('oe_vertical').css('height',Math.max(Math.min($zone.outerHeight(),$zone.children().first().outerHeight()),30));}}
if(test){$drop.css({'float':'none','display':'inline-block'});}});$selectorSiblings=$(_.uniq(($selectorSiblings||$()).add($selectorChildren.children()).get()));}
if($selectorSiblings){$selectorSiblings.filter(':not(.oe_drop_zone):not(.oe_drop_clone)').each(function(){var $zone=$(this);var $drop;var css=self.window.getComputedStyle(this);var parentCss=self.window.getComputedStyle($zone.parent()[0]);var float=css.float||css.cssFloat;var parentDisplay=parentCss.display;var parentFlex=parentCss.flexDirection;if($zone.prev('.oe_drop_zone:visible').length===0){$drop=zone_template.clone();if(float==='left'||float==='right'||(parentDisplay==='flex'&&parentFlex==='row')){$drop.css('float',float);if(!isFullWidth($zone)){$drop.addClass('oe_vertical').css('height',Math.max(Math.min($zone.outerHeight(),$zone.prev().outerHeight()||Infinity),30));}}
$zone.before($drop);}
if($zone.next('.oe_drop_zone:visible').length===0){$drop=zone_template.clone();if(float==='left'||float==='right'||(parentDisplay==='flex'&&parentFlex==='row')){$drop.css('float',float);if(!isFullWidth($zone)){$drop.addClass('oe_vertical').css('height',Math.max(Math.min($zone.outerHeight(),$zone.next().outerHeight()||Infinity),30));}}
$zone.after($drop);}});}
var count;var $zones;do{count=0;$zones=this.getEditableArea().find('.oe_drop_zone > .oe_drop_zone').remove();count+=$zones.length;$zones.remove();}while(count>0);$zones=this.getEditableArea().find('.oe_drop_zone:not(.oe_vertical)');$zones.each(function(){var zone=$(this);var prev=zone.prev();var next=zone.next();if(prev.is('.oe_drop_zone')||next.is('.oe_drop_zone')){zone.remove();return;}
var float_prev=prev.css('float')||'none';var float_next=next.css('float')||'none';var disp_prev=prev.css('display')||null;var disp_next=next.css('display')||null;if((float_prev==='left'||float_prev==='right')&&(float_next==='left'||float_next==='right')){zone.remove();}else if(disp_prev!==null&&disp_next!==null&&disp_prev.indexOf('inline')>=0&&disp_next.indexOf('inline')>=0){zone.remove();}});},_activateSnippet:function($snippet){if($snippet){if(!globalSelector.is($snippet)){$snippet=globalSelector.closest($snippet);}
if(this.$activeSnippet&&this.$activeSnippet[0]===$snippet[0]){return Promise.resolve($snippet.data('snippet-editor'));}}
var editor=null;if(this.$activeSnippet){editor=this.$activeSnippet.data('snippet-editor');if(editor){editor.toggleFocus(false);}
this.$activeSnippet=false;}
if($snippet&&$snippet.length){var self=this;this.trigger_up('activate_snippet',$snippet);return this._createSnippetEditor($snippet).then(function(editor){self.$activeSnippet=$snippet;editor.toggleFocus(true);return editor;});}
return Promise.resolve(editor);},_destroyEditors:function(){_.each(this.snippetEditors,function(snippetEditor){snippetEditor.destroy();});},_callForEachChildSnippet:function($snippet,callback){var self=this;var defs=_.map($snippet.add(globalSelector.all($snippet)),function(el){var $snippet=$(el);return self._createSnippetEditor($snippet).then(function(editor){if(editor){return callback.call(self,editor,$snippet);}});});return Promise.all(defs);},_computeSelectorFunctions:function(include,exclude,target,noCheck,isChildren){var self=this;var selectorList=_.compact(include.split(/\s*,\s*/));var excludeList=_.compact(exclude.split(/\s*,\s*/));excludeList.push('.o_snippet_not_selectable');var selectorConditions=_.map(excludeList,function(exc){return':not('+exc+')';}).join('');if(target){selectorConditions+=':has('+target+')';}
if(!noCheck){selectorConditions=(this.options.addDropSelector||'')+selectorConditions;}
var selector=_.map(selectorList,function(s){return s+selectorConditions;}).join(', ');var functions={is:function($from){return $from.is(selector);},};if(noCheck){functions.closest=function($from,parentNode){return $from.closest(selector,parentNode);};functions.all=function($from){return $from?dom.cssFind($from,selector):$(selector);};}else{functions.closest=function($from,parentNode){var parents=self.getEditableArea().get();return $from.closest(selector,parentNode).filter(function(){var node=this;while(node.parentNode){if(parents.indexOf(node)!==-1){return true;}
node=node.parentNode;}
return false;});};functions.all=isChildren?function($from){return dom.cssFind($from||self.getEditableArea(),selector);}:function($from){$from=$from||self.getEditableArea();return $from.filter(selector).add(dom.cssFind($from,selector));};}
return functions;},_computeSnippetTemplates:function(html){var self=this;var $html=$(html);var $scroll=$html.siblings('#o_scroll');$html.find('[data-oe-type="snippet"]').each(function(){$(this).children().attr('data-oe-type','snippet').attr('data-oe-thumbnail',$(this).data('oe-thumbnail'));});this.templateOptions=[];var selectors=[];var $styles=$html.find('[data-selector]');$styles.each(function(){var $style=$(this);var selector=$style.data('selector');var exclude=$style.data('exclude')||'';var target=$style.data('target');var noCheck=$style.data('no-check');var option_id=$style.data('js');var option={'option':option_id,'base_selector':selector,'base_exclude':exclude,'base_target':target,'selector':self._computeSelectorFunctions(selector,exclude,target,noCheck),'$el':$style,'drop-near':$style.data('drop-near')&&self._computeSelectorFunctions($style.data('drop-near'),'',false,noCheck,true),'drop-in':$style.data('drop-in')&&self._computeSelectorFunctions($style.data('drop-in'),'',false,noCheck),'data':$style.data(),};self.templateOptions.push(option);selectors.push(option.selector);});$styles.addClass('d-none');globalSelector.closest=function($from){var $temp;var $target;for(var i=0,len=selectors.length;i<len;i++){$temp=selectors[i].closest($from,$target&&$target[0]);if($temp.length){$target=$temp;}}
return $target||$();};globalSelector.all=function($from){var $target=$();for(var i=0,len=selectors.length;i<len;i++){$target=$target.add(selectors[i].all($from));}
return $target;};globalSelector.is=function($from){for(var i=0,len=selectors.length;i<len;i++){if(selectors[i].is($from)){return true;}}
return false;};this.$snippets=$scroll.find('.o_panel_body').children().addClass('oe_snippet').each(function(){var $snippet=$(this);var name=$snippet.attr('name');var $sbody=$snippet.children(':not(.oe_snippet_thumbnail)').addClass('oe_snippet_body');if($sbody.length){var snippetClasses=$sbody.attr('class').match(/s_[^ ]+/g);if(snippetClasses&&snippetClasses.length){snippetClasses='.'+snippetClasses.join('.');}
$(snippetClasses).data('name',name);$sbody.data('name',name);}
if($snippet.find('.oe_snippet_thumbnail').length){return;}
var $thumbnail=$(_.str.sprintf('<div class="oe_snippet_thumbnail">'+'<div class="oe_snippet_thumbnail_img" style="background-image: url(%s);"/>'+'<span class="oe_snippet_thumbnail_title">%s</span>'+'</div>',$snippet.find('[data-oe-thumbnail]').data('oeThumbnail'),name));$snippet.prepend($thumbnail);var moduleID=$snippet.data('moduleId');if(moduleID){$snippet.addClass('o_snippet_install');var $installBtn=$('<a/>',{class:'btn btn-primary o_install_btn',target:'_blank',href:'/web#id='+moduleID+'&view_type=form&model=ir.module.module&action=base.open_module_tree',text:_t("Install"),});$thumbnail.append($installBtn);}}).not('[data-module-id]');if(!this.$snippets.length){this.$el.detach();}
this._registerDefaultTexts();_.each($html.find('[data-oe-model], [data-oe-type]'),function(el){for(var k=0;k<el.attributes.length;k++){if(el.attributes[k].name.indexOf('data-oe-')===0){$(el).removeAttr(el.attributes[k].name);k--;}}});$html.find('.o_not_editable').attr('contentEditable',false);this.$el.html($html);this._makeSnippetDraggable(this.$snippets);this._disableUndroppableSnippets();this.$el.addClass('o_loaded');$('body.editor_enable').addClass('editor_has_snippets');this.trigger_up('snippets_loaded',self.$el);},_createSnippetEditor:function($snippet){var self=this;var snippetEditor=$snippet.data('snippet-editor');if(snippetEditor){return Promise.resolve(snippetEditor);}
var def;var $parent=globalSelector.closest($snippet.parent());if($parent.length){def=this._createSnippetEditor($parent);}
return Promise.resolve(def).then(function(parentEditor){let editableArea=self.getEditableArea();snippetEditor=new SnippetEditor(parentEditor||self,$snippet,self.templateOptions,$snippet.closest('[data-oe-type="html"], .oe_structure').add(editableArea),self.options);self.snippetEditors.push(snippetEditor);return snippetEditor.appendTo(self.$snippetEditorArea);}).then(function(){return snippetEditor;});},_disableUndroppableSnippets:function(){var self=this;var cache={};this.$snippets.each(function(){var $snippet=$(this);var $snippet_body=$snippet.find('.oe_snippet_body');var check=false;_.each(self.templateOptions,function(option,k){if(check||!($snippet_body.is(option.base_selector)&&!$snippet_body.is(option.base_exclude)))return;cache[k]=cache[k]||{'drop-near':option['drop-near']?option['drop-near'].all().length:0,'drop-in':option['drop-in']?option['drop-in'].all().length:0};check=(cache[k]['drop-near']||cache[k]['drop-in']);});$snippet.toggleClass('o_disabled',!check);});},_makeSnippetDraggable:function($snippets){var self=this;var $tumb=$snippets.find('.oe_snippet_thumbnail_img:first');var left=$tumb.outerWidth()/2;var top=$tumb.outerHeight()/2;var $toInsert,dropped,$snippet;$snippets.draggable({greedy:true,helper:'clone',appendTo:this.$body,cursor:'move',handle:'.oe_snippet_thumbnail',distance:30,cursorAt:{left:left,top:top,},start:function(){dropped=false;$snippet=$(this);var $base_body=$snippet.find('.oe_snippet_body');var $selectorSiblings=$();var $selectorChildren=$();var temp=self.templateOptions;for(var k in temp){if($base_body.is(temp[k].base_selector)&&!$base_body.is(temp[k].base_exclude)){if(temp[k]['drop-near']){$selectorSiblings=$selectorSiblings.add(temp[k]['drop-near'].all());}
if(temp[k]['drop-in']){$selectorChildren=$selectorChildren.add(temp[k]['drop-in'].all());}}}
$toInsert=$base_body.clone().data('name',$base_body.data('name'));if(!$selectorSiblings.length&&!$selectorChildren.length){console.warn($snippet.find('.oe_snippet_thumbnail_title').text()+" have not insert action: data-drop-near or data-drop-in");return;}
self._activateSnippet(false);self._activateInsertionZones($selectorSiblings,$selectorChildren);self.getEditableArea().find('.oe_drop_zone').droppable({over:function(){if(!dropped){dropped=true;$(this).first().after($toInsert).addClass('d-none');$toInsert.removeClass('oe_snippet_body');}},out:function(){var prev=$toInsert.prev();if(this===prev[0]){dropped=false;$toInsert.detach();$(this).removeClass('d-none');$toInsert.addClass('oe_snippet_body');}},});self.trigger_up('cover_will_change');},stop:function(ev,ui){$toInsert.removeClass('oe_snippet_body');if(!dropped&&ui.position.top>3&&ui.position.left+50>self.$el.outerWidth()){var $el=$.nearest({x:ui.position.left,y:ui.position.top},'.oe_drop_zone',{container:document.body}).first();if($el.length){$el.after($toInsert);dropped=true;}}
self.getEditableArea().find('.oe_drop_zone').droppable('destroy').remove();if(dropped){var prev=$toInsert.first()[0].previousSibling;var next=$toInsert.last()[0].nextSibling;if(prev){$toInsert.detach();self.trigger_up('request_history_undo_record',{$target:$(prev)});$toInsert.insertAfter(prev);}else if(next){$toInsert.detach();self.trigger_up('request_history_undo_record',{$target:$(next)});$toInsert.insertBefore(next);}else{var $parent=$toInsert.parent();$toInsert.detach();self.trigger_up('request_history_undo_record',{$target:$parent});$parent.prepend($toInsert);}
var $target=$toInsert;_.defer(function(){self.trigger_up('snippet_dropped',{$target:$target});self._disableUndroppableSnippets();self._callForEachChildSnippet($target,function(editor,$snippet){editor.buildSnippet();}).then(function(){$target.trigger('content_changed');if($target.closest('body').length){self._activateSnippet($target);}});});}else{$toInsert.remove();}},});},_registerDefaultTexts:function($in){if($in===undefined){$in=this.$snippets.find('.oe_snippet_body');}
$in.find('*').addBack().contents().filter(function(){return this.nodeType===3&&this.textContent.match(/\S/);}).parent().addClass('o_default_snippet_text');},_onActivateInsertionZones:function(ev){this._activateInsertionZones(ev.data.$selectorSiblings,ev.data.$selectorChildren);},_onCallForEachChildSnippet:function(ev){this._callForEachChildSnippet(ev.data.$snippet,ev.data.callback);},_onCleanForSaveDemand:function(ev){this.cleanForSave();},_onDeactivateSnippet:function(){this._activateSnippet(false);},_onDragAndDropStop:function(ev){this._destroyEditors();this._activateSnippet(ev.data.$snippet);},_onGoToParent:function(ev){ev.stopPropagation();this._activateSnippet(ev.data.$snippet.parent());},_onRemoveSnippet:function(ev){ev.stopPropagation();this._createSnippetEditor(ev.data.$snippet).then(function(editor){editor.removeSnippet();});},_onSnippetRemoved:function(){this._disableUndroppableSnippets();},});return{Class:SnippetsMenu,Editor:SnippetEditor,globalSelector:globalSelector,};});;

/* /web_editor/static/src/js/editor/snippets.options.js defined in bundle 'web_editor.assets_wysiwyg' */
odoo.define('web_editor.snippets.options',function(require){'use strict';var core=require('web.core');var Dialog=require('web.Dialog');var Widget=require('web.Widget');var weWidgets=require('wysiwyg.widgets');var summernoteCustomColors=require('web_editor.rte.summernote_custom_colors');var qweb=core.qweb;var _t=core._t;var SnippetOption=Widget.extend({events:{'mouseenter':'_onLinkEnter','mouseenter a':'_onLinkEnter','click':'_onLinkClick','click a':'_onLinkClick','mouseleave':'_onMouseleave','mouseleave a':'_onMouseleave','mouseleave .dropdown-menu':'_onMouseleave',},preventChildPropagation:false,init:function(parent,$target,$overlay,data,options){this._super.apply(this,arguments);this.options=options;this.$target=$target;this.ownerDocument=this.$target[0].ownerDocument;this.$overlay=$overlay;this.data=data;this.__methodNames=[];},start:function(){this._setActive();return this._super.apply(this,arguments);},onFocus:function(){},onBuilt:function(){},onBlur:function(){},onClone:function(options){},onMove:function(){},onRemove:function(){},cleanForSave:function(){},selectClass:function(previewMode,value,$opt){var $group=$opt&&$opt.parents('.dropdown-submenu').last();if(!$group||!$group.length){$group=this.$el;}
var $lis=$group.find('[data-select-class]').addBack('[data-select-class]');var classes=$lis.map(function(){return $(this).data('selectClass');}).get().join(' ');this.$target.removeClass(classes);if(value){this.$target.addClass(value);}},toggleClass:function(previewMode,value,$opt){var $lis=this.$el.find('[data-toggle-class]').addBack('[data-toggle-class]');var classes=$lis.map(function(){return $(this).data('toggleClass');}).get().join(' ');var activeClasses=$lis.filter('.active, :has(.active)').map(function(){return $(this).data('toggleClass');}).get().join(' ');this.$target.removeClass(classes).addClass(activeClasses);if(value&&previewMode!=='reset'){this.$target.toggleClass(value);}},$:function(){return this.$target.find.apply(this.$target,arguments);},notify:function(name,data){if(name==='target'){this.setTarget(data);}},setTarget:function($target){this.$target=$target;this._setActive();this.$target.trigger('snippet-option-change',[this]);},_reset:function(){var self=this;var $actives=this.$el.find('.active').addBack('.active');_.each($actives,function(activeElement){var $activeElement=$(activeElement);self.__methodNames=_.without.apply(_,[self.__methodNames].concat(_.keys($activeElement.data())));self._select('reset',$activeElement);});_.each(this.__methodNames,function(methodName){self[methodName]('reset');});this.__methodNames=[];},_select:function(previewMode,$opt){var self=this;if(previewMode&&($opt.data('noPreview')||$opt.parent().data('noPreview'))){return;}
if(!previewMode){this._reset();this.trigger_up('request_history_undo_record',{$target:this.$target});this.$target.trigger('content_changed');}
var el=$opt[0];var methods=[];do{methods.push([el,el.dataset]);el=el.parentNode;}while(this.$el.parent().has(el).length);_.each(methods.reverse(),function(data){var $el=$(data[0]);var methods=data[1];_.each(methods,function(value,methodName){if(self[methodName]){if(previewMode===true){self.__methodNames.push(methodName);}
self[methodName](previewMode,value,$el);}});});this.__methodNames=_.uniq(this.__methodNames);if(!previewMode){this._setActive();}},_setActive:function(){var self=this;this.$el.find('[data-toggle-class]').addBack('[data-toggle-class]').removeClass('active').filter(function(){var className=$(this).data('toggleClass');return!className||self.$target.hasClass(className);}).addClass('active');var $submenus=this.$el.find('.dropdown-submenu').addBack('.dropdown-submenu').not('.dropdown-submenu .dropdown-submenu');_.each($submenus,function(submenu){var $elements=_getSelectClassElements($(submenu));_processSelectClassElements($elements);});var $externalElements=_getSelectClassElements(this.$el).not('.dropdown-submenu *, .dropdown-submenu');_processSelectClassElements($externalElements);function _getSelectClassElements($el){return $el.find('[data-select-class]').addBack('[data-select-class]');}
function _processSelectClassElements($elements){var maxNbClasses=-1;$elements.removeClass('active').filter(function(){var className=$(this).data('selectClass');var nbClasses=className?className.split(' ').length:0;if(nbClasses>=maxNbClasses&&(!className||self.$target.hasClass(className))){maxNbClasses=nbClasses;return true;}
return false;}).last().addClass('active');}},_onLinkEnter:function(ev){var $opt=$(ev.target).closest('.dropdown-item');if(!$opt.length){return;}
var $dsmenu=$opt.parent('.dropdown-submenu');if($dsmenu.length){var $menu=$dsmenu.children('.dropdown-menu');if($menu.length){var menuRightPosition=$dsmenu.offset().left+$dsmenu.outerWidth()+$menu.outerWidth();$menu.toggleClass('o_open_to_left',menuRightPosition>$(window).outerWidth());}}
if(!$opt.is(':hasData')){return;}
this.__click=false;this._select(true,$opt);this.$target.trigger('snippet-option-preview',[this]);},_onLinkClick:function(ev){var $opt=$(ev.target).closest('.dropdown-item');if(ev.isDefaultPrevented()||!$opt.length||!$opt.is(':hasData')){return;}
ev.preventDefault();this.__click=true;this._select(false,$opt);this.$target.trigger('snippet-option-change',[this]);},_onMouseleave:function(){if(this.__click){return;}
this._reset();},});var registry={};registry.sizing=SnippetOption.extend({preventChildPropagation:true,start:function(){var self=this;var def=this._super.apply(this,arguments);this.$handles=this.$overlay.find('.o_handle');var resizeValues=this._getSize();_.each(resizeValues,function(value,key){self.$handles.filter('.'+key).toggleClass('readonly',!value);});this.$handles.on('mousedown',function(ev){ev.preventDefault();var $handle=$(ev.currentTarget);var compass=false;var XY=false;if($handle.hasClass('n')){compass='n';XY='Y';}else if($handle.hasClass('s')){compass='s';XY='Y';}else if($handle.hasClass('e')){compass='e';XY='X';}else if($handle.hasClass('w')){compass='w';XY='X';}
var resize=resizeValues[compass];if(!resize){return;}
var current=0;var cssProperty=resize[2];var cssPropertyValue=parseInt(self.$target.css(cssProperty));_.each(resize[0],function(val,key){if(self.$target.hasClass(val)){current=key;}else if(resize[1][key]===cssPropertyValue){current=key;}});var begin=current;var beginClass=self.$target.attr('class');var regClass=new RegExp('\\s*'+resize[0][begin].replace(/[-]*[0-9]+/,'[-]*[0-9]+'),'g');var cursor=$handle.css('cursor')+'-important';var $body=$(this.ownerDocument.body);$body.addClass(cursor);var xy=ev['page'+XY];var body_mousemove=function(ev){ev.preventDefault();var dd=ev['page'+XY]-xy+resize[1][begin];var next=current+(current+1===resize[1].length?0:1);var prev=current?(current-1):0;var change=false;if(dd>(2*resize[1][next]+resize[1][current])/3){self.$target.attr('class',(self.$target.attr('class')||'').replace(regClass,''));self.$target.addClass(resize[0][next]);current=next;change=true;}
if(prev!==current&&dd<(2*resize[1][prev]+resize[1][current])/3){self.$target.attr('class',(self.$target.attr('class')||'').replace(regClass,''));self.$target.addClass(resize[0][prev]);current=prev;change=true;}
if(change){self._onResize(compass,beginClass,current);self.trigger_up('cover_update');$handle.addClass('o_active');}};var body_mouseup=function(){$body.off('mousemove',body_mousemove);$body.off('mouseup',body_mouseup);$body.removeClass(cursor);$handle.removeClass('o_active');var $handlers=self.$overlay.find('.o_handle');$handlers.addClass('o_active').delay(300).queue(function(){$handlers.removeClass('o_active').dequeue();});if(begin===current){return;}
setTimeout(function(){self.trigger_up('request_history_undo_record',{$target:self.$target,event:'resize_'+XY,});},0);};$body.on('mousemove',body_mousemove);$body.on('mouseup',body_mouseup);});return def;},onFocus:function(){this._onResize();},setTarget:function(){this._super.apply(this,arguments);this._onResize();},_getSize:function(){},_onResize:function(compass,beginClass,current){var self=this;var resizeValues=this._getSize();var $handles=this.$overlay.find('.o_handle');_.each(resizeValues,function(resizeValue,direction){var classes=resizeValue[0];var values=resizeValue[1];var cssProperty=resizeValue[2];var $handle=$handles.filter('.'+direction);var current=0;var cssPropertyValue=parseInt(self.$target.css(cssProperty));_.each(classes,function(className,key){if(self.$target.hasClass(className)){current=key;}else if(values[key]===cssPropertyValue){current=key;}});$handle.toggleClass('o_handle_start',current===0);$handle.toggleClass('o_handle_end',current===classes.length-1);});var ml=this.$target.css('margin-left');this.$overlay.find('.o_handle.w').css({width:ml,left:'-'+ml,});_.each(this.$overlay.find(".o_handle.n, .o_handle.s"),function(handle){var $handle=$(handle);var direction=$handle.hasClass('n')?'top':'bottom';$handle.height(self.$target.css('padding-'+direction));});},});registry.sizing_y=registry.sizing.extend({_getSize:function(){var nClass='pt';var nProp='padding-top';var sClass='pb';var sProp='padding-bottom';if(this.$target.is('hr')){nClass='mt';nProp='margin-top';sClass='mb';sProp='margin-bottom';}
var grid=[];for(var i=0;i<=256/8;i++){grid.push(i*8);}
grid.splice(1,0,4);this.grid={n:[_.map(grid,function(v){return nClass+v;}),grid,nProp],s:[_.map(grid,function(v){return sClass+v;}),grid,sProp],};return this.grid;},});registry.colorpicker=SnippetOption.extend({xmlDependencies:['/web_editor/static/src/xml/snippets.xml'],events:_.extend({},SnippetOption.prototype.events||{},{'click .colorpicker button':'_onColorButtonClick','mouseenter .colorpicker button':'_onColorButtonEnter','mouseleave .colorpicker button':'_onColorButtonLeave','click .note-color-reset':'_onColorResetButtonClick',}),colorPrefix:'bg-',start:function(){var self=this;var res=this._super.apply(this,arguments);if(this.data.colorPrefix){this.colorPrefix=this.data.colorPrefix;}
if(!this.$el.find('.colorpicker').length){var $pt=$(qweb.render('web_editor.snippet.option.colorpicker'));var $clpicker=$(qweb.render('web_editor.colorpicker'));_.each($clpicker.find('.o_colorpicker_section'),function(elem){$(elem).prepend("<div class='text-muted mt8'>"+elem.dataset.display+"</div>");});var excluded=[];if(this.data.paletteExclude){excluded=this.data.paletteExclude.replace(/ /g,'').split(',');}
if(this.data.paletteTitle){$pt.find('.note-palette-title').text(this.data.paletteTitle);}
_.each(excluded,function(exc){$clpicker.find('[data-name="'+exc+'"]').remove();});if(!('common'in excluded)){var $commonColorSection=$clpicker.find('[data-name="common"]');_.each(summernoteCustomColors,function(colorRow,i){var $div=$('<div/>',{class:'clearfix'}).appendTo($commonColorSection);if(i===0){return;}
_.each(colorRow,function(color){$div.append('<button class="o_custom_color" style="background-color: '+color+'" />');});});}
$pt.find('.o_colorpicker_section_tabs').append($clpicker);this.$el.find('.dropdown-menu').append($pt);}
var classes=[];this.$el.find('.colorpicker button').each(function(){var $color=$(this);var color=$color.data('color');if(!color){return;}
$color.addClass('bg-'+color);var className=self.colorPrefix+color;if(self.$target.hasClass(className)){$color.addClass('selected');}
classes.push(className);});this.classes=classes.join(' ');return res;},_onColorButtonClick:function(ev){this.$el.find('.colorpicker button.selected').removeClass('selected');$(ev.currentTarget).addClass('selected');this.$target.closest('.o_editable').trigger('content_changed');this.$target.trigger('background-color-event',false);},_onColorButtonEnter:function(ev){this.$target.removeClass(this.classes);var color=$(ev.currentTarget).data('color');if(color){this.$target.addClass(this.colorPrefix+color);}else if($(ev.target).hasClass('o_custom_color')){this.$target.removeClass(this.classes).css('background-color',ev.currentTarget.style.backgroundColor);}
this.$target.trigger('background-color-event',true);},_onColorButtonLeave:function(ev){this.$target.removeClass(this.classes);this.$target.css('background-color','');var $selected=this.$el.find('.colorpicker button.selected');if($selected.length){if($selected.data('color')){this.$target.addClass(this.colorPrefix+$selected.data('color'));}else{this.$target.css('background-color',$selected.css('background-color'));}}
this.$target.trigger('background-color-event','reset');},_onColorResetButtonClick:function(){this.$target.removeClass(this.classes).css('background-color','');this.$target.trigger('content_changed');this.$el.find('.colorpicker button.selected').removeClass('selected');},});registry.background=SnippetOption.extend({start:function(){var res=this._super.apply(this,arguments);this.bindBackgroundEvents();this.__customImageSrc=this._getSrcFromCssValue();return res;},background:function(previewMode,value,$opt){if(previewMode==='reset'&&value===undefined){this._setCustomBackground(this.__customImageSrc);return;}
if(value&&value.length){this.$target.css('background-image','url(\''+value+'\')');this.$target.removeClass('oe_custom_bg').addClass('oe_img_bg');}else{this.$target.css('background-image','');this.$target.removeClass('oe_img_bg oe_custom_bg');}},selectClass:function(previewMode,value,$opt){this.background(previewMode,'',$opt);this._super(previewMode,value?(value+' oe_img_bg'):value,$opt);},chooseImage:function(previewMode,value,$opt){var $image=$('<img/>',{class:'d-none',src:value==='true'?'':value}).appendTo(this.$target);var $editable=this.$target.closest('.o_editable');var _editor=new weWidgets.MediaDialog(this,{onlyImages:true,firstFilters:['background'],res_model:$editable.data('oe-model'),res_id:$editable.data('oe-id'),},$image[0]).open();_editor.on('save',this,function(){this._setCustomBackground($image.attr('src'));this.$target.trigger('content_changed');});_editor.on('closed',this,function(){$image.remove();});},bindBackgroundEvents:function(){if(this.$target.is('.parallax, .s_parallax_bg')){return;}
this.$target.off('.background-option').on('background-color-event.background-option',(function(e,previewMode){e.stopPropagation();if(e.currentTarget!==e.target)return;if(previewMode===false){this.__customImageSrc=undefined;}
this.background(previewMode);}).bind(this));},setTarget:function(){this._super.apply(this,arguments);this.bindBackgroundEvents();this.__customImageSrc=this._getSrcFromCssValue();},_getSrcFromCssValue:function(value){if(value===undefined){value=this.$target.css('background-image');}
var srcValueWrapper=/url\(['"]*|['"]*\)|^none$/g;return value&&value.replace(srcValueWrapper,'')||'';},_setActive:function(){this._super.apply(this,arguments);var src=this._getSrcFromCssValue();this.$el.find('[data-background]').removeClass('active').filter(function(){var bgOption=$(this).data('background');return(bgOption===''&&src===''||bgOption!==''&&src.indexOf(bgOption)>=0);}).addClass('active');this.$el.find('[data-choose-image]').toggleClass('active',this.$target.hasClass('oe_custom_bg'));},_setCustomBackground:function(value){this.__customImageSrc=value;this.background(false,this.__customImageSrc);this.$target.addClass('oe_custom_bg');this._setActive();this.$target.trigger('snippet-option-change',[this]);},});registry.background_position=SnippetOption.extend({xmlDependencies:['/web_editor/static/src/xml/editor.xml'],start:function(){this._super.apply(this,arguments);var self=this;this.$target.on('snippet-option-change',function(){self.onFocus();});},onFocus:function(){this.$el.toggleClass('d-none',this.$target.css('background-image')==='none');},backgroundPosition:function(previewMode,value,$opt){var self=this;this.previous_state=[this.$target.attr('class'),this.$target.css('background-size'),this.$target.css('background-position')];this.bg_pos=self.$target.css('background-position').split(' ');this.bg_siz=self.$target.css('background-size').split(' ');this.modal=new Dialog(null,{title:_t("Background Image Sizing"),$content:$(qweb.render('web_editor.dialog.background_position')),buttons:[{text:_t("Ok"),classes:'btn-primary',close:true,click:_.bind(this._saveChanges,this)},{text:_t("Discard"),close:true,click:_.bind(this._discardChanges,this)},],}).open();this.modal.opened().then(function(){var value=((self.$target.hasClass('o_bg_img_opt_contain'))?'contain':((self.$target.hasClass('o_bg_img_opt_custom'))?'custom':'cover'));self.modal.$('> label > input[value='+value+']').prop('checked',true);if(self.$target.hasClass('o_bg_img_opt_repeat')){self.modal.$('#o_bg_img_opt_contain_repeat').prop('checked',true);self.modal.$('#o_bg_img_opt_custom_repeat').val('o_bg_img_opt_repeat');}else if(self.$target.hasClass('o_bg_img_opt_repeat_x')){self.modal.$('#o_bg_img_opt_custom_repeat').val('o_bg_img_opt_repeat_x');}else if(self.$target.hasClass('o_bg_img_opt_repeat_y')){self.modal.$('#o_bg_img_opt_custom_repeat').val('o_bg_img_opt_repeat_y');}
if(self.bg_pos.length>1){self.bg_pos={x:self.bg_pos[0],y:self.bg_pos[1],};self.modal.$('#o_bg_img_opt_custom_pos_x').val(self.bg_pos.x.replace('%',''));self.modal.$('#o_bg_img_opt_custom_pos_y').val(self.bg_pos.y.replace('%',''));}
if(self.bg_siz.length>1){self.modal.$('#o_bg_img_opt_custom_size_x').val(self.bg_siz[0].replace('%',''));self.modal.$('#o_bg_img_opt_custom_size_y').val(self.bg_siz[1].replace('%',''));}
self.$focus=self.modal.$('.o_focus_point');self._updatePosInformation();var img_url=/\(['"]?([^'"]+)['"]?\)/g.exec(self.$target.css('background-image'));img_url=(img_url&&img_url[1])||'';var $img=$('<img/>',{class:'img img-fluid',src:img_url});$img.on('load',function(){self._bindImageEvents($img);});$img.prependTo(self.modal.$('.o_bg_img_opt_object'));self.modal.$el.on('change','> label > input',function(e){self.modal.$('> .o_bg_img_opt').addClass('o_hidden').filter('[data-value='+e.target.value+']').removeClass('o_hidden');});self.modal.$el.on('change','input, select',function(e){self._saveChanges();});self.modal.$('> label > input:checked').trigger('change');});},_bindImageEvents:function($img){var self=this;var mousedown=false;$img.on('mousedown',function(e){mousedown=true;});$img.on('mousemove',function(e){if(mousedown){_update(e);}});$img.on('mouseup',function(e){self.$focus.addClass('o_with_transition');_update(e);setTimeout(function(){self.$focus.removeClass('o_with_transition');},200);mousedown=false;});function _update(e){var posX=e.pageX-$(e.target).offset().left;var posY=e.pageY-$(e.target).offset().top;self.bg_pos={x:clipValue(posX/$img.width()*100).toFixed(2)+'%',y:clipValue(posY/$img.height()*100).toFixed(2)+'%',};self._updatePosInformation();self._saveChanges();function clipValue(value){return Math.max(0,Math.min(value,100));}}},_clean:function(){this.$target.removeClass('o_bg_img_opt_contain o_bg_img_opt_custom o_bg_img_opt_repeat o_bg_img_opt_repeat_x o_bg_img_opt_repeat_y').css({'background-size':'','background-position':'',});},_discardChanges:function(){this._clean();if(this.previous_state){this.$target.addClass(this.previous_state[0]).css({'background-size':this.previous_state[1],'background-position':this.previous_state[2],});}},_updatePosInformation:function(){this.modal.$('.o_bg_img_opt_ui_info .o_x').text(this.bg_pos.x);this.modal.$('.o_bg_img_opt_ui_info .o_y').text(this.bg_pos.y);this.$focus.css({left:this.bg_pos.x,top:this.bg_pos.y,});},_saveChanges:function(){this._clean();var bg_img_size=this.modal.$('> :not(label):not(.o_hidden)').data('value')||'cover';switch(bg_img_size){case'cover':this.$target.css('background-position',this.bg_pos.x+' '+this.bg_pos.y);break;case'contain':this.$target.addClass('o_bg_img_opt_contain');this.$target.toggleClass('o_bg_img_opt_repeat',this.modal.$('#o_bg_img_opt_contain_repeat').prop('checked'));break;case'custom':this.$target.addClass('o_bg_img_opt_custom');var sizeX=this.modal.$('#o_bg_img_opt_custom_size_x').val();var sizeY=this.modal.$('#o_bg_img_opt_custom_size_y').val();var posX=this.modal.$('#o_bg_img_opt_custom_pos_x').val();var posY=this.modal.$('#o_bg_img_opt_custom_pos_y').val();this.$target.addClass(this.modal.$('#o_bg_img_opt_custom_repeat').val()).css({'background-size':((sizeX)?sizeX+'%':'auto')+' '+((sizeY)?sizeY+'%':'auto'),'background-position':((posX)?posX+'%':'auto')+' '+((posY)?posY+'%':'auto'),});break;}},});registry.many2one=SnippetOption.extend({xmlDependencies:['/web_editor/static/src/xml/snippets.xml'],start:function(){var self=this;this.trigger_up('getRecordInfo',_.extend(this.options,{callback:function(recordInfo){_.defaults(self.options,recordInfo);},}));this.Model=this.$target.data('oe-many2one-model');this.ID=+this.$target.data('oe-many2one-id');this.$btn=$(qweb.render('web_editor.many2one.button')).insertAfter(this.$overlay.find('.oe_options'));this.$ul=this.$btn.find('ul');this.$search=this.$ul.find('li:first');this.$search.find('input').on('mousedown click mouseup keyup keydown',function(e){e.stopPropagation();});setTimeout(function(){if(self.$overlay.find('.oe_options').hasClass('d-none')){self.$btn.css('height','0').find('> a').addClass('d-none');self.$ul.show().css({'top':'-24px','margin':'0','padding':'2px 0','position':'relative'});}else{self.$btn.find('a').on('click',function(e){self._clear();});}},0);this.$search.find('input').focus().on('keyup',function(e){self.$overlay.removeClass('o_keypress');self._findExisting($(this).val());});this.$ul.on('click','li:not(:first) a',function(e){self._selectRecord($(e.currentTarget));});return this._super.apply(this,arguments);},onFocus:function(){this.$target.attr('contentEditable','false');this._clear();},_clear:function(){var self=this;this.$search.siblings().remove();self.$search.find('input').val('');setTimeout(function(){self.$search.find('input').focus();},0);},_findExisting:function(name){var self=this;var domain=[];if(!name||!name.length){self.$search.siblings().remove();return;}
if(isNaN(+name)){if(this.Model!=='res.partner'){domain.push(['name','ilike',name]);}else{domain.push('|',['name','ilike',name],['email','ilike',name]);}}else{domain.push(['id','=',name]);}
return this._rpc({model:this.Model,method:'search_read',args:[domain,this.Model==='res.partner'?['name','display_name','city','country_id']:['name','display_name']],kwargs:{order:[{name:'name',asc:false}],limit:5,context:this.options.context,},}).then(function(result){self.$search.siblings().remove();self.$search.after(qweb.render('web_editor.many2one.search',{contacts:result}));});},_selectRecord:function($li){var self=this;this.ID=+$li.data('id');this.$target.attr('data-oe-many2one-id',this.ID).data('oe-many2one-id',this.ID);this.trigger_up('request_history_undo_record',{$target:this.$target});this.$target.trigger('content_changed');if(self.$target.data('oe-type')==='contact'){$('[data-oe-contact-options]').filter('[data-oe-model="'+self.$target.data('oe-model')+'"]').filter('[data-oe-id="'+self.$target.data('oe-id')+'"]').filter('[data-oe-field="'+self.$target.data('oe-field')+'"]').filter('[data-oe-contact-options!="'+self.$target.data('oe-contact-options')+'"]').add(self.$target).attr('data-oe-many2one-id',self.ID).data('oe-many2one-id',self.ID).each(function(){var $node=$(this);var options=$node.data('oe-contact-options');self._rpc({model:'ir.qweb.field.contact',method:'get_record_to_html',args:[[self.ID]],kwargs:{options:options,context:self.options.context,},}).then(function(html){$node.html(html);});});}else{self.$target.html($li.data('name'));}
_.defer(function(){self.trigger_up('deactivate_snippet');});}});return{Class:SnippetOption,registry:registry,};});;

/* /web_editor/static/src/js/tours/rte.js defined in bundle 'web_editor.assets_wysiwyg' */
odoo.define('web_editor.tour',function(require){'use strict';var core=require('web.core');var tour=require('web_tour.tour');var base=require('web_editor.base');function simulateClickEvent(el,type){var evt=document.createEvent('MouseEvents');evt.initMouseEvent(type,true,true,window,0,0,0,0,0,false,false,false,false,0,el);el.dispatchEvent(evt);}
tour.register('rte',{url:'/web_editor/field/html?callback=FieldTextHtml_0&enable_editor=1&datarecord=%7B%7D',test:true,wait_for:base.ready(),},[{content:"Change html for this test",trigger:"#editable_area",run:function(){var html='\n'+'<section>\n'+'    <div class="container" style="width: 600px;">\n'+'        <div class="row">\n'+'            <div class="col-lg-6 mt16">\n'+'<h1 id="text_content_id">Batnae municipium in Anthemusia</h1>     \n'+'     <p>Batnae municipium in Anthemusia conditum Macedonum manu priscorum ab Euphrate flumine brevi spatio disparatur, refertum mercatoribus opulentis, ubi annua sollemnitate prope Septembris initium mensis ad.</p>\n'+'     <p>    Quam <img style="width: 25%" src="/web/static/src/img/logo.png"/> quidem <span class="fa fa-flag fa-2x"></span> partem accusationis admiratus sum et moleste tuli potissimum esse Atratino datam. Neque enim decebat neque aetas.</p>\n'+'     <p>Et hanc quidem praeter oppida multa duae civitates exornant Seleucia opus Seleuci regis, et Claudiopolis quam deduxit coloniam Claudius Caesar. Isaura enim antehac nimium potens, olim subversa ut rebellatrix.</p>'+'<p>Harum trium sententiarum nulli prorsus assentior.</p>\n'+'        </div>\n'+'        <div class="col-lg-6 mt16">\n'+'            <img class="img img-fluid shadow mb16" src="/web/static/src/img/logo.png" alt="Odoo text and image block">\n'+'        </div>\n'+'    </div>\n'+'</section>\n';this.$anchor.html(html);}},{content:"simulate triple click and change text bg-color",trigger:'#editable_area > section .row > div:first',run:function(){var $h1=$('h1',this.$anchor);$.summernote.core.range.create($h1[0].firstChild,0,$('p',this.$anchor)[0],0).select();simulateClickEvent($h1[0],'mouseup');}},{content:"change text bg-color after triple click",trigger:'.note-color button.dropdown-toggle:has(.fa-paint-brush)',extra_trigger:'#editable_area > section .row > div:first',},{content:"change text backColor",trigger:"button[data-event=backColor]:visible:eq(2)",},{content:"change selection to change text color",trigger:'#editable_area > section .row > div:first:not(:has(p font)) h1 font',run:function(){$.summernote.core.range.create(this.$anchor[0].firstChild,5,this.$anchor[0].firstChild,10).select();simulateClickEvent(this.$anchor[0],'mouseup');}},{content:"open color dropdown",trigger:".note-color button.dropdown-toggle:has(.fa-font)",},{content:"change text color",trigger:"button[data-event=foreColor]:visible:first",},{content:"change selection to change text bg-color again",trigger:'#editable_area > section .row > div:first h1 font:eq(2)',run:function(){$.summernote.core.range.create(this.$anchor.prev()[0].firstChild,3,this.$anchor[0].firstChild,10).select();simulateClickEvent(this.$anchor.prev()[0],'mouseup');}},{content:"open color dropdown",trigger:".note-color button.dropdown-toggle:has(.fa-paint-brush)",},{content:"change text backColor again",trigger:"button[data-event=backColor]:visible:first",},{content:"change selection (h1 and p) to change text color with class",trigger:'#editable_area > section .row > div:first h1 font:eq(4)',run:function(){$.summernote.core.range.create(this.$anchor.prev()[0].firstChild,3,this.$anchor.parent("h1").next("p")[0].firstChild,30).select();simulateClickEvent(this.$anchor.prev()[0],'mouseup');}},{content:"open color dropdown",trigger:".note-color button.dropdown-toggle:has(.fa-font)",},{content:"change text color again",trigger:"button[data-event=foreColor]:visible:eq(3)",},{content:"delete selection",trigger:'.o_editable.note-editable.o_dirty',extra_trigger:'#editable_area > section .row > div:first p font',run:"keydown 46",},{content:"create an other selection to delete",trigger:'#editable_area > section .row > div:first:not(:has(p font)) h1',extra_trigger:'.o_editable.note-editable.o_dirty',run:function(){$.summernote.core.range.createFromNode(this.$anchor.next("p")[0]).clean();$.summernote.core.range.create(this.$anchor.find('font:containsExact(ici)')[0].firstChild,1,this.$anchor.next().next()[0].firstChild,5).select();simulateClickEvent(this.$anchor.find('font:last')[0],'mouseup');},},{content:"clean and delete (backspace) an other selection",trigger:'#editable_area > section .row > div:first:not(:has(p font)) h1',run:"keydown 8",},{content:"an other selection",trigger:'#editable_area > section .row > div:first:has( font:last:containsExact(i) ):has( p:first:containsRegex(/^uam/) ) h1',extra_trigger:'.o_editable.note-editable.o_dirty',run:function(){$.summernote.core.range.create(this.$anchor.find('font:first')[0].firstChild,3,this.$anchor.next("p")[0].childNodes[2],8).select();simulateClickEvent(this.$anchor.find('font:first')[0],'mouseup');},},{content:"delete an other selection",trigger:'#editable_area > section .row > div:first:has( font:last:containsExact(i) ):has( p:first:containsRegex(/^uam/) ) h1',run:"keydown 46",},{content:"undo",trigger:'.note-image-popover button[data-event="undo"]',extra_trigger:'#editable_area > section .row > div:first:has( font:last:containsExact(Bat) )',},{content:"undo again",trigger:'.note-air-popover button[data-event="undo"]',extra_trigger:'#editable_area > section .row > div:first:has( font:last:containsExact(i) )',},{content:"delete (backspace) after undo",trigger:'.o_editable.note-editable.o_dirty',extra_trigger:'#editable_area > section .row > div:first:not(:has(p font)) h1',run:"keydown 8",},{content:"click on image",trigger:'#editable_area > section .row > div:first img[style*="25%"]',extra_trigger:'#editable_area > section .row > div:first:has( font:last:containsExact(i) ):has( p:first:containsRegex(/^uam/) )',},{content:"Click on resize half",trigger:'.note-image-popover:visible button[data-event="resize"][data-value="0.5"]',},{content:"Click on edit picture",trigger:'.note-image-popover:visible button[data-event="showImageDialog"]',extra_trigger:'#editable_area > section .row > div:first img[style*="50%"]',},{content:"Click on pictogram tab",trigger:'a[data-toggle="tab"]:contains(Pictogram)',extra_trigger:'#editor-media-image',},{content:"select a pictogram",trigger:'#editor-media-icon.active span.fa:first',},{content:"save pictogram",trigger:'.modal-footer > .btn-primary',extra_trigger:'#editor-media-icon.active span.o_selected',},{content:"select a size for the pictogram",trigger:'.note-image-popover button[data-event="resizefa"][data-value="3"]',},{content:"click on float right",trigger:'.note-image-popover:visible button[data-event="floatMe"][data-value="right"]',extra_trigger:'#wrapwrap span.fa-3x',},{content:"click on create link",trigger:'.note-image-popover:visible button[data-event="showLinkDialog"]',extra_trigger:'#editable_area > section .row > div:first span.fa.float-right',},{content:"insert a link url",trigger:'input[name="url"]',run:"text http://www.odoo.com",},{content:"click on color style",trigger:'.o_link_dialog_color > .o_link_dialog_color_item.btn-success',extra_trigger:'a#link-preview:containsRegex(/^<span [^>]+><\\/span>$/) > span.fa.fa-3x.float-right',},{content:"save link",trigger:'.modal-footer > .btn-primary',extra_trigger:'a#link-preview.btn.btn-success span.fa.fa-3x.float-right',},{content:"click on other picture",trigger:'#editable_area > section .row > div:last img',extra_trigger:'body:not(:has(#link-preview)) a.btn[href^="http://"]:has(span.fa.fa-3x.float-right)',},{content:"click on create link again",trigger:'.note-image-popover:visible button[data-event="showLinkDialog"]',extra_trigger:'#editable_area > section .row > div:first span.fa.float-right',},{content:"insert an email",trigger:'input[name="url"]',run:"text test@test.test",},{content:"click on color style again",trigger:'.o_link_dialog_color > .o_link_dialog_color_item.btn-success',extra_trigger:'a#link-preview:containsRegex(/^<img [^>]+>$/) img',},{content:"save link",trigger:'.modal-footer > .btn-primary',extra_trigger:'a#link-preview.btn.btn-success[href="mailto:test@test.test"]:containsRegex(/^<img [^>]+>$/) img',},{content:"select for triple enter then double backspace",trigger:'#editable_area > section .row > div:first p:eq(2)',extra_trigger:'body:not(:has(#link-preview)) #editable_area > section .row > div:eq(1) > a > img',run:function(){var p=this.$anchor[0].firstChild;$.summernote.core.range.create(p,p.textContent.length,p,p.textContent.length).select();simulateClickEvent(p,'mouseup');},},{content:"triple enter then double backspace",trigger:'#editable_area > section .row > div:first p:eq(2)',run:"keydown 66,13,66,13,13,8,8",},{content:"add ul content",trigger:'#editable_area > section .row > div:first',extra_trigger:'body:not(:has(#editable_area > section .row > div:first p:eq(5), #editable_area > section .row > div:eq(3))) #editable_area > section .row > div:first p:eq(3)',run:function(){var html='  <ul>     '+'\n     <li>   <p>Batnae municipium.  </p></li>'+'\n     <li>    Seleucia praeter.</li>'+'\n     <li><p>Et hanc quidem.</p></li>'+'\n    </ul>';this.$anchor.append(html);var node=this.$anchor.find('ul li p:last')[0].firstChild;$.summernote.core.range.create(node,6).select();simulateClickEvent(node,'mouseup');}},{content:"click on style dropdown",trigger:'.note-air-popover .note-style button.dropdown-toggle',extra_trigger:'#editable_area > section .row > div:first ul li p:first',},{content:"select h3",trigger:'.note-air-popover .note-style ul:visible a[data-value="h3"]',},{content:"select h3",trigger:'#editable_area > section .row > div:first > ul > li > h3',run:function(){var node=this.$anchor[0].firstChild;$.summernote.core.range.create(node,0).select();simulateClickEvent(node,'mouseup');}},{content:"double tabulation",trigger:'#editable_area > section .row > div:first > ul > li > h3',run:"keydown 9,9",},{content:"click on order list",trigger:'.note-air-popover button[data-event="insertOrderedList"]',extra_trigger:'#editable_area > section .row > div:first ul > li > ul > li > ul > li > h3',},{content:"select for enter in ul",trigger:'#editable_area > section .row > div:first ul li > p:last',run:function(){this.$anchor[0].firstChild.textContent+="";$.summernote.core.range.create(this.$anchor[0].firstChild,7).select();simulateClickEvent(this.$anchor[0],'mouseup');}},{content:"enter in ul",trigger:'#editable_area > section .row > div:first ul li > p:last',run:"keydown 66,13",},{trigger:'#editable_area > section .row > div:first ul li > p:eq(1):containsRegex(/^municipium./)',content:"backspace in list",run:"keydown 8",},{content:"end",trigger:'#editable_area > section .row > div:first ul li p:eq(0):containsRegex(/^Batnae Bmunicipium.$/)',}]);tour.register('rte_inline',{url:'/web_editor/field/html/inline?callback=FieldTextHtml_0&enable_editor=1&datarecord=%7B%7D',test:true,wait_for:base.ready(),},[{content:"Change html for this test",trigger:"#editable_area",run:function(){var html='\n'+'<div>\n'+'  <table cellspacing="0" cellpadding="0" width="100%">\n'+'    <tbody>\n'+'      <tr>\n'+'        <td valign="center" width="270">\n'+'          <img src="/logo.png" alt="Your Logo" class="rounded-circle img-thumbnail">\n'+'        </td>\n'+'        <td valign="center" width="270">\n'+'          <a href="https://www.facebook.com/Odoo"><span class="fa fa-facebook-square fa-2x text-primary"></span></a>\n'+'          <span style="color: rgb(255, 0, 0);" class="fa fa-4x fa-google-plus-square float-right"></span>\n'+'        </td>\n'+'      </tr>\n'+'    </tbody>\n'+'  </table>\n'+'</div>';this.$anchor.html(html);}},{content:"call clean for save",trigger:'#wrapwrap table',run:function(){core.bus.trigger('snippet_editor_clean_for_save');}},{content:"check the image style",trigger:'#wrapwrap img:first[width][height][style*="-radius"][style*="1px"][style*="padding"]',},{content:"check the font image src",trigger:'#wrapwrap img:eq(1)[src^="/web_editor/font_to_img/"][src$="/rgb(0,160,157)/28"]',},{content:"check the font class to css",trigger:'#wrapwrap img:eq(1)[height]:not([class*="fa"])',},{content:"check the second font class to css",trigger:'#wrapwrap img:eq(2)[style*="float: right"],#wrapwrap img:eq(2)[style*="float:right"]',}]);});;

/* /web_editor/static/src/js/wysiwyg/widgets/image_optimize_dialog.js defined in bundle 'web_editor.assets_wysiwyg' */
odoo.define('wysiwyg.widgets.image_optimize_dialog',function(require){'use strict';var core=require('web.core');var Dialog=require('web.Dialog');var _t=core._t;var ImageOptimizeDialog=Dialog.extend({template:'wysiwyg.widgets.image.optimize',xmlDependencies:(Dialog.prototype.xmlDependencies||[]).concat(['/web_editor/static/src/xml/wysiwyg.xml',]),events:_.extend({},Dialog.prototype.events,{'click .o_we_width_preset':'_onWidthPresetClick','input #o_we_height':'_onHeightInput','input #o_we_name_input':'_onNameInput','input #o_we_optimize_quality':'_onOptimizeQualityInput','input #o_we_quality_input':'_onQualityInput','input #o_we_width':'_onWidthInput','input .o_we_quality_range':'_onQualityRangeInput',}),init:function(parent,params,options){this._super(parent,_.extend({},{title:_t("Improve your Image"),size:'large',buttons:[{text:_t("Optimize"),classes:'btn-primary o_we_save',close:false,click:this._onOptimizeClick.bind(this)},{text:_t("Keep Original"),close:false,click:this._onKeepOriginalClick.bind(this)}],},options));this.isExisting=params.isExisting;this.attachment=params.attachment;this.disableResize=['image/jpeg','image/jpe','image/jpg','image/png'].indexOf(this.attachment.mimetype)===-1;this.disableQuality=this.disableResize;this.toggleQuality=this.attachment.mimetype==='image/png';this.optimizedWidth=Math.min(params.optimizedWidth||this.attachment.image_width,this.attachment.image_width);this.defaultQuality=this.isExisting?100:80;this.defaultWidth=parseInt(this.isExisting?this.attachment.image_width:this.optimizedWidth);this.defaultHeight=parseInt(this.isExisting||!this.attachment.image_width?this.attachment.image_height:this.optimizedWidth/this.attachment.image_width*this.attachment.image_height);this.suggestedWidths=[];this._addSuggestedWidth(128,'128');this._addSuggestedWidth(256,'256');this._addSuggestedWidth(512,'512');this._addSuggestedWidth(1024,'1024');this._addSuggestedWidth(this.optimizedWidth,_.str.sprintf(_t("%d (Suggested)"),this.optimizedWidth));this.suggestedWidths.push({'width':this.attachment.image_width,'text':_.str.sprintf(_t("%d (Original)"),this.attachment.image_width),});this.suggestedWidths=_.sortBy(this.suggestedWidths,'width');this._updatePreview=_.debounce(this._updatePreview.bind(this),300);},start:function(){var self=this;var promise=this._super.apply(this,arguments);this.$nameInput=this.$('#o_we_name_input');this.$previewImage=this.$('.o_we_preview_image');this.$saveButton=this.$footer.find('.o_we_save');this.$widthPresets=this.$('.o_we_width_preset');this.$widthInput=this.$('#o_we_width');this.$heightInput=this.$('#o_we_height');this.$qualityRange=this.$('.o_we_quality_range');this.$qualityInput=this.$('#o_we_quality_input');this.$qualityCheckBox=this.$('#o_we_optimize_quality');this._updatePreview();this._validateForm();this.opened().then(function(){self.$nameInput.focus();});return promise;},_addSuggestedWidth:function(size,text){if(size<this.attachment.image_width){this.suggestedWidths.push({width:size,text:text,});}},_getAdaptedQuality:function(){var quality=0;if(this.$qualityCheckBox.length){if(this.$qualityCheckBox.is(":checked")){quality=50;}}else if(this.$qualityRange.length){quality=parseInt(this.$qualityRange.val()||0);}
if(quality===100){quality=0;}
return Math.min(95,quality);},_updatePreview:function(){if(!this._validatePreview()){return;}
var width=parseInt(this.$widthInput.val()||0);var height=parseInt(this.$heightInput.val()||0);this.$previewImage.attr('src',_.str.sprintf('/web/image/%d/%dx%d?quality=%d',this.attachment.id,width,height,this._getAdaptedQuality()));this.$widthPresets.removeClass('active');_.each(this.$widthPresets,function(button){var $button=$(button);if(parseInt($button.data('width'))===width){$button.addClass('active');}});},_validateForm:function(){var name=this.$nameInput.val();var isValid=name&&this._validatePreview();this.$saveButton.prop('disabled',!isValid);return isValid;},_validatePreview:function(){var isValid=true;var quality=this._getAdaptedQuality();var width=parseInt(this.$widthInput.val()||0);var height=parseInt(this.$heightInput.val()||0);if(quality<0||quality>100){isValid=false;}
if(width<0||width>this.attachment.image_width){isValid=false;}
if(height<0||height>this.attachment.image_height){isValid=false;}
return isValid;},_onHeightInput:function(){var height=parseInt(this.$heightInput.val())||0;this.$widthInput.val(parseInt(height/this.attachment.image_height*this.attachment.image_width));this._updatePreview();this._validateForm();},_onKeepOriginalClick:function(){if(!this.isExisting){this.trigger_up('attachment_updated',this.attachment);}
this.close();},_onNameInput:function(){this._validateForm();},_onOptimizeClick:function(){var self=this;var name=this.$nameInput.val();var params={'name':name,'quality':this._getAdaptedQuality(),'width':parseInt(this.$widthInput.val()||0),'height':parseInt(this.$heightInput.val()||0),};if(this.isExisting){params['copy']=true;}
return this._rpc({route:_.str.sprintf('/web_editor/attachment/%d/update',this.attachment.id),params:params,}).then(function(attachment){self.trigger_up('attachment_updated',attachment);self.close();});},_onQualityInput:function(){var quality=parseInt(this.$qualityInput.val()||0);if(quality===0){quality=100;}
if(!quality){return;}
this.$qualityRange.val(quality);this._onQualityRangeInput();},_onQualityRangeInput:function(){var quality=parseInt(this.$qualityRange.val()||0);this.$qualityInput.val(quality);this._updatePreview();this._validateForm();},_onOptimizeQualityInput:function(){this._updatePreview();},_onWidthInput:function(){var width=parseInt(this.$widthInput.val()||0);this.$heightInput.val(parseInt(width/this.attachment.image_width*this.attachment.image_height));this._updatePreview();this._validateForm();},_onWidthPresetClick:function(ev){ev.preventDefault();this.$widthInput.val(parseInt($(ev.target).data('width')));this._onWidthInput();},});return{ImageOptimizeDialog:ImageOptimizeDialog,};});;

/* /web_editor/static/src/js/wysiwyg/widgets/media.js defined in bundle 'web_editor.assets_wysiwyg' */
odoo.define('wysiwyg.widgets.media',function(require){'use strict';var concurrency=require('web.concurrency');var config=require('web.config');var core=require('web.core');var Dialog=require('web.Dialog');var dom=require('web.dom');var fonts=require('wysiwyg.fonts');var ImageOptimizeDialog=require('wysiwyg.widgets.image_optimize_dialog').ImageOptimizeDialog;var utils=require('web.utils');var Widget=require('web.Widget');var session=require('web.session');var QWeb=core.qweb;var _t=core._t;var MediaWidget=Widget.extend({xmlDependencies:['/web_editor/static/src/xml/wysiwyg.xml'],init:function(parent,media,options){this._super.apply(this,arguments);this.media=media;this.$media=$(media);},clear:function(){if(!this.media){return;}
this._clear();},save:function(){},_clear:function(){},});var SearchableMediaWidget=MediaWidget.extend({events:_.extend({},MediaWidget.prototype.events||{},{'input .o_we_search':'_onSearchInput',}),init:function(){this._super.apply(this,arguments);this._onSearchInput=_.debounce(this._onSearchInput,500);},search:function(needle){},_onSearchInput:function(ev){this.search($(ev.currentTarget).val()||'');this.hasSearched=true;},});var FileWidget=SearchableMediaWidget.extend({events:_.extend({},SearchableMediaWidget.prototype.events||{},{'click .o_upload_media_button':'_onUploadButtonClick','click .o_we_quick_upload':'_onQuickUploadClick','change .o_file_input':'_onFileInputChange','click .o_upload_media_url_button':'_onUploadURLButtonClick','input .o_we_url_input':'_onURLInputChange','click .o_existing_attachment_cell':'_onAttachmentClick','dblclick .o_existing_attachment_cell':'_onAttachmentDblClick','click .o_existing_attachment_remove':'_onRemoveClick','click .o_existing_attachment_optimize':'_onExistingOptimizeClick','click .o_load_more':'_onLoadMoreClick',}),existingAttachmentsTemplate:undefined,IMAGE_MIMETYPES:['image/gif','image/jpe','image/jpeg','image/jpg','image/gif','image/png','image/svg+xml'],NUMBER_OF_ATTACHMENTS_TO_DISPLAY:30,OPTIMIZE_SIZE_FACTOR:1.5,init:function(parent,media,options){this._super.apply(this,arguments);this._mutex=new concurrency.Mutex();this.numberOfAttachmentsToDisplay=this.NUMBER_OF_ATTACHMENTS_TO_DISPLAY;this.options=_.extend({firstFilters:[],lastFilters:[],showQuickUpload:config.isDebug(),},options||{});this.attachments=[];this.selectedAttachments=[];this._onUploadURLButtonClick=dom.makeAsyncHandler(this._onUploadURLButtonClick);},willStart:function(){return Promise.all([this._super.apply(this,arguments),this.search('',true)]);},start:function(){var def=this._super.apply(this,arguments);var self=this;this.$urlInput=this.$('.o_we_url_input');this.$form=this.$('form');this.$fileInput=this.$('.o_file_input');this.$uploadButton=this.$('.o_upload_media_button');this.$addUrlButton=this.$('.o_upload_media_url_button');this.$urlSuccess=this.$('.o_we_url_success');this.$urlWarning=this.$('.o_we_url_warning');this.$urlError=this.$('.o_we_url_error');this.$errorText=this.$('.o_we_error_text');this._renderImages();var o={url:null,alt:null,};if(this.$media.is('img')){o.url=this.$media.attr('src');}else if(this.$media.is('a.o_image')){o.url=this.$media.attr('href').replace(/[?].*/,'');o.id=+o.url.match(/\/web\/content\/(\d+)/,'')[1];}
if(o.url){self._selectAttachement(_.find(self.attachments,function(attachment){return attachment.url===o.url;})||o);}
return def;},save:function(){return this._mutex.exec(this._save.bind(this));},search:function(needle,noRender){var self=this;return this._rpc({model:'ir.attachment',method:'search_read',args:[],kwargs:{domain:this._getAttachmentsDomain(needle),fields:['name','mimetype','checksum','url','type','res_id','res_model','public','access_token','image_src','image_width','image_height'],order:[{name:'id',asc:false}],context:this.options.context,},}).then(function(attachments){self.attachments=_.chain(attachments).sortBy(function(r){if(_.any(self.options.firstFilters,function(filter){var regex=new RegExp(filter,'i');return r.name&&r.name.match(regex);})){return-1;}
if(_.any(self.options.lastFilters,function(filter){var regex=new RegExp(filter,'i');return r.name&&r.name.match(regex);})){return 1;}
return 0;}).value();if(!noRender){self._renderImages();}});},_clear:function(){if(!this.$media.is('img')){return;}
var allImgClasses=/(^|\s+)((img(\s|$)|img-(?!circle|rounded|thumbnail))[^\s]*)/g;var allImgClassModifiers=/(^|\s+)(rounded-circle|shadow|rounded|img-thumbnail|mx-auto)([^\s]*)/g;this.media.className=this.media.className&&this.media.className.replace('o_we_custom_image','').replace(allImgClasses,' ').replace(allImgClassModifiers,' ');},_computeOptimizedWidth:function(){return Math.min(1920,parseInt(this.options.mediaWidth*this.OPTIMIZE_SIZE_FACTOR));},_getAttachmentsDomain:function(needle){var domain=this.options.attachmentIDs&&this.options.attachmentIDs.length?['|',['id','in',this.options.attachmentIDs]]:[];var attachedDocumentDomain=['&',['res_model','=',this.options.res_model],['res_id','=',this.options.res_id|0]];if(!this.options.res_id){attachedDocumentDomain.unshift('&');attachedDocumentDomain.push(['create_uid','=',this.options.user_id]);}
if(this.options.data_res_model){var relatedDomain=['&',['res_model','=',this.options.data_res_model],['res_id','=',this.options.data_res_id|0]];if(!this.options.data_res_id){relatedDomain.unshift('&');relatedDomain.push(['create_uid','=',session.uid]);}
domain=domain.concat(['|'],attachedDocumentDomain,relatedDomain);}else{domain=domain.concat(attachedDocumentDomain);}
domain=['|',['public','=',true]].concat(domain);domain=domain.concat(this.options.mimetypeDomain);if(needle&&needle.length){domain.push(['name','ilike',needle]);}
domain.push('!',['name','=like','%.crop']);domain.push('|',['type','=','binary'],['url','!=',false]);return domain;},_highlightSelected:function(){var self=this;this.$('.o_existing_attachment_cell.o_we_attachment_selected').removeClass("o_we_attachment_selected");_.each(this.selectedAttachments,function(attachment){self.$('.o_existing_attachment_cell[data-id='+attachment.id+']').addClass("o_we_attachment_selected");});},_handleNewAttachment:function(attachment){this.attachments.unshift(attachment);this._renderImages();this._selectAttachement(attachment);},_loadMoreImages:function(forceSearch){this.numberOfAttachmentsToDisplay+=10;if(!forceSearch){this._renderImages();return Promise.resolve();}else{return this.search(this.$('.o_we_search').val()||'');}},_openImageOptimizeDialog:function(attachment,isExisting){var self=this;var promise=new Promise(function(resolve,reject){self.trigger_up('hide_parent_dialog_request');var optimizeDialog=new ImageOptimizeDialog(self,{attachment:attachment,isExisting:isExisting,optimizedWidth:self._computeOptimizedWidth(),}).open();optimizeDialog.on('attachment_updated',self,function(ev){optimizeDialog.off('closed');resolve(ev.data);});optimizeDialog.on('closed',self,function(){self.noSave=true;if(isExisting){reject();}else{resolve(attachment);}});});var always=function(){self.trigger_up('show_parent_dialog_request');};promise.then(always).guardedCatch(always);return promise;},_renderExisting:function(attachments){return QWeb.render(this.existingAttachmentsTemplate,{attachments:attachments,widget:this,});},_renderImages:function(){var attachments=this.attachments.slice(0,this.numberOfAttachmentsToDisplay);this.$('.o_we_existing_attachments').replaceWith(this._renderExisting(attachments));this._highlightSelected();var noLoadMoreButton=this.NUMBER_OF_ATTACHMENTS_TO_DISPLAY>=this.attachments.length;var noMoreImgToLoad=this.numberOfAttachmentsToDisplay>=this.attachments.length;this.$('.o_load_done_msg').toggleClass('d-none',noLoadMoreButton||!noMoreImgToLoad);this.$('.o_load_more').toggleClass('d-none',noMoreImgToLoad);},_save:function(){var self=this;if(this.options.multiImages){return Promise.resolve(this.selectedAttachments);}
var img=this.selectedAttachments[0];if(!img||!img.id){return Promise.resolve(this.media);}
var prom;if(!img.public&&!img.access_token){prom=this._rpc({model:'ir.attachment',method:'generate_access_token',args:[[img.id]]}).then(function(access_token){img.access_token=access_token[0];});}
return Promise.resolve(prom).then(function(){if(img.image_src){var src=img.image_src;if(!img.public&&img.access_token){src+=_.str.sprintf('?access_token=%s',img.access_token);}
if(!self.$media.is('img')){self.$media=$('<img/>',{class:'img-fluid o_we_custom_image'});self.media=self.$media[0];}
self.$media.attr('src',src);}else{if(!self.$media.is('a')){$('.note-control-selection').hide();self.$media=$('<a/>');self.media=self.$media[0];}
var href='/web/content/'+img.id+'?';if(!img.public&&img.access_token){href+=_.str.sprintf('access_token=%s&',img.access_token);}
href+='unique='+img.checksum+'&download=true';self.$media.attr('href',href);self.$media.addClass('o_image').attr('title',img.name).attr('data-mimetype',img.mimetype);}
self.$media.attr('alt',img.alt);var style=self.style;if(style){self.$media.css(style);}
if(self.$media.attr('data-aspect-ratio')){var attrs=['aspect-ratio','x','y','width','height','rotate','scale-x','scale-y'];_.each(attrs,function(attr){self.$media.removeData(attr);self.$media.removeAttr('data-'+attr);});}
return self.media;});},_selectAttachement:function(attachment,save){if(this.options.multiImages){var index=this.selectedAttachments.indexOf(attachment);if(index!==-1){if(!save){this.selectedAttachments.splice(index,1);}}else{this.selectedAttachments.push(attachment);}}else{this.selectedAttachments=[attachment];}
this._highlightSelected();if(save){this.trigger_up('save_request');}},_updateAddUrlUi:function(emptyValue,isURL,isImage){this.$addUrlButton.toggleClass('btn-secondary',emptyValue).toggleClass('btn-primary',!emptyValue).prop('disabled',!isURL);this.$urlSuccess.toggleClass('d-none',!isURL);this.$urlError.toggleClass('d-none',emptyValue||isURL);},_onAttachmentClick:function(ev,save){var $attachment=$(ev.currentTarget);var attachment=_.find(this.attachments,{id:$attachment.data('id')});this._selectAttachement(attachment,save);},_onAttachmentDblClick:function(ev){this._onAttachmentClick(ev,true);},_onExistingOptimizeClick:function(ev){var self=this;var $a=$(ev.currentTarget).closest('.o_existing_attachment_cell');var id=parseInt($a.data('id'),10);var attachment=_.findWhere(this.attachments,{id:id});ev.stopPropagation();return this._openImageOptimizeDialog(attachment,true).then(function(newAttachment){self._handleNewAttachment(newAttachment);});},_onFileInputChange:function(){return this._mutex.exec(this._addData.bind(this));},_addData:function(){var self=this;var uploadMutex=new concurrency.Mutex();var optimizeMutex=new concurrency.Mutex();var files=_.sortBy(this.$fileInput[0].files,'size');_.each(files,function(file){uploadMutex.exec(function(){return utils.getDataURLFromFile(file).then(function(result){var params={'name':file.name,'data':result.split(',')[1],'res_id':self.options.res_id,'res_model':self.options.res_model,'filters':self.options.firstFilters.join('_'),};if(self.quickUpload){params['width']=self._computeOptimizedWidth();params['quality']=80;}else{params['width']=0;params['quality']=0;}
return self._rpc({route:'/web_editor/attachment/add_data',params:params,}).then(function(attachment){if(attachment.image_src&&!self.quickUpload){optimizeMutex.exec(function(){return self._openImageOptimizeDialog(attachment).then(function(updatedAttachment){self._handleNewAttachment(updatedAttachment);});});}else{self._handleNewAttachment(attachment);}});});});});return uploadMutex.getUnlockedDef().then(function(){return optimizeMutex.getUnlockedDef().then(function(){self.quickUpload=false;if(!self.options.multiImages&&!self.noSave){self.trigger_up('save_request');}
self.noSave=false;});});},_onQuickUploadClick:function(){this.quickUpload=true;this.$uploadButton.trigger('click');},_onRemoveClick:function(ev){var self=this;ev.stopPropagation();Dialog.confirm(this,_t("Are you sure you want to delete this file ?"),{confirm_callback:function(){var $a=$(ev.currentTarget).closest('.o_existing_attachment_cell');var id=parseInt($a.data('id'),10);var attachment=_.findWhere(self.attachments,{id:id});return self._rpc({route:'/web_editor/attachment/remove',params:{ids:[id],},}).then(function(prevented){if(_.isEmpty(prevented)){self.attachments=_.without(self.attachments,attachment);if(!self.attachments.length){self._renderImages();}else{$a.closest('.o_existing_attachment_cell').remove();}
return;}
self.$errorText.replaceWith(QWeb.render('wysiwyg.widgets.image.existing.error',{views:prevented[id],widget:self,}));});}});},_onURLInputChange:function(){var inputValue=this.$urlInput.val();var emptyValue=(inputValue==='');var isURL=/^.+\..+$/.test(inputValue);var isImage=_.any(['.gif','.jpeg','.jpe','.jpg','.png'],function(format){return inputValue.endsWith(format);});this._updateAddUrlUi(emptyValue,isURL,isImage);},_onUploadButtonClick:function(){this.$fileInput.click();},_onUploadURLButtonClick:function(){return this._mutex.exec(this._addUrl.bind(this));},_addUrl:function(){var self=this;return this._rpc({route:'/web_editor/attachment/add_url',params:{'url':this.$urlInput.val(),'res_id':this.options.res_id,'res_model':this.options.res_model,'filters':this.options.firstFilters.join('_'),},}).then(function(attachment){self.$urlInput.val('');self._onURLInputChange();self._handleNewAttachment(attachment);if(!self.options.multiImages){self.trigger_up('save_request');}});},_onLoadMoreClick:function(){this._loadMoreImages();},_onSearchInput:function(){this.numberOfAttachmentsToDisplay=this.NUMBER_OF_ATTACHMENTS_TO_DISPLAY;this._super.apply(this,arguments);},});var ImageWidget=FileWidget.extend({template:'wysiwyg.widgets.image',existingAttachmentsTemplate:'wysiwyg.widgets.image.existing.attachments',init:function(parent,media,options){options=_.extend({accept:'image/*',mimetypeDomain:[['mimetype','in',this.IMAGE_MIMETYPES]],},options||{});this._super(parent,media,options);},_updateAddUrlUi:function(emptyValue,isURL,isImage){this._super.apply(this,arguments);this.$addUrlButton.text((isURL&&!isImage)?_t("Add as document"):_t("Add image"));this.$urlWarning.toggleClass('d-none',!isURL||isImage);},});var DocumentWidget=FileWidget.extend({template:'wysiwyg.widgets.document',existingAttachmentsTemplate:'wysiwyg.widgets.document.existing.attachments',init:function(parent,media,options){options=_.extend({accept:'*/*',mimetypeDomain:[['mimetype','not in',this.IMAGE_MIMETYPES]],},options||{});this._super(parent,media,options);},_updateAddUrlUi:function(emptyValue,isURL,isImage){this._super.apply(this,arguments);this.$addUrlButton.text((isURL&&isImage)?_t("Add as image"):_t("Add document"));this.$urlWarning.toggleClass('d-none',!isURL||!isImage);},_getAttachmentsDomain:function(needle){var domain=this._super.apply(this,arguments);return domain.concat('!',utils.assetsDomain());},});var IconWidget=SearchableMediaWidget.extend({template:'wysiwyg.widgets.font-icons',events:_.extend({},SearchableMediaWidget.prototype.events||{},{'click .font-icons-icon':'_onIconClick','dblclick .font-icons-icon':'_onIconDblClick',}),init:function(parent,media){this._super.apply(this,arguments);fonts.computeFonts();this.iconsParser=fonts.fontIcons;this.alias=_.flatten(_.map(this.iconsParser,function(data){return data.alias;}));},start:function(){this.$icons=this.$('.font-icons-icon');var classes=(this.media&&this.media.className||'').split(/\s+/);for(var i=0;i<classes.length;i++){var cls=classes[i];if(_.contains(this.alias,cls)){this.selectedIcon=cls;this._highlightSelectedIcon();}}
this.nonIconClasses=_.without(classes,'media_iframe_video',this.selectedIcon);return this._super.apply(this,arguments);},save:function(){var style=this.$media.attr('style')||'';var iconFont=this._getFont(this.selectedIcon)||{base:'fa',font:''};var finalClasses=_.uniq(this.nonIconClasses.concat([iconFont.base,iconFont.font]));if(!this.$media.is('span')){var $span=$('<span/>');$span.data(this.$media.data());this.$media=$span;this.media=this.$media[0];style=style.replace(/\s*width:[^;]+/,'');}
this.$media.attr({class:_.compact(finalClasses).join(' '),style:style||null,});return Promise.resolve(this.media);},search:function(needle){var iconsParser=this.iconsParser;if(needle&&needle.length){iconsParser=[];_.filter(this.iconsParser,function(data){var cssData=_.filter(data.cssData,function(cssData){return _.find(cssData.names,function(alias){return alias.indexOf(needle)>=0;});});if(cssData.length){iconsParser.push({base:data.base,cssData:cssData,});}});}
this.$('div.font-icons-icons').html(QWeb.render('wysiwyg.widgets.font-icons.icons',{iconsParser:iconsParser,widget:this}));return Promise.resolve();},_clear:function(){var allFaClasses=/(^|\s)(fa(\s|$)|fa-[^\s]*)/g;this.media.className=this.media.className&&this.media.className.replace(allFaClasses,' ');},_getFont:function(classNames){if(!(classNames instanceof Array)){classNames=(classNames||"").split(/\s+/);}
var fontIcon,cssData;for(var k=0;k<this.iconsParser.length;k++){fontIcon=this.iconsParser[k];for(var s=0;s<fontIcon.cssData.length;s++){cssData=fontIcon.cssData[s];if(_.intersection(classNames,cssData.names).length){return{base:fontIcon.base,parser:fontIcon.parser,font:cssData.names[0],};}}}
return null;},_highlightSelectedIcon:function(){var self=this;this.$icons.removeClass('o_we_attachment_selected');this.$icons.filter(function(i,el){return _.contains($(el).data('alias').split(','),self.selectedIcon);}).addClass('o_we_attachment_selected');},_onIconClick:function(ev){ev.preventDefault();ev.stopPropagation();this.selectedIcon=$(ev.currentTarget).data('id');this._highlightSelectedIcon();},_onIconDblClick:function(){this.trigger_up('save_request');},});var VideoWidget=MediaWidget.extend({template:'wysiwyg.widgets.video',events:_.extend({},MediaWidget.prototype.events||{},{'change .o_video_dialog_options input':'_onUpdateVideoOption','input textarea#o_video_text':'_onVideoCodeInput','change textarea#o_video_text':'_onVideoCodeChange',}),init:function(parent,media){this._super.apply(this,arguments);this._onVideoCodeInput=_.debounce(this._onVideoCodeInput,1000);},start:function(){this.$content=this.$('.o_video_dialog_iframe');if(this.media){var $media=$(this.media);var src=$media.data('oe-expression')||$media.data('src')||'';this.$('textarea#o_video_text').val(src);this.$('input#o_video_autoplay').prop('checked',src.indexOf('autoplay=1')>=0);this.$('input#o_video_hide_controls').prop('checked',src.indexOf('controls=0')>=0);this.$('input#o_video_loop').prop('checked',src.indexOf('loop=1')>=0);this.$('input#o_video_hide_fullscreen').prop('checked',src.indexOf('fs=0')>=0);this.$('input#o_video_hide_yt_logo').prop('checked',src.indexOf('modestbranding=1')>=0);this.$('input#o_video_hide_dm_logo').prop('checked',src.indexOf('ui-logo=0')>=0);this.$('input#o_video_hide_dm_share').prop('checked',src.indexOf('sharing-enable=0')>=0);this._updateVideo();}
return this._super.apply(this,arguments);},save:function(){this._updateVideo();if(this.$('.o_video_dialog_iframe').is('iframe')){this.$media=$('<div class="media_iframe_video" data-oe-expression="'+this.$content.attr('src')+'">'+'<div class="css_editable_mode_display">&nbsp;</div>'+'<div class="media_iframe_video_size" contenteditable="false">&nbsp;</div>'+'<iframe src="'+this.$content.attr('src')+'" frameborder="0" contenteditable="false"></iframe>'+'</div>');this.media=this.$media[0];}
return Promise.resolve(this.media);},_clear:function(){if(this.media.dataset.src){try{delete this.media.dataset.src;}catch(e){this.media.dataset.src=undefined;}}
var allVideoClasses=/(^|\s)media_iframe_video(\s|$)/g;var isVideo=this.media.className&&this.media.className.match(allVideoClasses);if(isVideo){this.media.className=this.media.className.replace(allVideoClasses,' ');this.media.innerHTML='';}},_createVideoNode:function(url,options){options=options||{};var ytRegExp=/^(?:(?:https?:)?\/\/)?(?:www\.)?(?:youtu\.be\/|youtube(-nocookie)?\.com\/(?:embed\/|v\/|watch\?v=|watch\?.+&v=))((?:\w|-){11})(?:\S+)?$/;var ytMatch=url.match(ytRegExp);var insRegExp=/(.*)instagram.com\/p\/(.[a-zA-Z0-9]*)/;var insMatch=url.match(insRegExp);var vinRegExp=/\/\/vine.co\/v\/(.[a-zA-Z0-9]*)/;var vinMatch=url.match(vinRegExp);var vimRegExp=/\/\/(player.)?vimeo.com\/([a-z]*\/)*([0-9]{6,11})[?]?.*/;var vimMatch=url.match(vimRegExp);var dmRegExp=/.+dailymotion.com\/(video|hub|embed)\/([^_]+)[^#]*(#video=([^_&]+))?/;var dmMatch=url.match(dmRegExp);var ykuRegExp=/(.*).youku\.com\/(v_show\/id_|embed\/)(.+)/;var ykuMatch=url.match(ykuRegExp);var $video=$('<iframe>').width(1280).height(720).attr('frameborder',0).addClass('o_video_dialog_iframe');var videoType='yt';if(!/^(http:\/\/|https:\/\/|\/\/)[a-z0-9]+([\-\.]{1}[a-z0-9]+)*\.[a-z]{2,5}(:[0-9]{1,5})?(\/.*)?$/i.test(url)){return{errorCode:0};}
var autoplay=options.autoplay?'?autoplay=1&mute=1':'?autoplay=0';if(ytMatch&&ytMatch[2].length===11){$video.attr('src','//www.youtube'+(ytMatch[1]||'')+'.com/embed/'+ytMatch[2]+autoplay);}else if(insMatch&&insMatch[2].length){$video.attr('src','//www.instagram.com/p/'+insMatch[2]+'/embed/');videoType='ins';}else if(vinMatch&&vinMatch[0].length){$video.attr('src',vinMatch[0]+'/embed/simple');videoType='vin';}else if(vimMatch&&vimMatch[3].length){$video.attr('src','//player.vimeo.com/video/'+vimMatch[3]+autoplay);videoType='vim';}else if(dmMatch&&dmMatch[2].length){var justId=dmMatch[2].replace('video/','');$video.attr('src','//www.dailymotion.com/embed/video/'+justId+autoplay);videoType='dm';}else if(ykuMatch&&ykuMatch[3].length){var ykuId=ykuMatch[3].indexOf('.html?')>=0?ykuMatch[3].substring(0,ykuMatch[3].indexOf('.html?')):ykuMatch[3];$video.attr('src','//player.youku.com/embed/'+ykuId);videoType='yku';}else{return{errorCode:1};}
if(ytMatch){$video.attr('src',$video.attr('src')+'&rel=0');}
if(options.loop&&(ytMatch||vimMatch)){var videoSrc=_.str.sprintf('%s&loop=1',$video.attr('src'));$video.attr('src',ytMatch?_.str.sprintf('%s&playlist=%s',videoSrc,ytMatch[2]):videoSrc);}
if(options.hide_controls&&(ytMatch||dmMatch)){$video.attr('src',$video.attr('src')+'&controls=0');}
if(options.hide_fullscreen&&ytMatch){$video.attr('src',$video.attr('src')+'&fs=0');}
if(options.hide_yt_logo&&ytMatch){$video.attr('src',$video.attr('src')+'&modestbranding=1');}
if(options.hide_dm_logo&&dmMatch){$video.attr('src',$video.attr('src')+'&ui-logo=0');}
if(options.hide_dm_share&&dmMatch){$video.attr('src',$video.attr('src')+'&sharing-enable=0');}
return{$video:$video,type:videoType};},_updateVideo:function(){this.$content.empty();this.$('#o_video_form_group').removeClass('o_has_error o_has_success').find('.form-control, .custom-select').removeClass('is-invalid is-valid');this.$('.o_video_dialog_options div').addClass('d-none');var $textarea=this.$('textarea#o_video_text');var code=$textarea.val().trim();if(!code){return;}
var embedMatch=code.match(/(src|href)=["']?([^"']+)?/);if(embedMatch&&embedMatch[2].length>0&&embedMatch[2].indexOf('instagram')){embedMatch[1]=embedMatch[2];}
var url=embedMatch?embedMatch[1]:code;var query=this._createVideoNode(url,{autoplay:this.$('input#o_video_autoplay').is(':checked'),hide_controls:this.$('input#o_video_hide_controls').is(':checked'),loop:this.$('input#o_video_loop').is(':checked'),hide_fullscreen:this.$('input#o_video_hide_fullscreen').is(':checked'),hide_yt_logo:this.$('input#o_video_hide_yt_logo').is(':checked'),hide_dm_logo:this.$('input#o_video_hide_dm_logo').is(':checked'),hide_dm_share:this.$('input#o_video_hide_dm_share').is(':checked'),});var $optBox=this.$('.o_video_dialog_options');this.$el.find('.o_video_dialog_preview_text, .media_iframe_video_size').add($optBox).toggleClass('d-none',!query.$video);this.$el.find('#o_video_form_group').toggleClass('o_has_error',!query.$video).find('.form-control, .custom-select').toggleClass('is-invalid',!query.$video).end().toggleClass('o_has_success',!!query.$video).find('.form-control, .custom-select').toggleClass('is-valid',!!query.$video);$optBox.find('div.o_'+query.type+'_option').removeClass('d-none');$optBox.toggleClass('d-none',$optBox.find('div:not(.d-none)').length===0);if(query.type==='yt'){this.$('input#o_video_hide_fullscreen, input#o_video_hide_yt_logo').closest('div').toggleClass('d-none',this.$('input#o_video_hide_controls').is(':checked'));}
var $content=query.$video;if(!$content){switch(query.errorCode){case 0:$content=$('<div/>',{class:'alert alert-danger o_video_dialog_iframe mb-2 mt-2',text:_t("The provided url is not valid"),});break;case 1:$content=$('<div/>',{class:'alert alert-warning o_video_dialog_iframe mb-2 mt-2',text:_t("The provided url does not reference any supported video"),});break;}}
this.$content.replaceWith($content);this.$content=$content;},_onUpdateVideoOption:function(){this._updateVideo();},_onVideoCodeChange:function(){this._updateVideo();},_onVideoCodeInput:function(){this._updateVideo();},});return{MediaWidget:MediaWidget,SearchableMediaWidget:SearchableMediaWidget,FileWidget:FileWidget,ImageWidget:ImageWidget,DocumentWidget:DocumentWidget,IconWidget:IconWidget,VideoWidget:VideoWidget,};});;

/* /web_editor/static/src/js/wysiwyg/widgets/dialog.js defined in bundle 'web_editor.assets_wysiwyg' */
odoo.define('wysiwyg.widgets.Dialog',function(require){'use strict';var core=require('web.core');var Dialog=require('web.Dialog');var _t=core._t;var SummernoteDialog=Dialog.extend({init:function(parent,options){this.options=options||{};this._super(parent,_.extend({},{buttons:[{text:this.options.save_text||_t("Save"),classes:'btn-primary',click:this.save,},{text:_t("Discard"),close:true,}]},this.options));this.destroyAction='cancel';var self=this;this.opened(function(){self.$('input:first').focus();self.$el.closest('.modal').on('hidden.bs.modal',self.options.onClose);});this.on('closed',this,function(){this.trigger(this.destroyAction,this.final_data||null);});},save:function(){this.destroyAction="save";this.close();},});return SummernoteDialog;});;

/* /web_editor/static/src/js/wysiwyg/widgets/alt_dialog.js defined in bundle 'web_editor.assets_wysiwyg' */
odoo.define('wysiwyg.widgets.AltDialog',function(require){'use strict';var core=require('web.core');var Dialog=require('wysiwyg.widgets.Dialog');var _t=core._t;var AltDialog=Dialog.extend({template:'wysiwyg.widgets.alt',xmlDependencies:Dialog.prototype.xmlDependencies.concat(['/web_editor/static/src/xml/wysiwyg.xml']),init:function(parent,options,media){options=options||{};this._super(parent,_.extend({},{title:_t("Change media description and tooltip")},options));this.trigger_up('getRecordInfo',{recordInfo:options,callback:function(recordInfo){_.defaults(options,recordInfo);},});this.media=media;var allEscQuots=/&quot;/g;this.alt=($(this.media).attr('alt')||"").replace(allEscQuots,'"');var title=$(this.media).attr('title')||$(this.media).data('original-title')||"";this.tag_title=(title).replace(allEscQuots,'"');},save:function(){var alt=this.$('#alt').val();var title=this.$('#title').val();var allNonEscQuots=/"/g;$(this.media).attr('alt',alt?alt.replace(allNonEscQuots,"&quot;"):null).attr('title',title?title.replace(allNonEscQuots,"&quot;"):null);this.final_data=this.media;return this._super.apply(this,arguments);},});return AltDialog;});;

/* /web_editor/static/src/js/wysiwyg/widgets/crop_dialog.js defined in bundle 'web_editor.assets_wysiwyg' */
odoo.define('wysiwyg.widgets.CropImageDialog',function(require){'use strict';var core=require('web.core');var Dialog=require('wysiwyg.widgets.Dialog');var _t=core._t;var CropImageDialog=Dialog.extend({template:'wysiwyg.widgets.crop_image',xmlDependencies:Dialog.prototype.xmlDependencies.concat(['/web_editor/static/src/xml/wysiwyg.xml']),jsLibs:['/web_editor/static/lib/cropper/js/cropper.js',],cssLibs:['/web_editor/static/lib/cropper/css/cropper.css',],events:_.extend({},Dialog.prototype.events,{'click .o_crop_options [data-event]':'_onCropOptionClick',}),init:function(parent,options,media){var self=this;this.media=media;this.$media=$(this.media);var src=this.$media.attr('src').split('?')[0];this.aspectRatioList=[[_t("Free"),'0/0',0],["16:9",'16/9',16/9],["4:3",'4/3',4/3],["1:1",'1/1',1],["2:3",'2/3',2/3],];this.imageData={imageSrc:src,originalSrc:this.$media.data('crop:originalSrc')||src,mimetype:this.$media.data('crop:mimetype')||(_.str.endsWith(src,'.png')?'image/png':'image/jpeg'),aspectRatio:this.$media.data('aspectRatio')||this.aspectRatioList[0][1],isExternalImage:src.substr(0,5)!=='data:'&&src[0]!=='/'&&src.indexOf(window.location.host)<0,};this.options=_.extend({title:_t("Crop Image"),buttons:this.imageData.isExternalImage?[{text:_t("Close"),close:true,}]:[{text:_t("Save"),classes:'btn-primary',click:this.save,},{text:_t("Discard"),close:true,}],},options||{});this._super(parent,this.options);this.trigger_up('getRecordInfo',_.extend(this.options,{callback:function(recordInfo){_.defaults(self.options,recordInfo);},}));},willStart:function(){var self=this;var def=this._super.apply(this,arguments);if(this.imageData.isExternalImage){return def;}
var defs=[def];var params={};var isDBImage=false;var matchImageID=this.imageData.imageSrc.match(/^\/web\/image\/(\d+)/);if(matchImageID){params.image_id=parseInt(matchImageID[1]);isDBImage=true;}else{var matchXmlID=this.imageData.imageSrc.match(/^\/web\/image\/([^/?]+)/);if(matchXmlID){params.xml_id=matchXmlID[1];isDBImage=true;}}
if(isDBImage){defs.push(this._rpc({route:'/web_editor/get_image_info',params:params,}).then(function(res){_.extend(self.imageData,res);}));}
return Promise.all(defs);},start:function(){this.$cropperImage=this.$('.o_cropper_image');if(this.$cropperImage.length){var data=this.$media.data();var ratio=0;for(var i=0;i<this.aspectRatioList.length;i++){if(this.aspectRatioList[i][1]===data.aspectRatio){ratio=this.aspectRatioList[i][2];break;}}
this.$cropperImage.cropper({viewMode:1,autoCropArea:1,aspectRatio:ratio,data:_.pick(data,'x','y','width','height','rotate','scaleX','scaleY')});}
return this._super.apply(this,arguments);},destroy:function(){if(this.$cropperImage.length){this.$cropperImage.cropper('destroy');}
this._super.apply(this,arguments);},save:function(){var self=this;var cropperData=this.$cropperImage.cropper('getData');this.$media.addClass('o_cropped_img_to_save');this.$media.data('crop:resModel',this.options.res_model);this.$media.data('crop:resID',this.options.res_id);this.$media.data('crop:id',this.imageData.id);this.$media.data('crop:mimetype',this.imageData.mimetype);this.$media.data('crop:originalSrc',this.imageData.originalSrc);this.$media.attr('data-aspect-ratio',this.imageData.aspectRatio).data('aspectRatio',this.imageData.aspectRatio);_.each(cropperData,function(value,key){key=_.str.dasherize(key);self.$media.attr('data-'+key,value);self.$media.data(key,value);});var canvas=this.$cropperImage.cropper('getCroppedCanvas',{width:cropperData.width,height:cropperData.height,});this.$media.attr('src',canvas.toDataURL(this.imageData.mimetype));this.final_data=this.media;return this._super.apply(this,arguments);},_onCropOptionClick:function(ev){var $option=$(ev.currentTarget);var opt=$option.data('event');var value=$option.data('value');switch(opt){case'ratio':this.$cropperImage.cropper('reset');this.imageData.aspectRatio=$option.data('label');this.$cropperImage.cropper('setAspectRatio',value);break;case'zoom':case'rotate':case'reset':this.$cropperImage.cropper(opt,value);break;case'flip':var direction=value==='horizontal'?'x':'y';var scaleAngle=-$option.data(direction);$option.data(direction,scaleAngle);this.$cropperImage.cropper('scale'+direction.toUpperCase(),scaleAngle);break;}},});return CropImageDialog;});;

/* /web_editor/static/src/js/wysiwyg/widgets/link_dialog.js defined in bundle 'web_editor.assets_wysiwyg' */
odoo.define('wysiwyg.widgets.LinkDialog',function(require){'use strict';var core=require('web.core');var Dialog=require('wysiwyg.widgets.Dialog');var _t=core._t;var LinkDialog=Dialog.extend({template:'wysiwyg.widgets.link',xmlDependencies:(Dialog.prototype.xmlDependencies||[]).concat(['/web_editor/static/src/xml/wysiwyg.xml']),events:_.extend({},Dialog.prototype.events||{},{'input':'_onAnyChange','change':'_onAnyChange','input input[name="url"]':'_onURLInput',}),init:function(parent,options,linkInfo){var self=this;this.options=options||{};this._super(parent,_.extend({title:_t("Link to"),},this.options));this.trigger_up('getRecordInfo',{recordInfo:this.options,callback:function(recordInfo){_.defaults(self.options,recordInfo);},});this.data=linkInfo||{};this.needLabel=linkInfo.needLabel;this.data.iniClassName=linkInfo.className||'';var allBtnClassSuffixes=/(^|\s+)btn(-[a-z0-9_-]*)?/gi;var allBtnShapes=/\s*(rounded-circle|flat)\s*/gi;this.data.className=this.data.iniClassName.replace(allBtnClassSuffixes,' ').replace(allBtnShapes,' ');},start:function(){var self=this;this.$('input.link-style').prop('checked',false).first().prop('checked',true);if(this.data.iniClassName){this.$('input[name="link_style_color"], select[name="link_style_size"] > option, select[name="link_style_shape"] > option').each(function(){var $option=$(this);if($option.val()&&self.data.iniClassName.match(new RegExp('(^|btn-| |btn-outline-)'+$option.val()))){if($option.is("input")){$option.prop("checked",true);}else{$option.parent().find('option').removeAttr('selected').removeProp('selected');$option.parent().val($option.val());$option.attr('selected','selected').prop('selected','selected');}}});}
if(this.data.url){var match=/mailto:(.+)/.exec(this.data.url);this.$('input[name="url"]').val(match?match[1]:this.data.url);}
this.opened().then(function(){var colors=[];_.each(self.$('.o_link_dialog_color .o_btn_preview'),function(btn){var $btn=$(btn);var color=$btn.css('background-color');if(_.contains(colors,color)){$btn.hide();}else{colors.push(color);}});});this._adaptPreview();this.$('input:visible:first').focus();return this._super.apply(this,arguments);},save:function(){var data=this._getData();if(data===null){var $url=this.$('input[name="url"]');$url.closest('.form-group').addClass('o_has_error').find('.form-control, .custom-select').addClass('is-invalid');$url.focus();return Promise.reject();}
this.data.text=data.label;this.data.url=data.url;var allWhitespace=/\s+/gi;var allStartAndEndSpace=/^\s+|\s+$/gi;var allBtnTypes=/(^|[ ])(btn-secondary|btn-success|btn-primary|btn-info|btn-warning|btn-danger)([ ]|$)/gi;this.data.className=data.classes.replace(allWhitespace,' ').replace(allStartAndEndSpace,'');if(data.classes.replace(allBtnTypes,' ')){this.data.style={'background-color':'','color':'',};}
this.data.isNewWindow=data.isNewWindow;this.final_data=this.data;return this._super.apply(this,arguments);},_adaptPreview:function(){var $preview=this.$("#link-preview");var data=this._getData();if(data===null){return;}
var floatClass=/float-\w+/;$preview.attr({target:data.isNewWindow?'_blank':'',href:data.url&&data.url.length?data.url:'#',class:data.classes.replace(floatClass,'')+' o_btn_preview',}).html((data.label&&data.label.length)?data.label:data.url);},_getData:function(){var $url=this.$('input[name="url"]');var url=$url.val();var label=this.$('input[name="label"]').val()||url;if(label&&this.data.images){for(var i=0;i<this.data.images.length;i++){label=label.replace('<',"&lt;").replace('>',"&gt;").replace(/\[IMG\]/,this.data.images[i].outerHTML);}}
if($url.prop('required')&&(!url||!$url[0].checkValidity())){return null;}
var style=this.$('input[name="link_style_color"]:checked').val()||'';var shape=this.$('select[name="link_style_shape"] option:selected').val()||'';var size=this.$('select[name="link_style_size"] option:selected').val()||'';var shapes=shape.split(',');var outline=shapes[0]==='outline';shape=shapes.slice(outline?1:0).join(' ');var classes=(this.data.className||'')+
(style?(' btn btn-'+(outline?'outline-':'')+style):'')+
(shape?(' '+shape):'')+
(size?(' btn-'+size):'');var isNewWindow=this.$('input[name="is_new_window"]').prop('checked');if(url.indexOf('@')>=0&&url.indexOf('mailto:')<0&&!url.match(/^http[s]?/i)){url=('mailto:'+url);}
var allWhitespace=/\s+/gi;var allStartAndEndSpace=/^\s+|\s+$/gi;return{label:label,url:url,classes:classes.replace(allWhitespace,' ').replace(allStartAndEndSpace,''),isNewWindow:isNewWindow,};},_onAnyChange:function(){this._adaptPreview();},_onURLInput:function(){var $linkUrlInput=this.$('#o_link_dialog_url_input');$linkUrlInput.closest('.form-group').removeClass('o_has_error').find('.form-control, .custom-select').removeClass('is-invalid');var isLink=$linkUrlInput.val().indexOf('@')<0;this.$('input[name="is_new_window"]').closest('.form-group').toggleClass('d-none',!isLink);},});return LinkDialog;});;

/* /web_editor/static/src/js/wysiwyg/widgets/media_dialog.js defined in bundle 'web_editor.assets_wysiwyg' */
odoo.define('wysiwyg.widgets.MediaDialog',function(require){'use strict';var core=require('web.core');var MediaModules=require('wysiwyg.widgets.media');var Dialog=require('wysiwyg.widgets.Dialog');var _t=core._t;var MediaDialog=Dialog.extend({template:'wysiwyg.widgets.media',xmlDependencies:Dialog.prototype.xmlDependencies.concat(['/web_editor/static/src/xml/wysiwyg.xml']),events:_.extend({},Dialog.prototype.events,{'click #editor-media-image-tab':'_onClickImageTab','click #editor-media-document-tab':'_onClickDocumentTab','click #editor-media-icon-tab':'_onClickIconTab','click #editor-media-video-tab':'_onClickVideoTab',}),custom_events:_.extend({},Dialog.prototype.custom_events||{},{save_request:'_onSaveRequest',show_parent_dialog_request:'_onShowRequest',hide_parent_dialog_request:'_onHideRequest',}),init:function(parent,options,media){var $media=$(media);media=$media[0];options=_.extend({},options);var onlyImages=options.onlyImages||this.multiImages||(media&&($media.parent().data('oeField')==='image'||$media.parent().data('oeType')==='image'));options.noDocuments=onlyImages||options.noDocuments;options.noIcons=onlyImages||options.noIcons;options.noVideos=onlyImages||options.noVideos;this._super(parent,_.extend({},{title:_t("Select a Media"),save_text:_t("Add"),},options));this.trigger_up('getRecordInfo',{recordInfo:options,type:'media',callback:function(recordInfo){_.defaults(options,recordInfo);},});if(!options.noImages){this.imageWidget=new MediaModules.ImageWidget(this,media,options);}
if(!options.noDocuments){this.documentWidget=new MediaModules.DocumentWidget(this,media,options);}
if(!options.noIcons){this.iconWidget=new MediaModules.IconWidget(this,media,options);}
if(!options.noVideos){this.videoWidget=new MediaModules.VideoWidget(this,media,options);}
if(this.imageWidget&&$media.is('img')){this.activeWidget=this.imageWidget;}else if(this.documentWidget&&$media.is('a.o_image')){this.activeWidget=this.documentWidget;}else if(this.videoWidget&&$media.hasClass('media_iframe_video')){this.activeWidget=this.videoWidget;}else if(this.iconWidget&&$media.is('span, i')){this.activeWidget=this.iconWidget;}else if(this.imageWidget){this.activeWidget=this.imageWidget;}},start:function(){var promises=[this._super.apply(this,arguments)];this.$modal.find('.modal-dialog').addClass('o_select_media_dialog');if(this.imageWidget){promises.push(this.imageWidget.appendTo(this.$("#editor-media-image")));}
if(this.documentWidget){promises.push(this.documentWidget.appendTo(this.$("#editor-media-document")));}
if(this.iconWidget){promises.push(this.iconWidget.appendTo(this.$("#editor-media-icon")));}
if(this.videoWidget){promises.push(this.videoWidget.appendTo(this.$("#editor-media-video")));}
return Promise.all(promises);},isDocumentActive:function(){return this.activeWidget===this.documentWidget;},isIconActive:function(){return this.activeWidget===this.iconWidget;},isImageActive:function(){return this.activeWidget===this.imageWidget;},isVideoActive:function(){return this.activeWidget===this.videoWidget;},save:function(){var self=this;var _super=this._super;var args=arguments;return this.activeWidget.save().then(function(data){self._clearWidgets();self.final_data=data;_super.apply(self,args);$(data).trigger('content_changed');});},_clearWidgets:function(){[this.imageWidget,this.documentWidget,this.iconWidget,this.videoWidget].forEach((widget)=>{if(widget!==this.activeWidget){widget&&widget.clear();}});},_onClickDocumentTab:function(){this.activeWidget=this.documentWidget;},_onClickIconTab:function(){this.activeWidget=this.iconWidget;},_onClickImageTab:function(){this.activeWidget=this.imageWidget;},_onClickVideoTab:function(){this.activeWidget=this.videoWidget;},_onHideRequest:function(ev){this.$modal.addClass('d-none');},_onSaveRequest:function(ev){ev.stopPropagation();this.save();},_onShowRequest:function(ev){this.$modal.removeClass('d-none');},});return MediaDialog;});;

/* /web_editor/static/src/js/wysiwyg/widgets/widgets.js defined in bundle 'web_editor.assets_wysiwyg' */
odoo.define('wysiwyg.widgets',function(require){'use strict';var Dialog=require('wysiwyg.widgets.Dialog');var AltDialog=require('wysiwyg.widgets.AltDialog');var MediaDialog=require('wysiwyg.widgets.MediaDialog');var LinkDialog=require('wysiwyg.widgets.LinkDialog');var CropImageDialog=require('wysiwyg.widgets.CropImageDialog');var ColorpickerDialog=require('web.ColorpickerDialog');var media=require('wysiwyg.widgets.media');return{Dialog:Dialog,AltDialog:AltDialog,MediaDialog:MediaDialog,LinkDialog:LinkDialog,CropImageDialog:CropImageDialog,ColorpickerDialog:ColorpickerDialog,MediaWidget:media.MediaWidget,SearchableMediaWidget:media.SearchableMediaWidget,FileWidget:media.FileWidget,ImageWidget:media.ImageWidget,DocumentWidget:media.DocumentWidget,IconWidget:media.IconWidget,VideoWidget:media.VideoWidget,};});;

/* /web_editor/static/src/js/wysiwyg/wysiwyg.js defined in bundle 'web_editor.assets_wysiwyg' */
odoo.define('web_editor.wysiwyg',function(require){'use strict';var Widget=require('web.Widget');var SummernoteManager=require('web_editor.rte.summernote');var summernoteCustomColors=require('web_editor.rte.summernote_custom_colors');var id=0;var Wysiwyg=Widget.extend({xmlDependencies:[],defaultOptions:{'focus':false,'toolbar':[['style',['style']],['font',['bold','italic','underline','clear']],['fontsize',['fontsize']],['color',['color']],['para',['ul','ol','paragraph']],['table',['table']],['insert',['link','picture']],['history',['undo','redo']],],'styleWithSpan':false,'inlinemedia':['p'],'lang':'odoo','colors':summernoteCustomColors,recordInfo:{context:{},},},init:function(parent,options){this._super.apply(this,arguments);this.id=++id;this.options=options;},willStart:function(){new SummernoteManager(this);this.$target=this.$el;return this._super();},start:function(){this.$target.wrap('<odoo-wysiwyg-container>');this.$el=this.$target.parent();var options=this._editorOptions();this.$target.summernote(options);this.$editor=this.$('.note-editable:first');this.$editor.data('wysiwyg',this);this.$editor.data('oe-model',options.recordInfo.res_model);this.$editor.data('oe-id',options.recordInfo.res_id);$(document).on('mousedown',this._blur);this._value=this.$target.html()||this.$target.val();return this._super.apply(this,arguments).then(()=>{this.$editor.trigger('mouseup');});},destroy:function(){$(document).off('mousedown',this._blur);if(this.$target&&this.$target.is('textarea')&&this.$target.next('.note-editor').length){this.$target.summernote('destroy');}
this._super();},getEditable:function(){return this.$editor;},isDirty:function(){return this._value!==(this.$editor.html()||this.$editor.val());},focus:function(){console.log('focus');},getValue:function(options){var $editable=options&&options.$layout||this.$editor.clone();$editable.find('[contenteditable]').removeAttr('contenteditable');$editable.find('[class=""]').removeAttr('class');$editable.find('[style=""]').removeAttr('style');$editable.find('[title=""]').removeAttr('title');$editable.find('[alt=""]').removeAttr('alt');$editable.find('[data-original-title=""]').removeAttr('data-original-title');$editable.find('a.o_image, span.fa, i.fa').html('');$editable.find('[aria-describedby]').removeAttr('aria-describedby').removeAttr('data-original-title');return $editable.html();},save:function(){var isDirty=this.isDirty();var html=this.getValue();if(this.$target.is('textarea')){this.$target.val(html);}else{this.$target.html(html);}
return Promise.resolve({isDirty:isDirty,html:html});},setValue:function(value,options){if(this.$editor.is('textarea')){this.$target.val(value);}else{this.$target.html(value);}
this.$editor.html(value);},_editorOptions:function(){var self=this;var options=Object.assign({},$.summernote.options,this.defaultOptions,this.options);if(this.options.generateOptions){options=this.options.generateOptions(options);}
options.airPopover=options.toolbar;options.onChange=function(html,$editable){$editable.trigger('content_changed');self.trigger_up('wysiwyg_change');};options.onUpload=function(attachments){self.trigger_up('wysiwyg_attachment',attachments);};options.onFocus=function(){self.trigger_up('wysiwyg_focus');};options.onBlur=function(){self.trigger_up('wysiwyg_blur');};return options;},});Wysiwyg.getRange=function(node){var range=$.summernote.core.range.create();return range&&{sc:range.sc,so:range.so,ec:range.ec,eo:range.eo,};};Wysiwyg.setRange=function(startNode,startOffset,endNode,endOffset){$(startNode).focus();if(endNode){$.summernote.core.range.create(startNode,startOffset,endNode,endOffset).select();}else{$.summernote.core.range.create(startNode,startOffset).select();}
$(startNode.tagName?startNode:startNode.parentNode).trigger('wysiwyg.range');};Wysiwyg.setRangeFromNode=function(node,options){var last=node;while(last.lastChild){last=last.lastChild;}
var first=node;while(first.firstChild){first=first.firstChild;}
if(options&&options.begin&&!options.end){Wysiwyg.setRange(first,0);}else if(options&&!options.begin&&options.end){Wysiwyg.setRange(last,last.textContent.length);}else{Wysiwyg.setRange(first,0,last,last.tagName?last.childNodes.length:last.textContent.length);}};return Wysiwyg;});odoo.define('web_editor.widget',function(require){'use strict';return{Dialog:require('wysiwyg.widgets.Dialog'),MediaDialog:require('wysiwyg.widgets.MediaDialog'),LinkDialog:require('wysiwyg.widgets.LinkDialog'),};});;

/* /web_editor/static/src/js/wysiwyg/wysiwyg_snippets.js defined in bundle 'web_editor.assets_wysiwyg' */
odoo.define('web_editor.wysiwyg.snippets',function(require){'use strict';var editor=require('web_editor.editor');var Wysiwyg=require('web_editor.wysiwyg');Wysiwyg.include({init:function(parent,options){this._super.apply(this,arguments);this.Editor=editor.Class;if(!this.options.toolbarHandler){this.options.toolbarHandler=$('#web_editor-top-edit');}},start:async function(){if(this.options.snippets){var self=this;this.editor=new(this.Editor)(this,this.options);this.$editor=this.editor.rte.editable();await this.editor.prependTo(this.$editor[0].ownerDocument.body);this.options.toolbarHandler.append(this.editor.$el);this.$el.on('content_changed',function(e){var $editable=$(e.target).closest('[data-oe-model], .o_editable');$editable.addClass('o_dirty');self.trigger_up('wysiwyg_change');});}else{return this._super();}},});});;

/* /web_editor/static/src/js/wysiwyg/wysiwyg_iframe.js defined in bundle 'web_editor.assets_wysiwyg' */
odoo.define('web_editor.wysiwyg.iframe',function(require){'use strict';var Wysiwyg=require('web_editor.wysiwyg');var ajax=require('web.ajax');var core=require('web.core');var qweb=core.qweb;var promiseCommon;var promiseWysiwyg;Wysiwyg.include({init:function(parent,options){this._super.apply(this,arguments);if(this.options.inIframe){if(!this.options.iframeCssAssets){this.options.iframeCssAssets='web_editor.wysiwyg_iframe_css_assets';}
this._onUpdateIframeId='onLoad_'+this.id;}},willStart:function(){if(!this.options.inIframe){return this._super();}
var debug=odoo.debug;odoo.debug=false;var defAsset;if(this.options.iframeCssAssets){defAsset=ajax.loadAsset(this.options.iframeCssAssets);}else{defAsset=Promise.resolve({cssLibs:[],cssContents:[]});}
promiseWysiwyg=promiseWysiwyg||ajax.loadAsset('web_editor.wysiwyg_iframe_editor_assets');odoo.debug=debug;this.defAsset=Promise.all([promiseWysiwyg,defAsset]);this.$target=this.$el;return this.defAsset.then(this._loadIframe.bind(this)).then(this._super.bind(this));},_loadIframe:function(){var self=this;this.$iframe=$('<iframe class="wysiwyg_iframe">').css({'min-height':'400px',width:'100%'});var avoidDoubleLoad=0;var def=new Promise(function(resolve){window.top[self._onUpdateIframeId]=function(Editor,_avoidDoubleLoad){if(_avoidDoubleLoad!==avoidDoubleLoad){console.warn('Wysiwyg iframe double load detected');return;}
delete window.top[self._onUpdateIframeId];var $iframeTarget=self.$iframe.contents().find('#iframe_target');$iframeTarget.find('.o_editable').html(self.$target.val());self.options.toolbarHandler=$('#web_editor-top-edit',self.$iframe[0].contentWindow.document);$(qweb.render('web_editor.FieldTextHtml.fullscreen')).appendTo(self.options.toolbarHandler).on('click','.o_fullscreen',function(){$("body").toggleClass("o_field_widgetTextHtml_fullscreen");var full=$("body").hasClass("o_field_widgetTextHtml_fullscreen");self.$iframe.parents().toggleClass('o_form_fullscreen_ancestor',full);$(window).trigger("resize");});self.Editor=Editor;resolve();};});this.$iframe.data('loadDef',def);this.$iframe.on('load',function onLoad(ev){var _avoidDoubleLoad=++avoidDoubleLoad;self.defAsset.then(function(assets){if(_avoidDoubleLoad!==avoidDoubleLoad){console.warn('Wysiwyg immediate iframe double load detected');return;}
var iframeContent=qweb.render('wysiwyg.iframeContent',{assets:assets,updateIframeId:self._onUpdateIframeId,avoidDoubleLoad:_avoidDoubleLoad});self.$iframe[0].contentWindow.document.open("text/html","replace").write(iframeContent);});});this.$iframe.insertAfter(this.$target);return def;},});});